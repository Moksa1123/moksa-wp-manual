# 03.02 (實作) 運用 n8n-nodes-line-messaging 節點：發送文字、圖片、貼圖訊息

嗨，歡迎來到 n8n 與 WordPress 協作的實作課程！

在前一章節，我們已經成功在 n8n 環境中安裝了 `n8n-nodes-line-messaging` 這個強大的社群節點。今天，我們將正式動手操作，學習如何使用這個節點，透過 LINE Messaging API 發送最常見的三種訊息類型：**純文字 (Text)**、**圖片 (Image)** 和**貼圖 (Sticker)**。

掌握這些基本功，是未來打造複雜 WooCommerce 自動化通知流程 (如訂單確認、出貨通知) 的基石。讓我們開始吧！

---

### 前置準備 (Prerequisites)

在開始本次實作之前，請確保你已經完成以下準備工作：

1.  **一個運作中的 n8n 執行個體**：可以是雲端版 (n8n.cloud) 或自行架設的版本。
2.  **一個 LINE 官方帳號 (Official Account)**：並且已經啟用 **Messaging API** 功能。
3.  **一組有效的「長期」存取權杖 (Channel Access Token)**：你可以在 [LINE Developers Console](https://developers.line.biz/console/) 的 Messaging API 頻道設定中找到它。
4.  **你的 LINE User ID**：為了方便測試，你需要一個接收訊息的對象。你可以透過 Webhook 事件 (例如：當用戶加入你的官方帳號為好友時) 來取得。如果暫時沒有，可以先準備好，後續會教你如何取得。
5.  **已安裝 `n8n-nodes-line-messaging` 節點**：請至 n8n 的 `Settings > Community Nodes` 中確認已安裝並啟用。

`[截圖：n8n 社群節點安裝成功的畫面]`

---

### 核心觀念：認識 LINE Messaging API 節點

這個社群節點是對 LINE 官方 API 的一個視覺化封裝，讓我們可以用填空的方式，而不是寫程式碼，來與 LINE 的伺服器溝通。

當你在 n8n 畫布中新增這個節點時，會看到幾個關鍵欄位：

*   **Credentials for LINE Messaging API**：這裡是存放你 **Channel Access Token** 的地方。n8n 會將它安全地加密儲存。
*   **Resource**：定義你要操作的 API 資源。對於發送訊息，我們通常會選擇 `Message`。
*   **Operation**：定義你要執行的操作。最常用的就是 `Push` (主動推送) 和 `Reply` (回覆用戶訊息)。本次實作我們將專注於 **`Push`**。

`[截圖：LINE Messaging 節點的初始介面，標示出 Credentials, Resource, Operation 欄位]`

---

### 實作一：發送純文字訊息 (Text Message)

這是最基本也最常見的操作。

#### 步驟 1：建立工作流程與手動觸發

首先，建立一個新的 n8n 工作流程 (Workflow)。為了方便我們隨時測試，第一個節點請使用 `Manual` (或 `Start`) 節點，它就像一個手動執行的按鈕。

#### 步驟 2：加入並設定 LINE 節點

1.  點擊 `+` 號，搜尋並加入 `LINE Messaging` 節點。
2.  在 **Credentials** 欄位，點擊 `- Create New -`。
3.  在 **Name** 欄位為這組憑證取一個好記的名字，例如「Moksa 官方帳號」。
4.  將你從 LINE Developers Console 複製的 **Channel Access Token (long-lived)** 貼到 **`Channel Access Token`** 欄位中，然後儲存 (Save)。
5.  **Resource**：選擇 `Message`。
6.  **Operation**：選擇 `Push`。
7.  **To**：填入你要發送對象的 **LINE User ID** (格式為 `U` 開頭的一長串字元)。
8.  **Messages**：點擊 `Add Message Item`。
9.  **Type**：選擇 `Text`。
10. **Text**：輸入你想發送的文字，例如：「哈囉！這是一則來自 n8n 的測試訊息。🎉」

`[截圖：完整設定好的 LINE 節點，包含憑證、Push 操作、User ID、以及 Text Message 內容]`

#### 步驟 3：測試與驗證

點擊節點右上角的「▶️ Execute Node」按鈕。如果一切設定正確，n8n 會顯示執行成功，同時你的手機 LINE app 也會立刻收到剛剛設定的文字訊息！

`[截圖：手機收到 LINE 純文字訊息的畫面]`

---

### 實作二：發送圖片訊息 (Image Message)

純文字訊息有時略顯單調，加上圖片能讓溝通更生動。

#### 步驟 1：新增圖片訊息類型

在剛剛的 LINE 節點中，我們可以修改訊息類型，或是再新增一個訊息項目。這裡我們直接修改：

1.  找到 **Messages** 區塊，將原本的 `Text` 類型，透過下拉選單改為 `Image`。

#### 步驟 2：設定圖片網址

你會看到出現了兩個新的欄位：

*   **Original Content URL**：**原始圖片的公開網址**。
*   **Preview Image URL**：**預覽圖的公開網址**。

**Moksa 技巧：**
*   這兩個網址**都必須是 `https` 開頭**的公開有效網址。你不能使用電腦本機的路徑 (例如 `C:\images\pic.jpg`)。
*   你可以將圖片上傳到 WordPress 的媒體庫，然後複製其 URL 來使用。
*   為了達到最佳效果，**兩個欄位可以填寫相同的網址**。
*   LINE 對圖片有規格限制：`JPEG` 格式，檔案大小最大 `10MB`，圖片尺寸最大 `4096x4096`。預覽圖則建議為 `JPEG`，最大 `1MB`，`240x240`。

我們來填入範例網址：
*   **Original Content URL**: `https://moksaweb.com/wp-content/uploads/2023/05/moksa-logo.png`
*   **Preview Image URL**: `https://moksaweb.com/wp-content/uploads/2023/05/moksa-logo.png`

`[截圖：設定 Image Message 的畫面，顯示兩個 URL 欄位已填寫]`

#### 步驟 3：測試與驗證

再次點擊「▶️ Execute Node」。檢查你的手機，這次應該會收到一張圖片訊息。

`[截圖：手機收到 LINE 圖片訊息的畫面]`

---

### 實作三：發送貼圖訊息 (Sticker Message)

貼圖是 LINE 的靈魂！在自動化流程中加入貼圖，可以讓機器人訊息看起來更親切、更有溫度。

#### 步驟 1：新增貼圖訊息類型

同樣地，將 **Messages** 的 **Type** 改為 `Sticker`。

#### 步驟 2：尋找並設定貼圖 ID

發送貼圖需要提供兩個 ID：

*   **Package ID**：貼圖包的 ID。
*   **Sticker ID**：該貼圖包中，特定一張貼圖的 ID。

**Moksa 技巧：**
要去哪裡找這些 ID 呢？LINE 官方很貼心地提供了一份可免費使用的貼圖列表！你可以從這個官方文件中查詢：
[**LINE Official Sticker List (PDF)**](https://developers.line.biz/media/messaging-api/sticker_list.pdf)

讓我們從文件中找一組來使用，例如：一個熊大敬禮的貼圖。
*   **Package ID**: `11537`
*   **Sticker ID**: `52002734`

將這兩組數字填入對應的欄位。

`[截圖：設定 Sticker Message 的畫面，顯示 Package ID 和 Sticker ID 欄位已填寫]`

#### 步驟 3：測試與驗證

執行節點，你的手機應該會收到指定的熊大貼圖！

`[截圖：手機收到 LINE 貼圖訊息的畫面]`

---

### Moksa 技巧：組合多種類型訊息

一個更進階且實用的技巧是，單次 `Push` 操作其實可以**同時發送多個訊息** (最多 5 個)。這比分開多次發送更有效率，使用者體驗也更好。

操作非常簡單：

1.  在 LINE 節點的 **Messages** 區塊，點擊 `Add Message Item` 按鈕。
2.  你可以設定第一個 Item 是 `Text`，第二個 Item 是 `Sticker`。
3.  例如：
    *   **Item 1 (Text)**: 「您的訂單 #WP2024 已出貨囉！」
    *   **Item 2 (Image)**: (放一張商品打包好的照片 URL)
    *   **Item 3 (Sticker)**: (放一個開心或感謝的貼圖 ID)

`[截圖：一個 LINE 節點中設定了三個 Message Item 的畫面，分別是 Text, Image, Sticker]`

當你執行這個節點時，用戶會依序、且幾乎是同時收到這三則訊息，形成一個完整的對話情境。

### 總結與下一步

恭喜你！你已經掌握了透過 n8n 發送 LINE 基本訊息的核心技能。這三種訊息類型（文字、圖片、貼圖）涵蓋了日常自動化 90% 以上的需求。

我們學會了：
*   設定 LINE 節點的憑證與基本操作。
*   發送純文字訊息。
*   從公開網址發送圖片訊息。
*   查詢並發送官方貼圖。
*   在單一請求中組合多個訊息。

在接下來的課程中，我們將會學習如何**動態地**產生這些訊息內容。例如，當 WooCommerce 商店有新訂單時，自動從訂單資料中提取顧客姓名、訂單編號，並組合出一則個人化的 LINE 通知訊息，這將是 n8n 與 WordPress 協作的真正威力所在！