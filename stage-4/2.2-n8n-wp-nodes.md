# 02.02 (實作) 使用 n8n 專用節點讀寫 WordPress/WooCommerce 資料

哈囉，歡迎來到 n8n 與 WordPress 協作的實作課程！

在上一堂課，我們已經成功地安裝並啟動了 n8n。從這堂課開始，我們將正式進入最令人興奮的部分：讓 n8n 與你的 WordPress/WooCommerce 網站進行溝通。

n8n 最強大的地方之一，就是它內建了許多應用程式的「專用節點 (Nodes)」。這些節點將複雜的 API (應用程式介面) 請求封裝成簡單易懂的圖形化介面。你不需要自己撰寫程式碼，只需要填寫幾個欄位，就能讀取或寫入資料。

今天，我們將聚焦在 `WordPress` 和 `WooCommerce` 這兩個核心節點上，並透過三個實際案例，帶你學會如何安全地連接你的網站，並執行最常見的讀寫操作。

---

### Part 1: 前置作業 - 建立 WordPress 應用程式密碼

在 n8n 可以存取你的網站資料之前，我們必須先在 WordPress 這端建立一組專門給 n8n 使用的「鑰匙」。為了安全起見，我們**絕對不會**直接使用你的管理員密碼，而是會產生一組「**應用程式密碼 (Application Password)**」。這組密碼可以隨時被撤銷，且只授權給特定的應用程式使用，安全性更高。

**步驟 1：登入 WordPress 後台**

*   請先登入你的 WordPress 網站後台。

**步驟 2：前往使用者個人資料頁面**

*   在左側選單中，點擊「**使用者**」 > 「**個人資料**」。

**步驟 3：找到「應用程式密碼」區塊**

*   將頁面往下滑，你會找到一個名為「**應用程式密碼**」的區塊。

**步驟 4：建立新的應用程式密碼**

*   在「**新應用程式密碼名稱**」欄位中，輸入一個你好記的名稱，例如 `n8n Automation` 或 `我的 n8n 連線`。
*   點擊「**新增應用程式密碼**」按鈕。

``

**步驟 5：複製並妥善保管密碼**

*   系統會立刻產生一組密碼，格式會像這樣 `xxxx xxxx xxxx xxxx xxxx xxxx`。
*   **Moksa 技巧：** **這組密碼只會顯示這一次！** 請立刻將它複製下來，並貼到一個安全的暫存位置（例如密碼管理器或一個臨時的記事本）。一旦你離開或重新整理這個頁面，密碼就會消失，屆時只能重新建立一組。

``

---

### Part 2: 在 n8n 中建立 WordPress 憑證 (Credential)

有了應用程式密碼後，我們就可以回到 n8n，設定連線到你網站的「憑證 (Credential)」。

**步驟 1：進入 n8n 的 Credentials 頁面**

*   在 n8n 的左側選單，點擊「**Credentials**」。

**步驟 2：新增 Credential**

*   點擊右上角的「**Add credential**」按鈕。

**步驟 3：搜尋 WordPress**

*   在搜尋框中輸入 `WordPress`，然後點擊「**WordPress API**」。

``

**步驟 4：填寫憑證資訊**

*   **Credential Name:** 輸入一個好辨識的名稱，例如 `我的 Moksa 網站`。
*   **Authentication Method:** 保持預設的 `Access Token`。
*   **Base URL:** **非常重要！** 請輸入你網站的 **完整網址**，包含 `https://`，例如 `https://moksaweb.com`。
*   **Username:** 輸入你在 WordPress 後台的**使用者名稱** (Username)。
*   **Application Password:** 將我們剛剛在 Part 1 取得的**應用程式密碼**（包含空格）完整貼上。
*   點擊右下角的「**Save**」儲存。

恭喜！你已經成功地讓 n8n 與你的 WordPress 網站建立了安全的連線。接下來，我們就可以開始實際操作資料了。

---

### Part 3: 實作演練 (一) - 讀取：取得最新的 5 筆 WooCommerce 訂單

第一個實作，讓我們來試著從 WooCommerce 讀取資料。這在製作報表、同步訂單到其他系統時非常實用。

**步驟 1：建立新工作流程 (Workflow)**

*   回到 n8n 主畫布，建立一個新的工作流程。
*   我們的觸發器 (Trigger) 可以先用最簡單的「**Manual**」節點，方便我們手動測試。

**步驟 2：新增 WooCommerce 節點**

*   點擊 `+` 按鈕，在搜尋框中輸入 `WooCommerce`，並選取它。

**步驟 3：設定節點參數**

*   **Credential for WooCommerce API:** 從下拉選單中，選擇你剛剛建立的憑證，例如 `我的 Moksa 網站`。
*   **Resource:** 這是你要操作的資料類型。我們選擇「**Order**」。
*   **Operation:** 這是你要執行的動作。我們選擇「**Get Many**」，代表取得多筆資料。

**步驟 4：使用 Options 篩選結果**

*   預設情況下，「Get Many」會抓取所有訂單，這可能會非常慢。我們需要加上篩選條件。
*   點擊「**Options**」下方的「**Add Option**」。
*   在跳出的選單中，選擇「**Per Page**」。這代表每頁顯示幾筆資料。我們在欄位中填入 `5`。
*   **Moksa 技巧：** WooCommerce API 預設會按日期**降序**排列，所以 `Per Page` 設為 5，實際上就是抓取「最新的 5 筆訂單」。你也可以再新增 `Order By` > `Date` 和 `Order` > `Descending` 來明確指定排序。

``

**步驟 5：執行與檢視結果**

*   點擊節點右下角的「**Execute Node**」按鈕。
*   執行成功後，右側的輸出視窗會顯示一個包含 5 個項目的陣列 (Array)。每一個項目 (Item) 就是一筆訂單的完整資料，包含顧客資訊、商品、金額等，格式為 JSON。

``

太棒了！你已經成功從你的網站讀取了即時資料。這些資料後續就可以被傳遞給 Google Sheets, Slack, LINE Notify 等節點做進一步的應用。

---

### Part 4: 實作演練 (二) - 寫入 (新增)：自動發佈一篇 WordPress 文章

讀取資料很棒，但 n8n 的真正威力在於「寫入」資料，實現自動化。讓我們來試試看自動發佈一篇 WordPress 文章。

**步驟 1：設定觸發器**

*   為了模擬外部系統傳送資料，我們將觸發器改為「**Webhook**」。Webhook 會產生一個專屬網址，任何服務只要向這個網址發送資料，就能觸發這個工作流程。
*   新增一個 Webhook 節點，n8n 會自動給你一個 `TEST URL`。

**步驟 2：新增 WordPress 節點**

*   在 Webhook 節點後方，新增一個「**WordPress**」節點。

**步驟 3：設定節點參數**

*   **Credential for WordPress API:** 選擇同一個憑證。
*   **Resource:** 選擇「**Post**」。
*   **Operation:** 選擇「**Create**」。
*   **Title:** **這是關鍵！** 我們要將 Webhook 傳來的資料動態填入。點擊欄位右邊的「`fx`」圖示，然後從「Current Node」>「Input Data」>「JSON」>「body」中，選擇你想對應的標題資料。n8n 會自動產生一個表達式，例如：`{{ $json.body.title }}`。
*   **Content:** 同理，使用表達式 `{{ $json.body.content }}` 來對應文章內容。
*   **Status:** 選擇「**Publish**」，代表直接發佈。

``

**步驟 4：測試 Webhook**

*   你可以使用 Postman 或任何可以發送 HTTP POST 請求的工具，向 Webhook 的 `TEST URL` 發送一段 JSON 資料，例如：
    ```json
    {
      "title": "這是由 n8n 自動發佈的文章",
      "content": "哈囉，世界！這篇文章是透過 Webhook 自動建立的。"
    }
    ```
*   發送後，回到 n8n 點擊「**Execute Workflow**」。
*   檢查你的 WordPress 網站，你會發現一篇新文章已經被成功發佈了！

---

### Part 5: 實作演練 (三) - 寫入 (更新)：根據 SKU 更新商品庫存

最後，我們來挑戰一個電商最常見的需求：從外部系統（例如 ERP 或 Google Sheets）同步商品庫存。

這個流程會稍微複雜一點，因為更新商品前，我們需要先「**找到**」這個商品。

**步驟 1：設定觸發器**

*   同樣使用 Webhook 作為觸發器，模擬外部系統傳來要更新的商品 SKU 和新的庫存數量。
*   測試的 JSON 資料可能長這樣：
    ```json
    {
      "sku": "MOKSA-TSHIRT-L",
      "new_stock": 50
    }
    ```

**步驟 2：(尋找) 新增 WooCommerce 節點**

*   這個節點的任務是根據傳入的 SKU，找到對應的商品 ID。
*   **Credential:** 選擇你的憑證。
*   **Resource:** 「**Product**」。
*   **Operation:** 「**Get Many**」。
*   **Options > Add Option > SKU:** 在欄位中使用表達式 `{{ $json.body.sku }}`，來動態篩選商品。

**步驟 3：(更新) 新增第二個 WooCommerce 節點**

*   這個節點才是真正執行更新的動作。
*   **Credential:** 選擇你的憑證。
*   **Resource:** 「**Product**」。
*   **Operation:** 「**Update**」。
*   **Product ID:** **這是關鍵！** 我們需要從上一個「尋找」節點的結果中，取得商品 ID。使用表達式，從節點列表中選擇上一個 WooCommerce 節點的輸出，路徑會類似 `{{ $('WooCommerce').item.json.id }}`。
*   **Update Fields > Add Field > Stock Quantity:** 在欄位中使用表達式 `{{ $json.body.new_stock }}`。
*   **Update Fields > Add Field > Manage Stock:** 記得將這個欄位設定為 `True`，確保庫存管理是啟用的。

``

**步驟 4：執行與驗證**

*   發送測試的 JSON 資料到 Webhook URL 並執行整個工作流程。
*   回到你的 WooCommerce 商品頁面，你會發現對應 SKU 的商品庫存已經被成功更新了！

---

### 結論與 Moksa 技巧

今天，你學會了使用 n8n 專用節點對 WordPress/WooCommerce 進行基礎但極為重要的「讀、寫、更新」操作。從讀取訂單、自動發佈文章到同步庫存，這些都是打造自動化商業流程的基石。

**Moksa 技巧：**

WordPress 和 WooCommerce 節點雖然強大，但它們並沒有涵蓋 WordPress REST API 的所有功能。當你未來遇到節點不支援的操作時（例如，更新一個特殊的自訂欄位），請記得你永遠可以使用通用的「**HTTP Request**」節點。你只需要查閱 WordPress 或 WooCommerce 的官方 REST API 文件，就可以使用 `HTTP Request` 節點手動發出請求，來完成任何節點無法做到的事情。這讓 n8n 的可能性變得無限大。

在下一堂課，我們將探索更多實用的觸發器與節點，組合出更強大的自動化流程。繼續加油！