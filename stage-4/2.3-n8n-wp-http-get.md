# 02.03 (實作) 使用 HTTP Request 節點讀取 WP 資料 (GET, 複雜查詢)

哈囉，歡迎回來！在上個單元，我們學會了如何使用 n8n 的 HTTP Request 節點，對 WordPress REST API 發出一個基本的 `GET` 請求，例如抓取特定 ID 的文章。這很棒，但實務上，我們更常需要的是「批次」、「有條件」地抓取資料。

例如：
*   抓取「Moksa 技巧」分類中最新的 5 篇文章。
*   找出所有價格低於 1,000 元，並且正在特價中的 WooCommerce 商品。
*   搜尋標題或內文包含「Elementor」關鍵字的所有頁面。

這些「複雜查詢」正是 WordPress REST API 強大的地方，也是打通 n8n 自動化流程任督二脈的關鍵。今天，我們就要來深入學習如何透過在 URL 上附加「查詢參數 (Query Parameters)」，來精準地篩選、排序、並取得我們想要的任何資料。

準備好了嗎？讓我們開始吧！

---

### 課前複習：什麼是查詢參數 (Query Parameters)？

在我們進入 n8n 實作之前，必須先理解 REST API 是如何接收我們的「篩選條件」的。它依賴的是 URL 中 `?` 後面的部分，也就是所謂的「查詢參數」。

一個基本的 URL 結構長這樣：
`https://your-domain.com/wp-json/wp/v2/posts`

如果我們要加上查詢參數，會變成這樣：
`https://your-domain.com/wp-json/wp/v2/posts?參數1=值1&參數2=值2&參數3=值3`

*   所有參數都從 `?` 開始。
*   每一個「參數=值」的組合被稱為一個查詢字串 (Query String)。
*   多個參數之間使用 `&` 符號分隔。

**Moksa 技巧**：你可以直接把帶有查詢參數的網址貼到瀏覽器上，如果你的網站 REST API 是公開的（例如文章），你應該能直接看到回傳的 JSON 資料。這是一個非常快速的除錯技巧！

---

### 常用的 WordPress REST API 查詢參數

底下我為你整理了在查詢文章 (posts)、頁面 (pages) 或商品 (products) 時，最常用到的全域參數：

| 參數 | 說明 | 範例 |
| --- | --- | --- |
| `per_page` | 每頁顯示幾筆資料。預設是 10，最多 100。 | `per_page=5` (每頁只顯示 5 筆) |
| `page` | 要顯示第幾頁的資料。 | `page=2` (顯示第 2 頁的結果) |
| `search` | 在標題與內文中搜尋特定關鍵字。 | `search=Kadence` |
| `orderby` | 根據哪個欄位排序。 | `orderby=title` (標題), `orderby=date` (日期), `orderby=id` (ID) |
| `order` | 排序方式。`asc` (升冪) 或 `desc` (降冪)。 | `order=asc` (由小到大，由舊到新) |
| `categories` | **(文章專用)** 根據分類 ID 篩選。可傳入多個 ID，用逗號分隔。 | `categories=15` (只抓取分類 ID 為 15 的文章) |
| `tags` | **(文章專用)** 根據標籤 ID 篩選。可傳入多個 ID，用逗號分隔。 | `tags=22,25` (抓取標籤 ID 為 22 或 25 的文章) |
| `status` | 根據文章狀態篩選。 | `status=publish` (已發布), `status=draft` (草稿) |
| `_fields` | **(效能優化)** 指定只回傳哪些欄位，大幅減少資料傳輸量。 | `_fields=id,title,link,date` (只回傳 ID、標題、連結、日期) |

**Moksa 技巧：** `_fields` 是我們團隊在建構任何自動化流程時，**必定會使用的參數**。預設情況下，API 會回傳幾十個欄位，但你可能只需要其中 3-4 個。指定 `_fields` 可以讓你的 n8n Workflow 運行得更快、更穩定！

---

### 實作：抓取「特定分類」的「最新 5 篇」文章

讓我們來實作一個最常見的需求：**抓取網站中「Moksa 技巧」這個分類底下，最新發布的 5 篇文章，並且我們只需要文章的「標題」、「網址」和「發布日期」。**

#### 步驟 1：找到分類的 ID

REST API 在篩選分類 (categories) 或標籤 (tags) 時，認的是 **ID** 而不是名稱。

1.  登入 WordPress 後台。
2.  前往「**文章**」>「**分類**」。
3.  找到你想查詢的分類（例如：「Moksa 技巧」），把滑鼠移到它的「**編輯**」按鈕上（不用點擊）。
4.  你的瀏覽器左下角會顯示一串網址。注意看網址中的 `tag_ID=` 後面的數字，那就是這個分類的 ID。

``

假設我們在這裡看到的 `tag_ID` 是 `15`。

#### 步驟 2：設定 n8n 的 HTTP Request 節點

1.  在你的 n8n Workflow 中，新增一個 **HTTP Request** 節點。
2.  **Authentication**: 選擇 `Header Auth`，並確保你已經設定好上一堂課建立的 `WordPress App Password` 憑證。
3.  **Request Method**: 選擇 `GET`。
4.  **URL**: 輸入你的文章 API 端點。建議使用 Expression，並搭配環境變數。
    `{{$env["WORDPRESS_URL"]}}/wp-json/wp/v2/posts`
5.  點擊 **Add Option** 按鈕，選擇 `Query Parameters`。
6.  現在，我們要根據需求，把剛剛學到的參數一個個加進去：
    *   點擊 **Add Parameter**。
    *   **Name**: `categories` | **Value**: `15` (剛剛找到的分類 ID)
    *   **Name**: `per_page` | **Value**: `5` (我們只要 5 篇)
    *   **Name**: `orderby` | **Value**: `date` (根據日期排序)
    *   **Name**: `order` | **Value**: `desc` (降冪排序，也就是最新的在前面)
    *   **Name**: `_fields` | **Value**: `title,link,date` (只取需要的欄位)

設定完成後，你的節點看起來會像這樣：

``

#### 步驟 3：執行並驗證結果

點擊右下角的 **Execute Node**。

你會在右邊的 **OUTPUT** 欄位看到 API 回傳的結果。展開 JSON 內容，你會發現：

1.  回傳的資料是一個陣列 (Array)，裡面不多不少，正好有 5 個項目 (Object)。
2.  每一個項目，都只包含了 `title`、`link`、`date` 這三個我們指定的欄位，非常乾淨！
3.  這些文章的確都是最新的，而且都屬於 ID 為 15 的那個分類。

``

太棒了！你已經成功地從 WordPress 抓取了高度客製化的資料集。這些乾淨的資料，現在可以輕鬆地傳遞給下一個節點，例如：
*   傳給 **Google Sheets** 節點，將最新文章自動建檔。
*   傳給 **Discord** 或 **LINE** 節點，自動發布新文章通知。
*   傳給 **OpenAI** 節點，讓 AI 幫你為這些文章產生社群貼文。

---

### 總結與挑戰

今天我們學會了使用 WordPress REST API 的查詢參數，這是打通 WordPress 與 n8n 自動化之間最重要的一項技能。

**重點回顧：**

1.  **複雜查詢的結構**：透過 `?key=value&key2=value2` 的方式來篩選資料。
2.  **必學參數**：`per_page`, `orderby`, `order`, `search` 以及分類/標籤的篩選。
3.  **效能優化**：永遠記得使用 `_fields` 來指定你需要的欄位，避免傳輸不必要的資料。
4.  **ID 的重要性**：在 WordPress 中，分類、標籤、使用者等都是透過 ID 來識別的。

**小挑戰：**
請你試著修改剛剛的 HTTP Request 節點，完成以下任務：
*   抓取 **WooCommerce** 中，**所有正在特價 (`on_sale=true`)** 的商品。
*   只回傳商品的 **名稱 (`name`)**、**價格 (`price`)** 和 **永久連結 (`permalink`)**。
*   (提示：WooCommerce 商品的 API 端點是 `/wp-json/wc/v3/products`，你需要有對應的 WooCommerce API Key 權限。)

在下一個單元，我們將會學習如何「寫入」資料到 WordPress，包含如何透過 n8n 自動發布文章！我們下一堂課見！