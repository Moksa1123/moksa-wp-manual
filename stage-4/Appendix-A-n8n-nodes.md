# 附錄 A：n8n 常用節點參考

你好，我是 Moksa 的首席課程導師。

歡迎來到 n8n 的世界！n8n (發音為 "n-eight-n") 是一個強大的工作流程自動化工具，它的核心就是「節點」(Nodes)。每個節點都代表一個特定的動作、一個觸發條件或一個邏輯判斷。

在這個附錄中，我們將為你整理出在 WordPress 與 WooCommerce 的自動化情境中，最常用、也最重要的節點。這份文件將成為你在建構自動化流程時的最佳速查手冊。我們不會涵蓋 n8n 所有的節點（那太多了！），但會專注於我們 Moksa 技術棧中最常與 n8n 搭配使用的節點。

---

## 一、觸發節點 (Trigger Nodes)

觸發節點是所有工作流程的「起點」。它們決定了這個自動化流程「何時」或「如何」被啟動。一個工作流程只會有一個觸發節點。

### **1. Webhook**

`[截圖]`

*   **用途說明：**
    Webhook 節點會產生一個獨一無二的 URL。任何應用程式只要向這個 URL 發送一個 HTTP 請求（通常是 POST），就能立即觸發這個 n8n 工作流程。**這是最常用、最靈活的觸發方式**。

*   **常用情境：**
    *   接收 **FluentCRM** 的 Webhook，當使用者被加上特定標籤時，觸發後續動作。
    *   接收來自**表單外掛**（如 Kadence Blocks Form, Elementor Form）提交的資料。
    *   接收**金流服務**（如綠界 ECPay、LINE Pay）的付款成功通知，進行後續的訂單處理。
    *   串接沒有原生 n8n 節點的第三方服務。

*   **關鍵參數：**
    *   **HTTP Method:** 通常選擇 `POST`，因為大部分服務都是透過 POST 方法來傳遞資料。
    *   **Path:** URL 的最後一部分，你可以自訂它來區分不同的 Webhook。例如 `order-paid`。
    *   **Test URL:** 用於開發與測試階段的 URL。
    *   **Production URL:** 當你將工作流程設定為 `Active` (啟用) 後，應該使用的正式 URL。

*   **Moksa 技巧：**
    **為你的 Webhook URL 加上認證機制！** 在 `Authentication` 欄位選擇 `Header Auth`，並設定一個自訂的 Header (例如 `X-N8N-Auth`) 與一個複雜的密碼。然後在發送 Webhook 的那一端（例如 FluentCRM），也要設定發送這個 Header。這能確保只有你知道的服務可以觸發你的流程，避免被惡意攻擊。

### **2. Schedule / Cron**

`[截圖]`

*   **用途說明：**
    讓你能夠在「固定的時間」或「固定的間隔」自動執行工作流程。`Schedule` 提供簡單的選項（每小時、每天），而 `Cron` 則提供更精細的時間設定（例如：每個星期一早上 9:30）。

*   **常用情境：**
    *   **每日**產生銷售報告，並發送到 Slack 或 Email。
    *   **每週**檢查一次 WooCommerce 中「待付款」超過 7 天的訂單，並自動取消它們。
    *   **每月**初同步一次會員資料到 Google Sheets 進行備份。
    *   **每 15 分鐘**檢查一次特定 API 的狀態。

*   **關鍵參數：**
    *   **Trigger Interval:** 觸發的頻率。
    *   **Mode:** `Every Day`, `Every Week`, `Cron` 等。
    *   **Timezone:** **非常重要！** 請務必設定為你的網站或你業務所在地的時區（例如 `Asia/Taipei`），以確保流程在正確的時間執行。

*   **Moksa 技巧：**
    當你在設計需要處理大量資料的排程任務時（例如：同步 5000 筆客戶資料），請務必在流程中加入 `Split In Batches` 節點。一次處理太多資料可能會導致 n8n 或你的伺服器資源耗盡而失敗。分批處理是更穩定、更可靠的做法。

---

## 二、核心功能節點 (Core Nodes)

這些是 n8n 的內建節點，用於處理資料、執行邏輯判斷和控制流程走向。掌握它們是建立複雜流程的基礎。

### **1. IF**

`[截圖]`

*   **用途說明：**
    進行「是」或「否」的二元邏輯判斷。如果條件成立（True），資料會從 `true` 出口流出；如果不成立（False），則從 `false` 出口流出。

*   **常用情境：**
    *   判斷訂單總金額是否**大於** 2000 元，是的話就給予 VIP 標籤。
    *   判斷傳入的資料中，`email` 欄位是否**為空**。
    *   判斷商品名稱中是否**包含**「預購」字樣。

### **2. Switch**

`[截圖]`

*   **用途說明：**
    像是 IF 節點的加強版，可以根據一個欄位的值，設定多個不同的輸出路徑。這讓你的流程圖更清晰，避免使用一長串的 IF 節點。

*   **常用情境：**
    *   根據訂單的**付款方式** (`payment_method`)，將流程導向不同的處理路徑（`ecpay_credit_card`, `linepay`, `atm`）。
    *   根據使用者的**來源國家** (`billing.country`)，發送不同語言的歡迎信。
    *   根據表單提交的「問題類型」，將通知轉發給不同的部門（`銷售`, `技術支援`, `客服`）。

*   **Moksa 技巧：**
    **永遠要設定好 `Default` 輸出！** Switch 節點的最後一個路徑是「Default」，代表當所有前面的條件都不符合時，資料會從這裡流出。你可以在這裡設定一個錯誤通知，例如發送一個 Slack 訊息給自己，提醒你有一個意料之外的數值出現了。

### **3. Set**

`[截圖]`

*   **用途說明：**
    用來新增、修改或刪除資料欄位。這是資料處理的核心，幾乎所有流程都會用到它。

*   **常用情境：**
    *   **新增欄位：** 從訂單資料中，將 `billing.first_name` 和 `billing.last_name` 合併成一個新的欄位 `full_name`。
    *   **修改資料：** 將從 API 獲取的日期格式（ISO 8601）轉換成台灣使用者習慣的格式（`YYYY-MM-DD`）。
    *   **準備資料：** 建立一個結構化的 JSON 物件，以便後續的 `HTTP Request` 節點能直接使用。
    *   **取值：** 使用 **Expressions** (`{{ }}`) 從複雜的 JSON 結構中取出你需要的特定值。

*   **關鍵參數：**
    *   **Name:** 你要新增或修改的欄位名稱。
    *   **Value:** 該欄位的值。你可以直接輸入文字，也可以使用 **Expressions** 來動態取值或進行運算。
    *   **Keep Only Set:** **謹慎使用！** 如果勾選此項，只有在這個 Set 節點中設定的欄位會被保留，所有其他的傳入資料都會被丟棄。

### **4. Code**

`[截圖]`

*   **用途說明：**
    當內建節點無法滿足你複雜的資料處理需求時，可以使用 Code 節點，直接編寫 JavaScript 程式碼來處理傳入的資料。

*   **常用情境：**
    *   進行複雜的數學運算或字串處理。
    *   解析一段非標準格式的文字。
    *   對陣列資料進行複雜的篩選、排序或分組。

*   **Moksa 技巧：**
    **優先使用內建節點。** 雖然 Code 節點很強大，但它會降低工作流程的「可讀性」。其他團隊成員（或未來的你）可能需要花更多時間去理解這段程式碼。只有在 Set、IF 等節點組合起來也無法輕易完成任務時，才考慮使用 Code 節點。

---

## 三、WordPress & WooCommerce 整合節點

n8n 提供了官方的 WordPress 與 WooCommerce 節點，讓整合變得非常簡單。

### **1. WordPress**

`[截圖]`

*   **用途說明：**
    讓你可以在 n8n 中對 WordPress 網站執行各種操作（新增、讀取、更新、刪除）。

*   **常用情境：**
    *   當 Google Sheets 有一筆新資料時，自動在 WordPress **建立**一篇新文章。
    *   當使用者在 WooCommerce 註冊後，**更新**該使用者的 User Meta 欄位。
    *   每日定時**讀取**所有待審核的留言，並發送到 Slack。

*   **關鍵參數：**
    *   **Credential:** 驗證資訊。你需要先在 WordPress 後台建立一個「應用程式密碼」，然後在 n8n 中設定 Credential。
    *   **Resource:** 你要操作的對象，例如 `Post`, `User`, `Comment`, `Media`。
    *   **Operation:** 你要執行的動作，例如 `Create`, `Update`, `Get`, `Delete`。

### **2. WooCommerce Trigger**

`[截圖]`

*   **用途說明：**
    專為 WooCommerce 設計的觸發節點。當 WooCommerce 中發生特定事件時，它會自動觸發工作流程。這比使用 Webhook 更穩定、更簡單。

*   **常用情境：**
    *   當有**新訂單建立 (Order Created)** 時觸發。
    *   當**顧客資料更新 (Customer Updated)** 時觸發。
    *   當**商品庫存變低 (Product Low Stock)** 時觸發。

*   **關鍵參數：**
    *   **Credential:** 同 WordPress 節點，需要設定 WooCommerce 的 REST API Keys。
    *   **Event:** 選擇你想要監聽的 WooCommerce 事件。

### **3. WooCommerce**

`[截圖]`

*   **用途說明：**
    專為 WooCommerce 設計的動作節點，讓你對商店的資料進行操作。

*   **常用情境：**
    *   在訂單付款成功後，**更新訂單狀態**為「已處理」。
    *   根據顧客的消費金額，自動**建立一個專屬的優惠券** (`Coupon`) 並發送給他。
    *   從 CRM 系統同步資料，**建立新的顧客** (`Customer`)。

---

## 四、常用應用程式整合節點

以下是我們在 Moksa 專案中，最常與 n8n 串接的第三方應用服務。

### **1. Google Sheets**

`[截圖]`

*   **用途說明：**
    讀寫 Google Sheets 電子試算表。這是一個極其方便的「小型資料庫」或「日誌記錄工具」。

*   **常用情境：**
    *   將每一筆 WooCommerce 新訂單的關鍵資訊**附加 (Append)** 到一個 Google Sheet 中，作為備份和簡易報表。
    *   從一個 Google Sheet 中**讀取 (Get)** 商品的價格和庫存列表，然後批次更新到 WooCommerce。

### **2. LINE**

`[截圖]`

*   **用途說明：**
    透過 LINE Messaging API 發送訊息給使用者。

*   **常用情境：**
    *   當 WooCommerce 訂單出貨時，發送一則包含**物流追蹤碼**的 LINE 訊息給顧客。
    *   結合 AI 服務（如 OpenAI），製作一個簡單的 LINE 客服機器人。

*   **Moksa 技巧：**
    LINE 節點需要使用 LINE Messaging API 的 `Channel Access Token`，這通常用於一對一的客服或推播場景。如果你的需求只是單純的「系統通知」（例如通知團隊有新訂單），使用 **Order Notify** 或 **OrderChatz** 外掛提供的 Webhook 功能，再串接到 n8n，可能會是更簡單快速的選擇。

### **3. FluentCRM**

`[截圖]`

*   **用途說明：**
    直接與你 WordPress 網站上的 FluentCRM 進行互動。

*   **常用情境：**
    *   當顧客完成一門 LearnDash 課程後，在 FluentCRM 中為該顧客**加上一個「完課」標籤**。
    *   從外部系統（如實體活動報名表）獲取名單後，在 FluentCRM 中**建立新的聯絡人**。

---

## 五、HTTP / API 節點

### **1. HTTP Request**

`[截圖]`

*   **用途說明：**
    這是 n8n 的「萬用節點」。當你要串接的服務沒有提供官方的 n8n 節點時，只要該服務有提供 REST API，你就可以使用 HTTP Request 節點來與它溝通。

*   **常用情境：**
    *   呼叫**綠界科技 (ECPay) 的 API**，查詢特定訂單的發票開立狀態。
    *   呼叫 **RY Tools 外掛**提供的自訂 REST API 端點，來執行特定的物流操作。
    *   串接任何你有 API 文件的新興 SaaS 服務。

*   **關鍵參數：**
    *   **Method:** HTTP 請求的方法，最常用的是 `GET` (讀取資料) 和 `POST` (新增/傳送資料)。
    *   **URL:** 你要請求的 API 端點網址。
    *   **Authentication:** 驗證方式，常見的有 `Header Auth` (用來傳送 API Key)。
    *   **Body:** 當使用 `POST` 或 `PUT` 等方法時，你想要傳送的資料內容，通常是 JSON 格式。

*   **Moksa 技巧：**
    使用此節點前，**務必仔細閱讀你要串接的服務的 API 文件**。文件會告訴你 URL 是什麼、需要用哪種 Method、驗證資訊要放在哪裡（Header 還是 Body），以及資料要用什麼格式傳送。這是所有開發者都必須具備的基本功。

---

希望這份常用節點參考能幫助你更快上手 n8n，並將它應用在你的 WordPress/WooCommerce 網站上，打造出屬於你自己的高效自動化流程！