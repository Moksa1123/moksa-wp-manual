# 03.04 (實作) LINE 其他訊息類型 (Quick Reply, Imagemap, Template Messages)

嗨，歡迎回來！在之前的課程中，我們已經學會如何透過 n8n 發送基本的 LINE 文字訊息。雖然文字訊息很實用，但 LINE 的強大之處在於其豐富的互動訊息類型。這些訊息不僅能讓你的 LINE 官方帳號看起來更專業，更能有效引導使用者進行下一步操作，大幅提升使用者體驗與轉換率。

今天，我們將深入實作三種非常重要且常用的進階訊息類型：

1.  **Quick Reply (快速回覆按鈕)**：提供使用者預設的選項，讓他們用「點擊」取代「打字」。
2.  **Imagemap (圖片地圖)**：在一張圖片上定義多個可點擊的區域，適合用於活動主視覺或菜單導覽。
3.  **Template Messages (樣板訊息)**：使用 LINE 預設的版型，快速建立包含圖片、標題、內文與按鈕的卡片式訊息。

準備好了嗎？讓我們開始打造更具互動性的 LINE 機器人吧！

### 核心觀念：一切都是 JSON

在開始之前，有一個**非常重要的觀念**必須建立：無論是哪種訊息類型，透過 n8n 的 `HTTP Request` 節點發送給 LINE Messaging API 時，**本質上都是在修改請求主體 (Body) 中的 JSON 資料結構**。

LINE 的伺服器會根據你傳送的 JSON 結構來判斷該顯示何種訊息。我們的任務就是學會如何「組合」出 LINE看得懂的 JSON 格式。

**Moksa 技巧：** 強烈建議先使用 [**LINE 官方的 Messaging API Simulator**](https://developers.line.biz/console/fx/) 來視覺化設計你的訊息。你可以在上面點選、設定，然後它會自動產生對應的 JSON。這能讓你省去大量手動撰寫和除錯的時間，是專業開發者的必備工具！

``

---

### 1. Quick Reply (快速回覆按鈕)

Quick Reply 是附加在另一則訊息下方的按鈕列。當使用者點擊其中一個按鈕後，這個按鈕列就會**自動消失**，並送出一個預設的訊息。它非常適合用在需要使用者做出簡單、單次選擇的情境。

**常見應用場景：**
*   取代常見問題的關鍵字，例如「查詢訂單」、「最新活動」、「聯絡客服」。
*   做簡單的是非題或選擇題，例如「我同意服務條款 [是/否]」。
*   引導使用者完成一個流程，例如「想看男裝還是女裝？」。

#### 實作步驟

假設我們要發送一則訊息「哈囉！請問需要什麼服務嗎？」，並附上「查詢訂單」和「最新活動」兩個快速回覆按鈕。

**步驟 1：設定 n8n 基礎流程**

1.  建立一個新的 n8n 工作流程。
2.  使用 `Manual` (手動) 觸發器方便我們測試。
3.  新增一個 `HTTP Request` 節點。

**步驟 2：設定 HTTP Request 節點**

*   **Authentication**: `Header Auth`
*   **Name**: `Authorization`
*   **Value**: `Bearer YOUR_CHANNEL_ACCESS_TOKEN` (請換成你自己的 Channel Access Token)
*   **Method**: `POST`
*   **URL**: `https://api.line.me/v2/bot/message/push`
*   **Send Body**: `On`
*   **Body Content Type**: `JSON`
*   **JSON/RAW Parameters**: `On`

**步驟 3：撰寫 Quick Reply 的 JSON**

在 **Body Parameters** 欄位中，點擊 `Add Expression`，然後貼上以下 JSON 內容。

```json
{
  "to": "YOUR_USER_ID",
  "messages": [
    {
      "type": "text",
      "text": "哈囉！請問需要什麼服務嗎？ 🤔",
      "quickReply": {
        "items": [
          {
            "type": "action",
            "action": {
              "type": "message",
              "label": "查詢訂單 📦",
              "text": "查詢訂單"
            }
          },
          {
            "type": "action",
            "action": {
              "type": "message",
              "label": "最新活動 🔥",
              "text": "最新活動"
            }
          },
          {
            "type": "action",
            "action": {
              "type": "uri",
              "label": "前往官網 🔗",
              "uri": "https://moksaweb.com"
            }
          }
        ]
      }
    }
  ]
}
```

**JSON 結構解說：**
*   `"to"`: 目標使用者的 User ID。測試時請先填寫你自己的。
*   `"messages"`: 一個陣列，可以包含多個訊息物件。
*   `"type": "text"`: 我們的主要訊息是一則文字訊息。
*   `"text"`: 文字訊息的內容。
*   `"quickReply"`: **這是關鍵！** 這個物件代表我們要附加快速回覆按鈕。
*   `"items"`: 一個陣列，裡面放著每一個按鈕的設定。
*   `"type": "action"`: 代表這是一個可點擊的動作按鈕。
*   `"action"`: 定義點擊後發生的事。
    *   `"type": "message"`: 點擊後會代表使用者送出一段文字。
    *   `"label"`: 按鈕上顯示的文字。
    *   `"text"`: 實際送出的文字內容。
    *   `"type": "uri"`: 點擊後會開啟一個網頁。
    *   `"uri"`: 要開啟的網址。

執行工作流程後，你就會在 LINE 裡收到帶有按鈕的訊息了！

``

---

### 2. Imagemap (圖片地圖)

Imagemap 允許你上傳一張圖片，並在這張圖片上定義數個矩形的可點擊區域。每個區域都可以觸發不同的動作（例如：傳送訊息、開啟網頁）。

**常見應用場景：**
*   活動主視覺，不同區塊連結到不同的活動頁面。
*   圖文選單，將主要功能用圖像化方式呈現。
*   產品組合圖，點擊不同產品可以查看商品詳情。

#### 實作步驟

**步驟 1：準備圖片與設定**

1.  **設計一張圖片**：例如 1040px * 1040px 的正方形圖片。
2.  **上傳圖片**：將這張圖片上傳到一個**公開的網址**。你可以上傳到 WordPress 的媒體庫，然後複製它的 URL。**Moksa 技巧：** 為了效能，建議使用像 ShortPixel 這類工具先壓縮過圖片。
3.  **規劃點擊區域**：你需要規劃出每個可點擊區域的 `x`, `y` 座標以及 `寬度(width)` 和 `高度(height)`。左上角為 `(0, 0)`。你可以使用任何繪圖軟體來測量像素位置。

**步驟 2：在 n8n 中設定 HTTP Request 節點**

設定方式與 Quick Reply 相同，主要差別在於 Body 的 JSON 內容。

**步驟 3：撰寫 Imagemap 的 JSON**

```json
{
  "to": "YOUR_USER_ID",
  "messages": [
    {
      "type": "imagemap",
      "baseUrl": "https://your-website.com/path/to/your/image/1040",
      "altText": "這是一張圖文選單，請在手機上查看。",
      "baseSize": {
        "width": 1040,
        "height": 1040
      },
      "actions": [
        {
          "type": "uri",
          "area": {
            "x": 0,
            "y": 0,
            "width": 520,
            "height": 520
          },
          "linkUri": "https://moksaweb.com/courses/"
        },
        {
          "type": "message",
          "area": {
            "x": 520,
            "y": 0,
            "width": 520,
            "height": 520
          },
          "text": "最新消息"
        },
        {
          "type": "message",
          "area": {
            "x": 0,
            "y": 520,
            "width": 1040,
            "height": 520
          },
          "text": "聯絡我們"
        }
      ]
    }
  ]
}
```

**JSON 結構解說：**
*   `"type": "imagemap"`: **指定訊息類型為圖片地圖**。
*   `"baseUrl"`: 圖片的網址。**注意**：LINE 會根據不同解析度抓取不同尺寸，所以這裡通常不包含 `.jpg` 或 `.png` 副檔名。它會自動在你給的網址後方加上 `/1040`, `/700`, `/460`, `/300`, `/240` 等尺寸來抓取。最簡單的方式是，如果你的原圖是 `https://.../image.jpg`，你就提供 `https://.../image`，然後確保你的伺服器設定可以忽略副檔名，或者直接命名為 `1040` 這樣的資料夾存放對應尺寸的圖片。但為了教學簡化，直接提供完整圖片 URL 很多時候也能成功。
*   `"altText"`: 當訊息無法正常顯示時（例如在電腦版預覽），會出現的替代文字。
*   `"baseSize"`: 圖片的原始尺寸。
*   `"actions"`: 一個陣列，定義所有的可點擊區域。
*   `"area"`: 定義一個矩形區域，包含 `x`, `y`, `width`, `height`。
*   `"linkUri"`: 當 `type` 是 `uri` 時，指定要前往的網址。
*   `"text"`: 當 `type` 是 `message` 時，指定點擊後要送出的文字。

``

---

### 3. Template Messages (樣板訊息)

樣板訊息是 LINE 預先設計好的版型，讓我們可以快速填入內容，產生美觀的卡片訊息。最常用的有三種：Buttons, Confirm, 和 Carousel。

#### A. Buttons Template (按鈕樣板)

這是最泛用的樣板，包含一張圖片、標題、內文和最多 4 個按鈕。

**常見應用場景：**
*   WooCommerce 新訂單通知。
*   產品推薦。
*   文章摘要推播。

**JSON 範例：**

```json
{
  "to": "YOUR_USER_ID",
  "messages": [
    {
      "type": "template",
      "altText": "我們有一門新課程上架了！",
      "template": {
        "type": "buttons",
        "thumbnailImageUrl": "https://moksaweb.com/wp-content/uploads/2023/10/n8n-course-featured.png",
        "imageAspectRatio": "rectangle",
        "imageSize": "cover",
        "imageBackgroundColor": "#FFFFFF",
        "title": "n8n 自動化實戰課程",
        "text": "學習如何串接 WordPress 與外部服務，打造你的專屬自動化流程！",
        "defaultAction": {
          "type": "uri",
          "label": "查看詳情",
          "uri": "https://moksaweb.com/courses/n8n-automation/"
        },
        "actions": [
          {
            "type": "uri",
            "label": "查看詳情",
            "uri": "https://moksaweb.com/courses/n8n-automation/"
          },
          {
            "type": "message",
            "label": "詢問客服",
            "text": "你好，我想詢問 n8n 課程"
          }
        ]
      }
    }
  ]
}
```

``

#### B. Confirm Template (確認樣板)

這是一個簡單的二選一版型，包含一段文字和兩個按鈕，常用於確認使用者意圖。

**常見應用場景：**
*   確認是否取消訂單。
*   詢問是否同意訂閱電子報。

**JSON 範例：**

```json
{
  "to": "YOUR_USER_ID",
  "messages": [
    {
      "type": "template",
      "altText": "確認訂閱電子報",
      "template": {
        "type": "confirm",
        "text": "您確定要訂閱 Moksa 的每週電子報嗎？",
        "actions": [
          {
            "type": "message",
            "label": "確定訂閱",
            "text": "CONFIRM_SUBSCRIBE"
          },
          {
            "type": "message",
            "label": "暫時不要",
            "text": "CANCEL_SUBSCRIBE"
          }
        ]
      }
    }
  ]
}
```

**Moksa 技巧：** 在 `actions` 的 `text` 欄位中，我們常常會使用像 `CONFIRM_SUBSCRIBE` 這樣的特殊字串，而不是「確定訂閱」。這樣做的好處是，後續的 n8n 工作流程可以很容易地根據這個**獨特的、不易被使用者手動輸入的關鍵字**來觸發對應的自動化流程，而不會跟使用者平常的對話混淆。

``

#### C. Carousel Template (輪播樣板)

輪播樣板可以讓你將多個「按鈕樣板」橫向排列，使用者可以左右滑動來瀏覽。

**常見應用場景：**
*   展示多個商品。
*   呈現一系列的最新文章。
*   餐廳的菜單。

**JSON 範例 (結構較長)：**

```json
{
  "to": "YOUR_USER_ID",
  "messages": [
    {
      "type": "template",
      "altText": "為您推薦我們的熱門課程",
      "template": {
        "type": "carousel",
        "columns": [
          {
            "thumbnailImageUrl": "https://moksaweb.com/wp-content/uploads/2023/10/n8n-course-featured.png",
            "title": "n8n 自動化實戰課程",
            "text": "學習串接 API，打造自動化商業流程。",
            "actions": [
              { "type": "uri", "label": "課程詳情", "uri": "https://moksaweb.com/courses/n8n/" }
            ]
          },
          {
            "thumbnailImageUrl": "https://moksaweb.com/wp-content/uploads/2023/08/woocommerce-course-featured.png",
            "title": "WooCommerce 進階課程",
            "text": "從金流、物流到行銷，全面掌握電商經營。",
            "actions": [
              { "type": "uri", "label": "課程詳情", "uri": "https://moksaweb.com/courses/woocommerce/" }
            ]
          },
          {
            "thumbnailImageUrl": "https://moksaweb.com/wp-content/uploads/2023/05/kadence-course-featured.png",
            "title": "Kadence 主題全攻略",
            "text": "打造高效能、高質感的 WordPress 網站。",
            "actions": [
              { "type": "uri", "label": "課程詳情", "uri": "https://moksaweb.com/courses/kadence/" }
            ]
          }
        ]
      }
    }
  ]
}
```

**JSON 結構解說：**
*   `"type": "carousel"`: 指定樣板類型為輪播。
*   `"columns"`: 一個陣列，裡面**每一個物件都是一個完整的按鈕樣板結構** (但不包含 `type` 屬性)。

``

### 總結

今天我們實作了三種非常強大的 LINE 訊息類型，它們是打造專業 LINE 官方帳號、提升使用者互動的基石。

*   **Quick Reply**：適合簡單、快速的選項引導。
*   **Imagemap**：適合高度視覺化、品牌化的導覽。
*   **Template Messages**：適合結構化、卡片式的資訊呈現。

請務必親手練習，嘗試修改 JSON 中的各個欄位，看看會產生什麼不同的效果。**再次強調，請務必善用 [LINE Message Simulator](https://developers.line.biz/console/fx/)**，它會是你學習和開發過程中最好的朋友。

在下一堂課，我們將會探索 LINE Messaging API 中最靈活、最強大，但也最複雜的訊息類型：**Flex Message**。屆時，你將可以幾乎不受限制地客製化你的訊息版面！