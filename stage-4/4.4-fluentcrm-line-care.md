# 4.4 (實作) 結合 FluentCRM：特定顧客行為 (例如：購買高單價商品) 後 LINE 自動化關懷

你好，我是 Moksa 的首席課程導師。

在之前的課程中，我們已經學會了如何使用 FluentCRM 進行基礎的 Email 行銷自動化。今天，我們要將這個能力提升到一個全新的層次，實現一個許多電商經營者夢寐以求的功能：**自動化的 VIP 顧客關懷**。

想像一下，當一位顧客在你的網站上購買了一件高單價的精品，或是一次性消費滿額時，系統不再只是寄出一封制式的訂單確認信，而是在幾分鐘後，透過 LINE 主動發送一則個人化的感謝與關懷訊息。這不僅能大幅提升顧客體驗，更能建立深刻的品牌忠誠度。

這堂課的目標，就是實作這個完整的自動化流程。我們將串接三個強大的工具：
1.  **FluentCRM**：作為我們的大腦，負責判斷「誰」是我們的 VIP 顧客。
2.  **n8n**：作為我們的橋樑，負責接收 FluentCRM 的訊號，並將指令傳遞給 LINE。
3.  **OrderChatz**：作為我們的溝通管道，負責將個人化訊息精準地發送到顧客的 LINE 帳號。

準備好了嗎？讓我們開始打造這個強大的自動化關懷系統吧！

---

### 學習目標

*   學會在 FluentCRM 中，根據顧客的消費行為（購買特定商品、訂單總額）設定觸發條件。
*   學會使用 FluentCRM 的「Outgoing Webhook」功能，將資料傳送到 n8n。
*   學會在 n8n 中建立一個工作流 (Workflow)，接收來自 FluentCRM 的資料。
*   學會使用 n8n 的「HTTP Request」節點，呼叫 OrderChatz 的 API 來發送 LINE 訊息。
*   掌握整個從 WooCommerce -> FluentCRM -> n8n -> OrderChatz 的完整自動化流程。

### 前置準備

在開始之前，請確保你已經完成以下設定：

1.  你的 WordPress 網站已安裝並啟用 **WooCommerce**、**FluentCRM** 以及 **OrderChatz**。
2.  你已經在 OrderChatz 設定中取得了你的 **API 金鑰 (API Key)**。
    *   路徑：WordPress 後台 > WooCommerce > 設定 > OrderChatz > API 設定。
    *   `[截圖]`
3.  你已經擁有一個可以運作的 **n8n** 服務 (雲端版或自行架設皆可)。
4.  顧客在結帳時，有引導他們連結 LINE 帳號的機制 (OrderChatz 的核心功能)。

---

## 流程第一站：在 FluentCRM 設定 VIP 顧客的識別規則

我們的第一步，是要先在網站的大腦 (FluentCRM) 中，定義「什麼樣的顧客行為」需要觸發我們的自動化關懷。

### 步驟 1：建立一個專屬的 VIP 標籤 (Tag)

為了方便管理和識別，我們先建立一個標籤，用來標記這些高價值顧客。

1.  前往 WordPress 後台 > FluentCRM > Contacts > Tags。
2.  點擊右上角的「**Add New Tag**」。
3.  在「**Title**」欄位中，輸入一個好記的名稱，例如 `VIP-高單價顧客`。
4.  點擊「**Add Tag**」按鈕儲存。

`[截圖]`

**Moksa 技巧：** 建立清晰的標籤系統是 CRM 管理的基石。未來你可以針對這個標籤的顧客群，進行更精準的再行銷活動，例如：新品優先體驗、專屬折扣碼等。

### 步驟 2：建立自動化流程 (Automation)

現在，我們要建立一個自動化流程，當顧客完成訂單時，系統會自動檢查訂單內容，如果符合我們的 VIP 條件，就幫顧客貼上剛剛建立的標籤，並發送訊號給 n8n。

1.  前往 WordPress 後台 > FluentCRM > Automations。
2.  點擊右上角的「**Create a New Automation**」。
3.  在觸發器 (Triggers) 區塊，選擇 **WooCommerce** 分類的「**Order Completed**」 (訂單完成時)。
    `[截圖]`
4.  點擊「**Continue**」，進入自動化流程編輯畫面。
5.  為這個自動化流程命名，例如：「高單價商品顧客 LINE 自動關懷」。

### 步驟 3：設定 VIP 判斷條件 (Conditional Action)

這是整個流程的核心邏輯。我們要告訴系統如何判斷這筆訂單是否符合 VIP 資格。

1.  點擊流程中的「+」號圖示，選擇「**Conditional Action**」。
2.  這裡我們有兩種常見的判斷方式：

    **方式一：依據「購買的特定商品」**
    *   在條件設定中，選擇 `WooCommerce` > `Purchased Products`。
    *   條件選擇 `in` (包含)。
    *   在下方的欄位中，搜尋並選擇你的高單價商品。你可以選擇多個。
    *   `[截圖]`

    **方式二：依據「訂單總金額」**
    *   在條件設定中，選擇 `WooCommerce` > `Order Total`。
    *   條件選擇 `Greater Than` (大於)。
    *   在數值欄位中，輸入你定義的 VIP 門檻金額，例如 `5000`。
    *   `[截圖]`

3.  設定完畢後，點擊「**Save Settings**」。

你會看到流程圖中出現了「Yes」和「No」兩個分支。接下來的動作，我們都要設定在「**Yes**」的分支底下。

### 步驟 4：設定「符合條件時」的動作

當顧客的訂單符合我們剛剛設定的條件 (Yes 分支) 時，我們希望系統執行兩個動作：

1.  **貼上 VIP 標籤：**
    *   點擊「Yes」分支下的「+」號。
    *   選擇 `Actions` > `Apply Tag`。
    *   在「**Select Tags**」欄位中，選擇我們在步驟 1 建立的 `VIP-高單價顧客` 標籤。
    *   點擊「**Save Settings**」。
    `[截圖]`

2.  **發送 Webhook 到 n8n：**
    *   再次點擊「Yes」分支下的「+」號 (在 Apply Tag 之後)。
    *   選擇 `Actions` > `Outgoing Webhook`。
    *   在「**Webhook URL**」欄位，我們先暫時留空。**我們需要先到 n8n 取得這個網址**。
    *   請求方法 (Request Method) 維持預設的 `POST`。
    *   請求格式 (Request Format) 維持預設的 `Send as JSON (application/json)`。
    *   請求主體 (Request Body) 維持預設的 `Full Contact Data`，這樣才能把顧客的完整資料傳給 n8n。
    `[截圖]`

到這裡，FluentCRM 的部分暫時告一段落。請保持這個視窗開啟，我們接下來要去 n8n 建立接收器。

---

## 流程第二站：在 n8n 建立串接工作流

n8n 是我們強大的自動化橋樑，它會負責接收來自 FluentCRM 的顧客資料，並轉換成 OrderChatz 看得懂的指令，然後發送出去。

### 步驟 1：建立 Webhook 觸發節點

1.  登入你的 n8n 儀表板，建立一個新的工作流 (Workflow)。
2.  點擊「+」號，在搜尋框中輸入 `Webhook`，並選擇它。
    `[截圖]`
3.  你會看到 Webhook 節點的詳細設定。n8n 已經自動幫你產生了一個獨一無二的網址。
4.  點擊「**Test URL**」旁邊的複製按鈕，將這個網址複製下來。
    `[截圖]`
    **重要觀念：** Webhook URL 分為「Test」和「Production」。在開發測試階段，我們一律使用 Test URL。等到整個流程都確定無誤後，才會換成 Production URL 並正式啟用。

### 步驟 2：回到 FluentCRM，完成 Webhook 設定並發送測試資料

1.  切換回你剛剛停留在 FluentCRM 的自動化設定頁面。
2.  將從 n8n 複製的 **Test URL** 貼到「**Outgoing Webhook**」動作的「**Webhook URL**」欄位中。
3.  點擊「**Save Settings**」儲存。
4.  **現在，我們要發送一筆測試資料給 n8n**。找到一位符合 VIP 條件的聯絡人（例如，你可以手動下一筆測試訂單），然後在這個自動化流程的編輯頁面右上角，點擊「Run Automation on a Contact」，選擇該聯絡人來手動執行一次。
    *   或者，你也可以直接下一筆符合條件的測試訂單來觸發。
5.  執行後，切換回 n8n 的視窗。

### 步驟 3：在 n8n 接收並確認資料

1.  在 n8n 的 Webhook 節點設定中，點擊「**Listen for test event**」按鈕。
2.  如果一切順利，你會看到一個綠色的提示，並且節點右側會顯示剛剛從 FluentCRM 傳來的資料。
    `[截圖]`
3.  點開來檢視，你可以看到完整的顧客資料，包含姓名、Email、WordPress User ID 等等。這代表 FluentCRM 和 n8n 之間的通道已經成功打通！

### 步驟 4：建立 HTTP Request 節點以呼叫 OrderChatz API

這是最後，也是最關鍵的一步：我們要命令 n8n 去呼叫 OrderChatz 的 API，發送 LINE 訊息。

1.  在 n8n 的工作流中，點擊 Webhook 節點右邊的「+」號。
2.  搜尋並選擇「**HTTP Request**」節點。
3.  開始設定這個節點的參數：
    *   **Method:** 選擇 `POST`。
    *   **URL:** 輸入 OrderChatz 的 API 端點。格式為：`https://你的網域名稱/wp-json/order-chatz/v1/send-message`。請務必將「你的網域名稱」換成你自己的網站網址。
    *   **Authentication:** 選擇 `Header Auth`。
    *   **Name:** 輸入 `Authorization`。
    *   **Value:** 輸入 `Bearer ` (注意 Bearer 後面有一個空格)，然後貼上你在 OrderChatz 後台取得的 **API 金鑰**。例如：`Bearer your_api_key_here`。
    *   **Body Content Type:** 選擇 `JSON`。
    *   **Body:** 這裡要填寫我們要發送的資料，格式是 JSON。

4.  點擊「Body」下方的「**Add Expression**」，我們要用 n8n 的表達式來動態填入顧客資料。
5.  在表達式編輯器中，輸入以下 JSON 內容：

    ```json
    {
      "user_id": "{{ $json.body.contact.user_id }}",
      "message": "嗨 {{ $json.body.contact.first_name }}！👋 感謝您選購我們的明星商品！我們已經收到您的訂單，並會以最快的速度為您處理。若有任何疑問，隨時都可以透過這個 LINE 官方帳號與我們聯繫喔！😊"
    }
    ```
    `[截圖]`

    **欄位解釋：**
    *   `user_id`: **(必填)** 顧客的 WordPress User ID。我們使用 `{{ $json.body.contact.user_id }}` 這個表達式，從 Webhook 傳來的資料中動態抓取。這是 OrderChatz 識別要發送給哪位顧客的關鍵。
    *   `message`: **(必填)** 你想要發送的訊息內容。我們同樣可以使用表達式，例如 `{{ $json.body.contact.first_name }}` 來插入顧客的名字，讓訊息更加個人化。

6.  設定完成後，點擊「**Execute node**」來執行一次測試。
7.  檢查你的測試顧客的 LINE，如果收到了這則個人化的關懷訊息，恭喜你！整個自動化流程已經成功串接！

---

## 流程第三站：正式啟用與總結

在確認測試無誤後，我們就可以將整個流程上線。

### 步驟 1：啟用 n8n 工作流

1.  回到 n8n，點擊 Webhook 節點，將 URL 從「**Test**」切換到「**Production**」。
2.  複製新的 **Production URL**。
3.  點擊 n8n 畫面左上角的開關，將工作流從 **Inactive** 切換為 **Active**。
4.  記得點擊右上角的「**Save**」來儲存你的工作流。

### 步驟 2：更新 FluentCRM 的 Webhook URL

1.  回到 FluentCRM 的自動化流程編輯頁面。
2.  點擊「Outgoing Webhook」動作，將裡面的 URL 換成剛剛複製的 n8n **Production URL**。
3.  點擊「**Save Settings**」。

### 步驟 3：啟用 FluentCRM 自動化流程

1.  在 FluentCRM 自動化流程編輯頁面的右上角，將狀態從「**Draft**」改為「**Published**」。

`[截圖]`

大功告成！從現在開始，任何符合你設定的 VIP 條件的顧客，在完成訂單後，系統都會自動地、有溫度地發送一則 LINE 關懷訊息給他們。

### 總結與延伸應用

今天我們完成了一個非常強大的自動化行銷應用。這個流程的核心價值在於「**在對的時間點，用對的管道，對對的人說對的話**」。

*   **對的時間點：** 顧客剛完成一筆高價值消費，內心最充滿期待與滿足感的時候。
*   **對的管道：** 使用台灣滲透率最高的通訊軟體 LINE，確保訊息能被即時看見。
*   **對的人：** 我們的高價值 VIP 顧客。
*   **對的話：** 個人化、有溫度的關懷訊息，而非冰冷的廣告。

**Moksa 技巧與延伸思考：**

*   **增加延遲：** 你可以在 FluentCRM 的 Webhook 動作前，加入一個「Wait X Days/Hours」的動作，讓關懷訊息在訂單完成後的 10 分鐘或 1 小時後再發送，感覺更像真人操作。
*   **多重條件判斷：** 你可以在 n8n 中加入更多判斷邏輯。例如，檢查顧客資料中是否有 LINE User ID，如果沒有，就改走 Email 管道，發送一封特別設計的 VIP 感謝信。
*   **更多觸發時機：** 同樣的邏輯，也可以應用在「顧客生日時自動發送 LINE 祝福與折扣碼」、「顧客會員等級提升時發送恭賀訊息」等各種情境。

這套結合 FluentCRM + n8n + OrderChatz 的自動化系統，將會是你電商事業中最強大的行銷武器之一。請務必親手實作一遍，感受自動化為你帶來的驚人效益！