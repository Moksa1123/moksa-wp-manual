# 02.05 (實務) WordPress Webhooks 介紹：如何讓 WP 事件觸發 n8n 工作流

嗨，歡迎來到 n8n 與 WordPress 協作的實務課程！

在之前的單元中，我們理解了 n8n 的基本概念。現在，我們要來學習一個打通 WordPress 與 n8n 之間任督二脈的關鍵技術：「**Webhook**」。透過 Webhook，我們可以讓 WordPress 在發生特定事件時，**主動**將資料即時傳送到 n8n，進而觸發後續的自動化流程。

---

### 什麼是 Webhook？一個簡單的譬喻

想像一下 API 像是你要主動打電話去問朋友：「有新消息嗎？」你可能要每隔五分鐘打一次，很沒效率。

而 **Webhook 就像是你給朋友一個專屬的對講機**，你跟他說：「嘿，一有新消息，立刻透過這個對講機告訴我！」

在這個譬喻中：
*   **你**：就是 n8n 工作流。
*   **你的朋友**：就是 WordPress/WooCommerce。
*   **新消息**：就是一個「事件 (Event)」，例如「一筆新訂單成立」、「一個新會員註冊」。
*   **專屬的對講機**：就是 Webhook URL，一個獨一無二的網址。

簡單來說，**Webhook 是一種「事件驅動」的 PUSH (推送) 機制**。當 WordPress 端發生了我們設定好的事件，它會立刻將相關資料「推送」到指定的 Webhook URL，而我們的 n8n 就在這個 URL 的另一端等著接收資料。

這種即時、自動的特性，是打造高效自動化流程的基礎。

---

### Part 1: 在 n8n 建立 Webhook 監聽端點

無論你想從哪個 WordPress 外掛接收資料，第一步永遠是在 n8n 建立一個「監聽點」(Listener)，也就是產生那個專屬的 Webhook URL。

**步驟 1：建立新的 n8n 工作流**

*   登入你的 n8n 環境，點擊「Add workflow」建立一個全新的工作流。

**步驟 2：新增 Webhook 觸發節點**

*   在工作流畫布中，點擊 `+` 按鈕。
*   在搜尋框中輸入 `Webhook`，並點選它。這會新增一個 Webhook 觸發節點 (Trigger Node) 到你的畫布上。

``
*截圖：n8n 畫布上新增一個 Webhook 節點。*

**步驟 3：複製 Webhook URL**

*   點擊 Webhook 節點，右側會彈出設定面板。
*   你會看到有 `Test` 和 `Production` 兩種 URL。
*   **Moksa 技巧：** 在開發與測試階段，**永遠先使用 `Test URL`**。`Test URL` 接收到的資料只會保留在當前的瀏覽器頁面中，關閉即消失，非常適合用來除錯。`Production URL` 則是給正式上線的工作流使用。
*   點擊 `Test URL` 旁邊的複製按鈕，將這段網址複製到你的剪貼簿。

``
*截圖：n8n Webhook 節點的設定面板，並醒目標示 Test URL 的複製按鈕。*

**步驟 4：啟動監聽模式**

*   **這是最重要也最容易忘記的一步！** 你必須點擊右下角的「**Listen for Test Event**」按鈕。
*   點擊後，n8n 會開始旋轉並顯示「Waiting for webhook call...」。這表示 n8n 已經準備好，正在這個 URL 上等待接收你從 WordPress 送來的第一次測試資料。

``
*截圖：n8n 節點顯示 "Waiting for webhook call..." 的畫面。*

現在，我們的 n8n 已經準備就緒。接下來，我們回到 WordPress 進行設定。

---

### Part 2: WordPress 實戰 (一)：使用 WooCommerce Webhook

這是電商網站最常見的應用。我們來建立一個情境：**當有新訂單成立時，自動將訂單資料傳送到 n8n。**

**步驟 1：前往 WooCommerce Webhook 設定**

*   登入你的 WordPress 後台。
*   從左側選單前往 `WooCommerce` > `設定` > `進階` > `Webhook`。

``
*截圖：WordPress 後台 WooCommerce Webhook 的設定頁面路徑。*

**步驟 2：新增 Webhook**

*   點擊「**新增 Webhook**」按鈕。
*   你會看到一個設定表單，請依照以下說明填寫：
    *   **名稱 (Name):** 給這個 Webhook 一個好辨識的名字，例如「**n8n - 新訂單通知**」。
    *   **狀態 (Status):** 必須設定為「**啟用 (Active)**」。
    *   **主題 (Topic):** **這是關鍵欄位**。它決定了什麼「事件」會觸發這個 Webhook。我們選擇「**訂單已建立 (Order created)**」。
    *   **傳送網址 (Delivery URL):** **將剛剛從 n8n 複製的 `Test URL` 貼到這裡**。
    *   **密鑰 (Secret):** **Moksa 技巧：** 為了安全性，建議你點擊下方的「產生亂數字串」產生一組密鑰。這個密鑰會跟著資料一起傳送到 n8n，讓 n8n 未來可以驗證這個請求的確是從你的網站發出的，而不是被偽造的。目前我們先產生即可，後續課程會教如何驗證。
    *   **API 版本 (API Version):** 維持預設的「WP REST API Integration v3」即可。

``
*截圖：填寫完整的 WooCommerce Webhook 設定表單。*

**步驟 3：儲存並觸發測試事件**

*   點擊「**儲存 Webhook**」。
*   現在，為了讓 n8n 接收到第一次的資料結構，我們需要實際觸發一次「訂單已建立」事件。
*   請你前往你的網站前台，以顧客身份**實際下一筆測試訂單** (可以使用貨到付款或測試用的金流)。

**步驟 4：在 n8n 檢查接收到的資料**

*   完成下單後，立刻切換回 n8n 的瀏覽器分頁。
*   你會驚喜地發現，「Waiting...」的畫面消失了，取而代之的是一個完整的資料結構 (JSON 格式)，裡面包含了剛剛那筆測試訂單的所有資訊，例如訂單 ID、金額、顧客信箱、商品內容等等。

``
*截圖：n8n Webhook 節點成功接收到 WooCommerce 訂單資料的 JSON 畫面。*

恭喜！你已經成功地將 WooCommerce 和 n8n 連接起來了！

---

### Part 3: WordPress 實戰 (二)：使用 FluentCRM Webhook

Webhook 的應用不僅限於 WooCommerce。在我們的 Moksa 技術棧中，另一個自動化神器 **FluentCRM** 也內建了強大的 Webhook 功能。

我們來建立第二個情境：**當有新的聯絡人被加入到指定的「電子報訂閱者」名單時，自動將他的 Email 和姓名傳送到 n8n。**

**步驟 1：前往 FluentCRM Webhook 設定**

*   回到 WordPress 後台。
*   從左側選單前往 `FluentCRM` > `設定` > `工具` > `外送 Webhooks (Outgoing Webhooks)`。

**步驟 2：新增 Webhook Feed**

*   點擊「**Add New Webhook Feed**」按鈕。
*   填寫設定表單：
    *   **名稱 (Name):** 一樣給它一個好辨識的名字，例如「**n8n - 新電子報訂閱者**」。
    *   **Webhook URL:** 貼上你的 n8n `Test URL` (你可以用同一個，或是在 n8n 開一個新的 Webhook 節點來接收)。
    *   **請求方法 (Request Method):** 選擇 `POST`。
    *   **請求格式 (Request Format):** 選擇 `Send as JSON Data (JSON)`。
    *   **觸發條件 (Trigger on Events):** **這是關鍵**。選擇「**Contact Created**」，並可以進一步新增條件 (Add Condition)，例如 `When contact's lists contains 電子報訂閱者`。
    *   **請求主體 (Request Body):** 這裡可以自訂要傳送的資料欄位。點擊「Add New」，在 `Key` 欄位輸入你想在 n8n 看到的欄位名稱 (如 `email`)，在 `Value` 欄位透過右側的 `@{...}` 短代碼選擇對應的 FluentCRM 聯絡人欄位 (如 `contact.email`)。

``
*截圖：填寫完整的 FluentCRM Webhook 設定畫面，特別是觸發條件和請求主體的設定。*

**步驟 3：儲存並觸發測試事件**

*   點擊「**Save Feed Settings**」。
*   前往 `FluentCRM` > `聯絡人`，手動新增一位測試聯絡人，並務必將他加入到你剛剛設定的「電子報訂閱者」名單中。

**步驟 4：在 n8n 檢查接收到的資料**

*   切換回 n8n 分頁。
*   你會看到 n8n 再次成功接收到資料，但這次的資料結構就不是訂單，而是你剛剛在 FluentCRM 中設定的聯絡人 Email 和姓名。

``
*截圖：n8n 成功接收到來自 FluentCRM 的聯絡人資料 JSON 畫面。*

---

### 總結與重點回顧

今天你學會了自動化流程中最核心的串接技術 — Webhook。

*   **核心觀念：** Webhook 是由 WordPress 端**主動推送 (PUSH)** 資料給 n8n 的即時通知機制。
*   **標準流程：**
    1.  在 n8n 建立 `Webhook` 節點並**啟動監聽模式**。
    2.  複製 `Test URL`。
    3.  回到 WordPress 的外掛 (如 WooCommerce, FluentCRM) 設定中，貼上 URL 並選擇觸發事件。
    4.  實際在 WordPress 觸發一次該事件 (如下訂單、新增聯絡人)。
    5.  回到 n8n 確認已成功接收到資料結構。
*   **Moksa 技巧：**
    *   開發測試時，永遠使用 `Test URL`。
    *   記得為你的 Webhook 加上**密鑰 (Secret)**，增加安全性。
    *   幾乎所有支援自動化的優質外掛，都會提供 Webhook 功能，這是你評估外掛是否強大的指標之一。

現在，我們已經打通了從 WordPress 到 n8n 的資料流。在接下來的課程中，我們將會學習如何利用這些接收到的資料，在 n8n 中執行各種強大的自動化任務！