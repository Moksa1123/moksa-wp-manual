# 4.2 n8n 核心概念與應用場景 (workflow, node, trigger, action)

嗨，歡迎來到 n8n 的世界！

在正式開始串接 WordPress 與 WooCommerce 之前，我們必須先徹底理解 n8n 的四個核心骨幹。如果你曾經接觸過 Zapier 或 Make (前身為 Integromat)，你會發現它們的邏輯非常相似。但 n8n 的優勢在於**開源 (Open-Source)**、**可自架設 (Self-Hosted)**，這代表著更高的彈性、更低的成本，以及**最重要的——你的客戶與訂單資料可以完全掌握在自己手中**。

在這堂課中，我們將會拆解 n8n 的運作原理，並透過幾個 Moksa 實戰棧中常見的應用場景，讓你對 n8n 的強大潛力有更深刻的體會。

---

### 1. Workflow (工作流程)

`Workflow`，或稱「工作流程」，是 n8n 的一切基礎。你可以把它想像成一張**數位畫布**或一份**自動化食譜**。

在這張畫布上，你會擺放各種工具（我們稱之為「節點」），並將它們連接起來，定義一個完整的自動化任務。例如，「當網站有新訂單時，自動發送一則 LINE 通知給老闆，並將訂單資訊寫入 Google Sheets 備份」。這整個從頭到尾的流程，就是一個 Workflow。

*   **核心觀念：** 一個 Workflow 就是一個完整的自動化任務藍圖。
*   **特性：**
    *   每個 Workflow 都有一個**起點** (Trigger)。
    *   它可以是線性的簡單流程，也可以包含複雜的判斷、分支與迴圈。
    *   你可以隨時啟用 (Active) 或停用 (Inactive) 任何一個 Workflow。

``
*(截圖：一個空白的 n8n Workflow 畫布，中間有一個 "Start" 節點)*

---

### 2. Node (節點)

如果說 Workflow 是畫布，那 `Node`（節點）就是你放在畫布上的**積木**或**工具**。每一個節點都負責執行一個**單一、特定的任務**。

n8n 中的節點主要可以分為兩大類：

1.  **Trigger Node (觸發節點):** 每個 Workflow 的**起點**，它負責「監聽」某個事件的發生。
2.  **Action Node (執行節點):** 在觸發之後，負責「執行」一連串動作的節點。

節點之間透過連接線串聯，前一個節點的輸出資料 (Output Data) 會自動傳遞給下一個節點作為輸入資料 (Input Data)。這種資料流動的方式是 n8n 的精髓。

``
*(截圖：一個簡單的 Workflow，包含一個 Webhook 觸發節點，連接到一個 Set 節點，再連接到一個 Slack 節點，展示節點間的串連)*

---

### 3. Trigger (觸發器)

`Trigger`，或稱「觸發器」，是啟動整個自動化流程的**開關**。它會不斷地等待，直到它所設定的條件被滿足，然後才會啟動整個 Workflow。

**Moksa 技巧：** 在 WordPress/WooCommerce 的世界裡，`Webhook` 觸發器是你最萬能的好朋友！

常見的 Trigger 類型包括：

*   **On a schedule (定時觸發):**
    *   **應用場景：** 每天凌晨 3 點，自動去供應商網站抓取庫存資料，並同步到我們的 WooCommerce 網站。
    *   **使用節點：** `Cron`
*   **On an app event (當應用程式事件發生時觸發):**
    *   **應用場景：** 當 WooCommerce 建立一筆**新訂單**時、當 FluentCRM 有**新聯絡人**加入時、當 LearnDash 有學員**完成一門課**時。
    *   **使用節點：** `Webhook` (最常用), 或是一些內建的 App Trigger (如 `Google Form`)。
*   **On a manual run (手動觸發):**
    *   **應用場景：** 在開發與測試階段，我們需要手動執行一次流程來確認資料格式是否正確。
    *   **使用節點：** 點擊畫面上的 `Execute Workflow` 按鈕。

``
*(截圖：n8n 的 Trigger 選擇畫面，特別圈出 Cron 和 Webhook 節點)*

---

### 4. Action (執行動作)

當 Trigger 被觸發後，接下來就輪到 `Action`（執行動作）節點上場了。Action 節點會接收從 Trigger 或前一個節點傳來的資料，並根據你的設定執行特定任務。

它可以是：

*   **資料處理：**
    *   **應用場景：** 從 WooCommerce 來的訂單資料包非常龐大，我們只需要「顧客姓名」和「訂單總額」。可以使用 `Set` 節點來篩選並組合我們需要的資料。
    *   **使用節點：** `Set`, `Function`, `Merge`
*   **邏輯判斷：**
    *   **應用場景：** 如果訂單金額**大於 3000 元**，就發送通知到「大客戶」LINE 群組；否則，就發送到「一般訂單」群組。
    *   **使用節點：** `IF`
*   **與外部服務互動：**
    *   **應用場景：** 這也是 n8n 的最強大的地方！
        *   將訂單資料寫入 `Google Sheets`。
        *   呼叫 `LINE Notify` 或 `OrderChatz` 的 API 發送 LINE 通知。
        *   在 `FluentCRM` 中為顧客貼上「已購商品 A」的標籤。
        *   透過 WordPress REST API 在網站上自動發佈一篇新文章。
    *   **使用節點：** `Google Sheets`, `HTTP Request`, `WordPress`, `WooCommerce`

``
*(截圖：n8n 的 Action 節點選擇畫面，展示各種服務如 Google Sheets, WordPress, Slack, HTTP Request 等)*

---

### 應用場景：將概念組合起來

光說理論可能有點抽象，讓我們來看一個 Moksa 學員最常詢問的經典場景，看看這四個核心概念是如何協同運作的。

#### 場景：新訂單成立時，自動通知 LINE 並記錄到 Google Sheets

**目標：** 當 WooCommerce 有一筆狀態為「處理中」的新訂單時，自動發送一則包含訂單重點資訊的 LINE 通知給管理者，同時將這筆訂單的詳細資料新增到 Google Sheets 的一張工作表中，方便會計人員對帳。

**Workflow 拆解：**

1.  **Trigger (觸發器): `Webhook`**
    *   **設定：** 在 WooCommerce 的「設定 > 進階 > Webhook」中，新增一個 Webhook。
    *   **事件：** `Order Created` (訂單建立時)。
    *   **傳送 URL：** 貼上 n8n Workflow 中 `Webhook` 節點產生的專屬網址。
    *   **啟動條件：** 當有顧客下單並付款成功（訂單狀態通常變為「處理中」），WooCommerce 就會自動把**整包訂單資料** (JSON 格式) 傳送到 n8n。

2.  **Action 1 (執行動作): `Set`**
    *   **任務：** 簡化並重組資料。
    *   **原因：** WooCommerce 傳來的資料欄位非常多，我們在 LINE 通知中並不需要全部。
    *   **設定：**
        *   建立一個新欄位 `line_message`，內容設定為：`「新訂單通知！\n顧客：{{$json["billing"]["first_name"]}} {{$json["billing"]["last_name"]}}\n金額：${{$json["total"]}}\n訂單編號：#{{$json["id"]}}」`
        *   建立 `customer_name`, `order_id`, `order_total` 等欄位，方便下一個節點使用。
    *   **Moksa 技巧：** 這裡的 `{{...}}` 語法是 n8n 用來**引用前面節點資料**的表達式 (Expressions)。這是 n8n 的精髓，務必學會！

3.  **Action 2 (執行動作): `HTTP Request`**
    *   **任務：** 發送 LINE Notify。
    *   **設定：**
        *   **Method:** `POST`
        *   **URL:** `https://notify-api.line.me/api/notify`
        *   **Authentication:** `Header Auth`
        *   **Name:** `Authorization`
        *   **Value:** `Bearer YOUR_LINE_NOTIFY_TOKEN` (你的 LINE Notify 權杖)
        *   **Body Content Type:** `application/x-www-form-urlencoded`
        *   **Body:** `message` = `{{$node["Set"].json["line_message"]}}` (引用上一步 `Set` 節點產生的 `line_message` 內容)

4.  **Action 3 (執行動作): `Google Sheets`**
    *   **任務：** 新增一列資料到指定的 Google Sheet。
    *   **設定：**
        *   **Authentication:** 首次使用需要授權 n8n 存取你的 Google 帳號。
        *   **Operation:** `Append`
        *   **Sheet ID:** 選擇你要寫入的 Google Sheet 檔案。
        *   **Range:** `工作表1`
        *   **Columns:** 將上一步 `Set` 節點準備好的欄位，如 `order_id`, `customer_name`, `order_total` 等，一一對應到 Google Sheet 的欄位中。

``
*(截圖：完整的 WooCommerce -> Set -> HTTP Request (LINE) & Google Sheets 的 n8n Workflow 流程圖)*

---

### 總結

恭喜你！你已經掌握了 n8n 最核心的四個概念：

*   **Workflow (工作流程):** 你的自動化藍圖。
*   **Node (節點):** 執行單一任務的積木。
*   **Trigger (觸發器):** 啟動流程的開關。
*   **Action (執行動作):** 實際執行的任務步驟。

理解了這些，你就擁有了解鎖無窮自動化組合的鑰匙。接下來的課程，我們將會一步步帶你親手實作出更多、更強大的自動化流程，徹底解放你被重複性事務所佔據的寶貴時間！