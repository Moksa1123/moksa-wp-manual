# 09.04 (實務) 網站效能優化 (WP Rocket, Perfmatters)

你好！我是 Moksa 的首席課程導師。在這個章節中，我們將進入網站經營中至關重要的一環——**網站效能優化**。一個載入快速的網站不僅能提供絕佳的使用者體驗，更是影響 SEO 排名與轉換率的關鍵因素。

我們會使用 Moksa 技術棧中最強大的兩款效能優化外掛：**WP Rocket** 和 **Perfmatters**。WP Rocket 像是強大的自動化武器，處理了 80% 的快取與檔案優化問題；而 Perfmatters 則像一把精準的手術刀，讓我們能移除 WordPress 核心與外掛中不必要的「肥肉」，達到極致輕量化。

---

### 課前準備：效能檢測基準

在進行任何優化之前，我們必須先了解網站「現在」的狀況。這就像健康檢查一樣，先有數據，才能對症下藥，並在優化後驗證成效。

*   **工具 1: Google PageSpeed Insights**
    *   網址：[https://pagespeed.web.dev/](https://pagespeed.web.dev/)
    *   重點：評估「**核心網頁體驗指標 (Core Web Vitals)**」，這是 Google SEO 排名的重要參考。
*   **工具 2: GTmetrix**
    *   網址：[https://gtmetrix.com/](https://gtmetrix.com/)
    *   重點：提供瀑布圖 (Waterfall Chart)，讓你清楚看到網站每個元素（圖片、CSS、JS）的載入順序與時間。

**步驟 1：進行首次測速**

1.  打開 Google PageSpeed Insights 和 GTmetrix。
2.  輸入你的網站首頁網址，開始分析。
3.  將分析結果的**分數**、**LCP (最大內容繪製)**、**Total Blocking Time** 等關鍵指標截圖或記錄下來。這將是我們的「**優化前**」數據。

`` [此處應放置 PageSpeed Insights 優化前的分數報告截圖] ``

`` [此處應放置 GTmetrix 優化前的分數報告截圖] ``

---

### Part 1：使用 WP Rocket 進行全站快取與基礎優化

WP Rocket 是一款非常強大且設定簡單的快取外掛。安裝並啟用後，它會自動處理大部分的優化工作。我們只需要針對幾個關鍵選項進行微調。

**前往 WordPress 後台 > 設定 > WP Rocket。**

#### 步驟 1：快取 (Cache)

這是 WP Rocket 的核心功能。它會為你的頁面產生靜態 HTML 檔案，當訪客瀏覽時，伺服器不需重新執行 PHP 和查詢資料庫，直接提供靜態檔案，速度會快上數十倍。

1.  在「**快取**」分頁中，確認「**為行動裝置啟用快取**」已勾選。
2.  「**為登入的使用者啟用快取**」這個選項，對於 WooCommerce 網站來說**非常重要**。
    *   **Moksa 技巧**：如果你的網站有會員系統 (YITH Membership) 或需要使用者登入才能看到特定內容（例如「我的帳號」頁面），**務必勾選此項**。這樣登入的會員也能享受到快取帶來的速度提升，同時確保他們的個人化內容（如購物車、訂單）不會被快取錯亂。

`` [此處應放置 WP Rocket 快取設定頁面的截圖] ``

#### 步驟 2：檔案優化 (File Optimization)

這個分頁處理的是網站的 CSS 與 JavaScript 檔案，是影響載入速度的關鍵。

> **⚠️ 重要提醒：** 此處的設定有機會造成網站版面或功能異常。**每修改一個選項，就務必使用瀏覽器的「無痕模式」去檢查前台網站是否正常運作**。若出現問題，取消勾選剛剛的選項即可恢復。

1.  **CSS 檔案**
    *   勾選「**壓縮 CSS 檔案 (Minify CSS files)**」：移除 CSS 檔案中的空白與註解，減少檔案大小。
    *   **Moksa 技巧**：初學者**請勿輕易勾選**「合併 CSS 檔案 (Combine CSS files)」與「最佳化 CSS 傳遞」。雖然它們效果強大，但也較容易出錯，需要進階的除錯知識。我們先從最安全的「壓縮」開始。

2.  **JavaScript 檔案**
    *   勾選「**壓縮 JavaScript 檔案 (Minify JavaScript files)**」。
    *   勾選「**延遲載入 JavaScript (Load JavaScript deferred)**」：這可以解決 PageSpeed Insights 中常見的「排除禁止轉譯的資源」問題。
    *   勾選「**延遲 JavaScript 執行 (Delay JavaScript execution)**」：這是 WP Rocket 的王牌功能。它會等到使用者有互動（如滾動、點擊）後，才載入非必要的 JS 檔案（如 Facebook Pixel, Google Analytics, LINE Chat）。這對初始載入速度有飛躍性的提升。

`` [此處應放置 WP Rocket 檔案優化設定頁面的截圖] ``

#### 步驟 3：媒體 (Media)

處理圖片與影片的載入方式。

1.  勾選「**為圖片啟用 LazyLoad**」：只有當圖片即將進入訪客的可視範圍時，才會開始載入。
2.  勾選「**為 iframe 和影片啟用 LazyLoad**」：對 YouTube 內嵌影片等特別有效。
3.  **Moksa 技巧**：WP Rocket 的 LazyLoad 已經非常優秀。同時，別忘了我們技術棧中的 **ShortPixel** 外掛，它負責在「上傳時」就將圖片檔案大小壓縮到極致。**ShortPixel (壓縮體積) + WP Rocket LazyLoad (延遲載入) 是圖片優化的黃金組合**。

#### 步驟 4：預先載入 (Preload)

主動告訴瀏覽器預先準備好資源，提升使用者感受到的速度。

1.  啟用「**預先載入快取 (Activate Preloading)**」：當你更新文章或清除快取後，WP Rocket 會自動在背景建立所有頁面的快取，確保第一位訪客也能享受到最快的速度。
2.  啟用「**預先載入連結 (Enable link preloading)**」：當使用者的滑鼠游標停留在一個連結上超過 100ms，WP Rocket 就會判斷他「可能」會點擊，並在背景預先下載該頁面。

---

### Part 2：使用 Perfmatters 進行精準減法優化

如果說 WP Rocket 是「加法優化」，那 Perfmatters 就是「減法哲學」。它透過關閉 WordPress 中許多你可能永遠用不到的功能，來減少 HTTP 請求和程式碼執行，讓網站變得更輕盈。

**前往 WordPress 後台 > 設定 > Perfmatters。**

#### 步驟 1：停用不必要的核心功能

在「**一般 (General)**」分頁中，你可以關閉很多預設開啟但非必要的功能。

**Moksa 推薦停用項目：**

*   **停用 Emojis**：除非你的文章內容真的需要顯示原生表情符號，否則這會載入一支不必要的 JS 檔案。
*   **停用 Dashicons**：如果你的前台沒有任何功能需要使用後台圖示（通常不會），可以為未登入的使用者停用。
*   **停用 Embeds**：停用讓你可以輕鬆貼上 YouTube 網址就自動轉成影片的功能。停用後你仍然可以用內嵌程式碼的方式加入影片。
*   **停用 XML-RPC**：這是一個舊的遠端發布協定，現在大多被 REST API 取代，且有安全疑慮。
*   **停用 RSS Feeds**：如果你的網站沒有提供 RSS 訂閱功能。
*   **移除 jQuery Migrate**：許多較舊的外掛需要它，但如果你的網站外掛都很新，可以嘗試停用。

`` [此處應放置 Perfmatters 一般設定頁面的截圖] ``

#### 步驟 2：使用 Script Manager (資源管理員)

這是 Perfmatters 最強大的功能，也是它被稱為「手術刀」的原因。**它可以讓你精準地控制哪個頁面需要載入哪個外掛的 CSS 和 JS 檔案**。

**實務情境：**
假設你的網站只有「聯絡我們」頁面使用了「Contact Form 7」這個表單外掛。但預設情況下，Contact Form 7 的 CSS 和 JS 檔案會在**每一個頁面**都載入，造成了浪費。

**操作流程：**

1.  在 Perfmatters 設定中，找到「**Assets**」分頁，啟用「**Script Manager (資源管理員)**」。
2.  儲存設定後，回到網站**前台**，你會在上方管理列看到一個新的「**Script Manager**」按鈕。

    `` [此處應放置 前台頂部管理列 Script Manager 按鈕的截圖] ``

3.  點擊它，一個面板會滑出，列出這個頁面載入的所有 CSS 和 JS 檔案，並清楚地歸類於它們各自的外掛或主題。

    `` [此處應放置 Script Manager 操作介面的截圖] ``

4.  **Moksa 技巧 (SOP)**：
    *   **目標**：讓 Contact Form 7 的資源只在「聯絡我們」頁面載入。
    *   **步驟 A**：隨意瀏覽一個**沒有**聯絡表單的頁面（例如：首頁）。
    *   **步驟 B**：打開 Script Manager，找到 `contact-form-7` 的區塊。
    *   **步驟 C**：將其狀態從「On」切換為「**Off**」。
    *   **步驟 D**：在停用選項中，選擇「**Everywhere (隨處)**」。這代表「預設在所有地方都停用這個外掛的資源」。
    *   **步驟 E**：在下方的「**Add Exception (新增例外)**」中，選擇「**Current URL**」或「**Post ID**」，並指定你的「聯絡我們」頁面。
    *   **步驟 F**：儲存設定。

現在，`contact-form-7` 的檔案就只會在你指定的「聯絡我們」頁面載入，其他頁面都變得更乾淨、更快了！你可以用同樣的邏輯去處理其他只在特定頁面使用的外掛，例如：社群分享按鈕、圖片輪播外掛等。

---

### Part 3：驗證成果與持續維護

完成以上 WP Rocket 和 Perfmatters 的設定後，是時候驗收我們的成果了。

**步驟 1：清除所有快取**

*   在 WordPress 頂部管理列，找到「WP Rocket」選單，點擊「**清除快取 (Clear cache)**」。

**步驟 2：重新進行測速**

1.  再次打開 Google PageSpeed Insights 和 GTmetrix。
2.  **務必使用無痕模式**來訪問你的網站，確保看到的是訪客視角的快取版本。
3.  重新輸入你的網址進行分析。
4.  比較「**優化後**」的數據與我們一開始記錄的「**優化前**」數據。

你應該會看到分數顯著提升，LCP 時間大幅縮短，網站的載入速度有感變快！

`` [此處應放置 PageSpeed Insights 優化後的分數報告截圖，與優化前對比] ``

**結論與最佳實踐：**

*   **效能優化是一個持續的過程**，而非一次性的任務。每次安裝新外掛或新增內容後，都應該重新檢視效能。
*   **優質主機是速度的基石**。再強大的優化外掛，也無法彌補主機硬體與網路環境的不足。
*   **選擇輕量化的主題**，例如我們技術棧中的 Kadence，能從根本上減少不必要的程式碼。
*   **定期使用 WP Rocket 的「資料庫」工具**，清理文章修訂、垃圾留言等，保持資料庫的健康。

恭喜你完成了網站效能優化的重要一步！一個快速的網站將為你的事業帶來長遠的價值。