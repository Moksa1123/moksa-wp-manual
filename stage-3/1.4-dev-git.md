# 01.04 (實務) 版本控制 (Git) 與 GitHub 流程

嗨，歡迎來到 Moksa 開發課程的核心章節之一！在這一堂課，我們要學習的是現代化網站開發的基石——**版本控制 (Version Control)**。具體來說，我們會專注在 **Git** 這套系統以及 **GitHub** 這個雲端平台。

學會 Git，就像是為你的程式碼買了最高級的保險，同時也獲得了穿越時空的超能力。你再也不用擔心「糟糕，昨天網站還好好的，今天改壞了怎麼辦？」或是用 `project-final.zip`, `project-final-v2.zip`, `project-真的-final.zip` 這種混亂的方式來管理專案了。

在本章節，我們將從觀念建立開始，一步步帶你走過一個**符合業界標準的 WordPress 外掛開發流程**。

---

### 為什麼 WordPress 開發者需要 Git？

在開始實作前，讓我們先建立共識。為什麼這項技能如此重要？

1.  **追蹤與還原：** Git 會記錄你每一次對程式碼的修改。你可以輕易地查看歷史紀錄，比較不同版本間的差異，並在需要時，瞬間將專案「還原」到過去任何一個健康的狀態。
2.  **團隊協作：** 當多位工程師同時開發一個專案時，Git 可以優雅地處理程式碼的合併，避免大家互相覆蓋對方的成果。
3.  **分支開發 (Branching)：** 你可以在不影響主要穩定版本 (通常是 `main` 或 `master` 分支) 的情況下，開一個「分支」來開發新功能或修復 Bug。完成後，再安全地將它合併回主線。
4.  **程式碼託管與備份：** 透過 GitHub 或其他類似平台 (GitLab, Bitbucket)，你的程式碼不僅有了一個雲端備份，更是一個展示你技術實力的作品集。
5.  **自動化部署 (CI/CD)：** 這是比較進階的應用，但 Git 是實現自動化測試與部署流程 (CI/CD) 的基礎。當你將程式碼推送到特定分支時，可以觸發自動化腳本，將網站更新到測試機或正式機。

### 核心觀念速覽

*   **Git：** 一套「分散式版本控制系統」，是你安裝在電腦本機上的**軟體**。
*   **GitHub：** 一個「雲端平台」，主要用來託管 Git 倉庫，可以把它想像成是**存放你 Git 專案的雲端硬碟**，但多了更多協作功能。
*   **倉庫 (Repository / Repo)：** 就是你的「專案資料夾」。裡面包含了你的所有程式碼以及 `.git` 這個隱藏資料夾，後者儲存了所有的版本歷史紀錄。
*   **提交 (Commit)：** 代表一次「存檔」。每次你完成一個小任務，就應該進行一次 Commit，並寫下清楚的訊息，說明這次存檔做了什麼事。這是 Git 最基本的單位。
*   **分支 (Branch)：** 專案的「分身」。你可以建立不同的分支來處理不同的任務，而不會互相干擾。
*   **合併 (Merge)：** 將一個分支的修改內容，合併到另一個分支的過程。
*   **拉取請求 (Pull Request / PR)：** 在 GitHub 上的核心協作功能。當你在一個分支上完成了開發，你可以發起一個 PR，請求專案的擁有者或其他同事來檢視 (Code Review) 你的程式碼，確認沒問題後再合併到主分支。

---

### 實務流程：從零開始建立一個外掛專案

接下來，我們將模擬一個完整的開發流程：在你的 `LocalWP` 環境中建立一個新的 WordPress 外掛，並使用 Git 與 GitHub 來管理它。

#### 前置準備

1.  **安裝 Git：** 請確保你的電腦已經安裝了 Git。打開你的終端機 (Terminal / PowerShell / VS Code 內建終端機) 輸入 `git --version`，如果看到版本號，代表已安裝。
2.  **註冊 GitHub 帳號：** 前往 [GitHub](https://github.com/) 註冊一個免費帳號。
3.  **安裝 VS Code：** 我們強烈推薦使用 `Visual Studio Code` 作為你的程式碼編輯器，它與 Git 有非常好的整合。
4.  **準備 LocalWP 站點：** 確保你有一個用於開發的 LocalWP 站點正在運行。

#### 步驟 1：在 GitHub 建立一個新的倉庫 (Repository)

首先，我們要為新外掛在雲端建立一個家。

1.  登入 GitHub，點擊右上角的 `+` 號，選擇 `New repository`。
2.  **Repository name:** 輸入你的外掛名稱，例如 `moksa-simple-shortcode`。
3.  **Description:** 簡單描述這個外掛的功能。
4.  **權限：** 選擇 `Private`。**Moksa 技巧：** 除非是開源專案，否則所有客戶或公司的專案都應該設為 **Private (私人)**，以保護程式碼資產。
5.  **Initialize this repository with:** **不要勾選**任何項目。我們要從本機建立專案再推送上來。
6.  點擊 `Create repository`。

``

建立完成後，你會看到一個頁面，上面有一些指令教學。先放著備用。

#### 步驟 2：在本機建立外掛並初始化 Git

現在，回到你的電腦。

1.  使用 VS Code 打開你在 `LocalWP` 中網站的資料夾。
2.  導航到外掛目錄：`.../app/public/wp-content/plugins/`。
3.  建立一個新的資料夾，名稱與你的 GitHub 倉庫相同，例如 `moksa-simple-shortcode`。
4.  在 `moksa-simple-shortcode` 資料夾內，建立一個主要的 PHP 檔案，例如 `moksa-simple-shortcode.php`。
5.  在 PHP 檔案中，填寫 WordPress 外掛的標準檔頭資訊：

    ```php
    <?php
    /**
     * Plugin Name:       Moksa Simple Shortcode
     * Plugin URI:        https://moksaweb.com
     * Description:       一個用於教學 Git 流程的簡單短碼外掛。
     * Version:           1.0.0
     * Author:            Moksa Web
     * Author URI:        https://moksaweb.com
     * License:           GPL v2 or later
     * License URI:       https://www.gnu.org/licenses/gpl-2.0.html
     * Text Domain:       moksa-simple-shortcode
     */
    
    // Your code starts here.
    ```

6.  打開 VS Code 的內建終端機 (`Terminal` > `New Terminal`)，並確認路徑是在你的外掛資料夾底下。
7.  輸入以下指令，初始化 Git 倉庫：

    ```bash
    git init
    ```

    這個指令會在你的資料夾中建立一個隱藏的 `.git` 資料夾，從此刻起，Git 就開始追蹤這個專案了。

#### 步驟 3：第一次提交 (First Commit)

我們已經有了第一個檔案，現在該把它存到 Git 的歷史紀錄中了。

1.  在終端機輸入 `git status`，你會看到 `moksa-simple-shortcode.php` 是一個 "Untracked file"。
2.  將這個檔案加入到 Git 的「暫存區 (Staging Area)」。

    ```bash
    # 加入所有變更的檔案
    git add .
    ```

3.  進行提交 (Commit)，並附上本次修改的說明訊息。

    ```bash
    git commit -m "Initial commit: Add plugin header file"
    ```

    **Moksa 技巧：** 一個好的 Commit Message 非常重要！它應該簡潔明瞭地說明「這次提交做了什麼」。業界常用的格式是：`類型: 描述`，例如 `feat: Add user login functionality` 或 `fix: Correct calculation error in checkout`。

#### 步驟 4：連接到 GitHub 並推送程式碼

現在，我們要將本機的 Git 倉庫與我們在步驟 1 建立的 GitHub 雲端倉庫連接起來。

1.  回到 GitHub 的倉庫頁面，複製 "…or push an existing repository from the command line" 下方的指令。通常會是三行。

    ``

2.  在你的 VS Code 終端機中，貼上並執行這三行指令：

    ```bash
    # 1. 將遠端倉庫的網址命名為 origin (這是一個慣例)
    git remote add origin https://github.com/YourUsername/moksa-simple-shortcode.git
    
    # 2. 將預設的 master 分支更名為 main (這是目前的主流作法)
    git branch -M main
    
    # 3. 將 main 分支的內容推送到 origin (也就是 GitHub)
    git push -u origin main
    ```

3.  執行後，終端機可能會要求你登入 GitHub。完成後，回到 GitHub 頁面重新整理，你會驚喜地發現你的程式碼已經成功上傳了！

#### 步驟 5：專業開發流程 - 使用分支 (Branch)

**Moksa 技巧：** **永遠不要直接在 `main` 分支上寫程式碼！** `main` 分支應該永遠保持在一個穩定、可部署的狀態。所有的新功能或修復，都應該在新的「功能分支 (Feature Branch)」上進行。

假設我們現在要新增一個短碼 (shortcode) 的功能。

1.  在本機，從 `main` 分支建立並切換到一個新的分支。分支名稱要有意義。

    ```bash
    # 建立一個名為 feature/add-hello-shortcode 的分支，並立即切換過去
    git checkout -b feature/add-hello-shortcode
    ```

2.  現在，你就像在一個平行時空中，可以自由地修改程式碼，而不會影響到 `main` 分支。打開 `moksa-simple-shortcode.php`，加入短碼的程式碼：

    ```php
    // ... (檔頭資訊之後)
    
    if ( ! defined( 'ABSPATH' ) ) {
        exit; // Exit if accessed directly.
    }
    
    function moksa_hello_shortcode_handler() {
        return "<h2>Hello from Moksa!</h2>";
    }
    add_shortcode( 'moksa_hello', 'moksa_hello_shortcode_handler' );
    ```

3.  完成功能後，跟之前一樣，進行 `add` 和 `commit`。

    ```bash
    git status
    git add .
    git commit -m "feat: Add [moksa_hello] shortcode"
    ```

4.  將這個**新的分支**推送到 GitHub。

    ```bash
    git push origin feature/add-hello-shortcode
    ```

#### 步驟 6：發起拉取請求 (Pull Request) 並合併

1.  推播成功後，回到 GitHub 倉庫頁面，你會看到一個黃色的提示框，邀請你為剛剛推送的分支建立一個 Pull Request。

    ``

2.  點擊 `Compare & pull request` 按鈕。
3.  給這個 PR 一個清楚的標題和描述，說明你完成了什麼功能。
4.  在真實的團隊協作中，這時候你會邀請同事來 `Review` 你的程式碼。但現在是個人練習，我們可以自己繼續。
5.  點擊 `Create pull request`。

    ``

6.  在 PR 頁面，你可以看到所有程式碼的變更。確認無誤後，點擊 `Merge pull request`，然後再點擊 `Confirm merge`。

    ``

7.  恭喜！你已經成功將新功能安全地合併回 `main` 分支了。GitHub 還會提示你可以刪除已經合併的功能分支，這是一個好習慣。

#### 步驟 7：同步本機程式碼

最後一步，雲端的 `main` 分支已經更新了，但你本機的 `main` 分支還是舊的。我們需要把它同步回來。

1.  切換回你本機的 `main` 分支。

    ```bash
    git checkout main
    ```

2.  從遠端 (`origin`) 拉取 (`pull`) 最新的程式碼。

    ```bash
    git pull origin main
    ```

現在，你本機的 `main` 分支也包含了剛剛開發的短碼功能，整個開發循環就此完成！

### 總結

今天我們學習了業界開發者每天都在使用的 Git 與 GitHub 標準流程：

1.  **在 GitHub 建立遠端倉庫。**
2.  **在本機初始化 Git 專案並進行首次提交。**
3.  **將本機專案連接並推送到 GitHub。**
4.  **為了開發新功能，建立並切換到一個新的`功能分支`。**
5.  **在分支上完成開發並`提交`。**
6.  **將分支`推送`到 GitHub。**
7.  **在 GitHub 上發起 `Pull Request` 進行審查與討論。**
8.  **將 PR `合併`回 `main` 分支。**
9.  **回到本機，切換回 `main` 分支並`拉取`最新的程式碼。**

這個流程確保了你的主幹程式碼永遠是穩定的，所有的開發都在獨立的環境中進行，並且每一次的變更都有跡可循。請務必多加練習，將它內化成你的開發習慣！