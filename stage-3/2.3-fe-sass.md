# 02.03 SASS/SCSS (變數、Mixin、編譯)

嗨，歡迎來到 MoksaWP 開發課程！在前面的章節中，我們已經學會了 CSS 的基礎。然而，當專案規模變大時，例如開發一個功能複雜的佈景主題或外掛，單純使用 CSS 會變得難以維護、充滿重複的程式碼。

為了解決這個問題，前端開發社群創造了「**CSS 預處理器 (Preprocessor)**」，而 **SASS/SCSS** 正是其中最受歡迎、功能也最強大的一種。本章節，我們將帶你深入了解 SASS/SCSS 的核心觀念，並學會如何將它整合到我們的 WordPress 開發流程中。

---

### 1. 什麼是 SASS/SCSS？為什麼要用它？

**SASS (Syntactically Awesome Style Sheets)** 是一種 CSS 擴充語言，它讓你可以使用變數、巢狀規則、Mixin 等在傳統 CSS 中不存在的功能。這些功能可以大幅提升你的開發效率與程式碼的可維護性。

**SASS vs. SCSS**
SASS 有兩種語法格式：

1.  **SASS (舊式語法):** 使用「縮排」來區分程式碼區塊，不使用大括號 `{}` 和分號 `;`。
2.  **SCSS (Sassy CSS):** 這是目前的主流語法。它**完全相容**於標準的 CSS 語法，只是在 CSS 的基礎上增加了 SASS 的擴充功能。這代表任何有效的 CSS 檔案，本身就是一個有效的 SCSS 檔案。

> **Moksa 技巧：** 在 Moksa 的開發流程中，我們**一律推薦使用 SCSS 語法**。因為它更接近我們熟悉的 CSS，學習曲線更平緩，也更容易將現有的 CSS 專案逐步遷移過來。

**為什麼 WordPress 開發者需要 SASS/SCSS？**

*   **程式碼可維護性：** 使用**變數 (Variables)** 來管理顏色、字體大小等全域設定。未來需要修改網站主色調時，只需改動一個變數即可。
*   **減少重複程式碼：** 使用**混入 (Mixin)** 來建立可重複使用的樣式碼塊，例如 RWD 斷點、按鈕樣式等。
*   **結構化與可讀性：** 使用**巢狀 (Nesting)** 語法，讓你的樣式表結構能像 HTML 一樣清晰。
*   **模組化開發：** 可以將 SCSS 檔案拆分成多個小檔案（例如：`_variables.scss`, `_header.scss`, `_footer.scss`），最後再統一匯入編譯，讓專案結構更有條理。

---

### 2. (實作) 設定 SASS 開發環境

瀏覽器本身是看不懂 SCSS 語法的，它只看得懂標準的 CSS。因此，我們需要一個「**編譯器 (Compiler)**」將 `.scss` 檔案轉換成瀏覽器看得懂的 `.css` 檔案。

在 Moksa 的開發工具棧中，我們推薦使用 **VS Code** 搭配擴充功能來進行即時編譯，這是最快也最方便的方式。

**步驟 1：安裝 VS Code 擴充功能「Live Sass Compiler」**

1.  打開你的 VS Code。
2.  點擊左側邊欄的「擴充功能」圖示 (Extensions)。
3.  在搜尋框中輸入 `Live Sass Compiler`。
4.  找到由 `ritwickdey` 開發的擴充功能，點擊「安裝 (Install)」。

``

**步驟 2：建立專案檔案結構**

在你的佈景主題或外掛資料夾中，建立一個推薦的結構，將原始碼與編譯後的檔案分開。

```
/your-theme
|-- /assets
|   |-- /css          <-- 編譯後產生的 .css 檔案會放在這裡
|   |   |-- style.css
|   |   `-- style.css.map
|   |-- /scss         <-- 你的 .scss 原始碼會放在這裡
|   |   `-- style.scss
|-- functions.php
|-- index.php
`-- style.css         <-- WordPress 佈景主題的資訊檔
```

**步驟 3：設定 Live Sass Compiler 編譯路徑**

預設情況下，`Live Sass Compiler` 會在 `.scss` 檔案的同層目錄產生 `.css` 檔案。我們需要修改設定，讓它將編譯後的檔案輸出到我們指定的 `/assets/css` 資料夾。

1.  在 VS Code 中，點擊左下角的齒輪圖示，選擇「設定 (Settings)」。
2.  在搜尋框中輸入 `live sass compile settings`。
3.  找到 `Live Sass Compile: Settings: Formats` 這個選項，點擊 `在 settings.json 中編輯`。
4.  將下方的 JSON 設定貼入你的 `settings.json` 檔案中。

```json
{
    // ... 你其他的 VS Code 設定 ...

    "liveSassCompile.settings.formats": [
        {
            "format": "expanded", // 編譯出的 CSS 格式，可讀性較高
            "extensionName": ".css",
            "savePath": "/assets/css" // 指定輸出路徑
        },
        // 你也可以增加一個壓縮格式用於正式上線環境
        {
            "format": "compressed", // 壓縮格式，移除所有空格，檔案最小
            "extensionName": ".min.css",
            "savePath": "/assets/css"
        }
    ],
    // 預設關閉編譯時產生 map 檔，需要時再開啟
    "liveSassCompile.settings.generateMap": false
}
```

> **重要觀念：** 設定完成後，你只需要專注於撰寫 `.scss` 檔案。VS Code 會在背景自動幫你完成編譯工作。**絕對不要**手動去編輯編譯出來的 `.css` 檔案，因為你做的任何修改都會在下一次編譯時被覆蓋掉。

---

### 3. SASS/SCSS 核心語法詳解

接下來，我們來學習 SCSS 最重要也最常用的三個核心功能。

#### 3.1 變數 (Variables)

變數讓我們可以儲存和重複使用資訊，例如顏色、字型、間距等。變數以 `$` 符號開頭。

**範例：定義網站的品牌色**

打開你的 `style.scss` 檔案，輸入以下內容：

```scss
// style.scss

// 1. 定義變數
$primary-color: #D64242; // Moksa 品牌紅色
$secondary-color: #333;
$text-color: #555;
$font-stack: 'Helvetica Neue', Helvetica, Arial, sans-serif;

// 2. 使用變數
body {
  font-family: $font-stack;
  color: $text-color;
}

h1, h2, h3 {
  color: $secondary-color;
}

a {
  color: $primary-color;
  &:hover {
    color: darken($primary-color, 10%); // SASS 內建函式，將顏色加深 10%
  }
}
```

**Moksa 技巧：** 將所有全域變數集中管理在一個獨立的檔案（例如 `_variables.scss`），然後在主檔案中引入。這樣可以讓你的專案結構更加清晰。

#### 3.2 巢狀 (Nesting)

巢狀可以讓你用類似 HTML 的結構來撰寫 CSS 選擇器，大幅提升可讀性。

**傳統 CSS 的寫法：**

```css
nav {
  background: #f2f2f2;
}
nav ul {
  list-style: none;
  margin: 0;
  padding: 0;
}
nav ul li {
  display: inline-block;
}
nav ul li a {
  display: block;
  padding: 10px 15px;
  text-decoration: none;
}
```

**使用 SCSS 巢狀的寫法：**

```scss
// style.scss

nav {
  background: #f2f2f2;

  ul {
    list-style: none;
    margin: 0;
    padding: 0;

    li {
      display: inline-block;

      a {
        display: block;
        padding: 10px 15px;
        text-decoration: none;
        color: $primary-color; // 也可以使用上面定義的變數

        // `&` 符號代表父選擇器 (在此是 a)
        &:hover {
          background: #e0e0e0;
        }
      }
    }
  }
}
```

可以看到，SCSS 的寫法在結構上清晰非常多，也減少了選擇器的重複撰寫。

#### 3.3 混入 (Mixin)

**Mixin** 就像是一個可以重複使用的「函式」，讓你定義一組 CSS 宣告，然後在需要的地方引入。這對於處理 RWD 斷點、跨瀏覽器前綴 (Vendor Prefixes) 等重複性高的樣式非常有用。

使用 `@mixin` 來定義，使用 `@include` 來引入。

**範例：建立一個 RWD 斷點的 Mixin**

```scss
// style.scss

// 1. 定義一個名為 responsive 的 Mixin，它接受一個參數 $breakpoint
@mixin responsive($breakpoint) {
  @if $breakpoint == tablet {
    @media (max-width: 768px) { @content; }
  }
  @else if $breakpoint == mobile {
    @media (max-width: 480px) { @content; }
  }
}

// 2. 在需要的地方使用 @include 來呼叫 Mixin
.container {
  width: 1140px;
  margin: 0 auto;

  // 當螢幕寬度 <= 768px 時，套用此區塊內的樣式
  @include responsive(tablet) {
    width: 90%;
  }
}

.sidebar {
  width: 30%;
  float: left;

  // 當螢幕寬度 <= 768px 時，套用此區塊內的樣式
  @include responsive(tablet) {
    width: 100%;
    float: none;
  }
}
```

這個 Mixin 大幅簡化了撰寫媒體查詢 (Media Query) 的複雜度，讓程式碼變得語意化且易於管理。

---

### 4. (實作) 啟動編譯並查看結果

現在，讓我們把前面學到的東西串起來，實際進行編譯。

**步驟 1：啟動 Live Sass Compiler**

1.  確認你正在編輯 `.scss` 檔案 (例如 `style.scss`)。
2.  看到 VS Code 右下角的狀態列有一個「**Watch Sass**」按鈕。
3.  點擊它！

``

點擊後，你會在 VS Code 的「輸出 (OUTPUT)」面板看到編譯成功的訊息。同時，`Live Sass Compiler` 會開始「監聽」你對所有 `.scss` 檔案的變更。

**步驟 2：檢查編譯後的 CSS 檔案**

前往你設定的輸出路徑 `/assets/css/`，你會發現多了一個 `style.css` 檔案。打開它看看：

```css
/* assets/css/style.css - 這是自動產生的檔案，請勿直接編輯！ */

body {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  color: #555;
}

h1, h2, h3 {
  color: #333;
}

a {
  color: #D64242;
}
a:hover {
  color: #b42a2a;
}

nav {
  background: #f2f2f2;
}
nav ul {
  list-style: none;
  margin: 0;
  padding: 0;
}
nav ul li {
  display: inline-block;
}
nav ul li a {
  display: block;
  padding: 10px 15px;
  text-decoration: none;
  color: #D64242;
}
nav ul li a:hover {
  background: #e0e0e0;
}

.container {
  width: 1140px;
  margin: 0 auto;
}
@media (max-width: 768px) {
  .container {
    width: 90%;
  }
}

.sidebar {
  width: 30%;
  float: left;
}
@media (max-width: 768px) {
  .sidebar {
    width: 100%;
    float: none;
  }
}
```

你可以看到，我們在 `style.scss` 中寫的變數、巢狀、Mixin 都被正確地編譯成了標準的 CSS 語法。

**步驟 3：在 WordPress 中引入 CSS**

最後，你只需要在佈景主題的 `functions.php` 中，使用 `wp_enqueue_style()` 來載入**編譯後**的 `style.css` 檔案即可。

```php
// functions.php

function moksa_enqueue_styles() {
    // 載入編譯後的 CSS 檔案
    wp_enqueue_style( 'moksa-main-style', get_template_directory_uri() . '/assets/css/style.css', array(), '1.0.0' );
}
add_action( 'wp_enqueue_scripts', 'moksa_enqueue_styles' );
```

---

### 總結

恭喜你！你已經掌握了 SASS/SCSS 最核心的三大功能：**變數、巢狀與 Mixin**，並且學會了如何設定一個自動化的編譯環境。

從現在開始，你的 CSS 開發工作流程將會是：

1.  **專注於撰寫 `.scss` 檔案。**
2.  儲存檔案時，**Live Sass Compiler 會自動幫你編譯成 `.css` 檔案。**
3.  WordPress 永遠只載入**編譯後的 `.css` 檔案**。

這個現代化的開發流程將會為你接下來的佈景主題與外掛開發工作，帶來前所未有的效率與樂趣。在後續的課程中，我們將會更深入地探討 SASS 的進階功能，例如 `@import`, `@extend` 以及模組化管理。