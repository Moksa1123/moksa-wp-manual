# 03.02 PHP 與 HTML 混編 (模板語法)

歡迎來到佈景主題與外掛開發的第二個核心章節。在上個單元，我們對 PHP 的基礎語法有了初步的認識。現在，我們要來學習一個在 WordPress 開發中最重要、也最常見的技巧：**如何將 PHP 程式碼與 HTML 結構完美地結合在一起**。

這種混編技術，我們通常稱之為「模板語法」(Templating Syntax)，是所有 WordPress 佈景主題的基石。學會它，你才能讓靜態的網頁「活」起來，動態地顯示來自資料庫的文章、商品或其他內容。

---

### 核心觀念：伺服器如何處理 PHP 檔案

在我們開始寫程式碼之前，你必須先理解一個**至關重要的觀念**：當使用者瀏覽你的網站時，伺服器是怎麼處理一個 `.php` 檔案的。

1.  **瀏覽器發出請求：** 使用者在瀏覽器輸入網址，向你的網站伺服器發出請求。
2.  **伺服器找到 `.php` 檔案：** 伺服器找到對應的檔案，例如 `index.php`。
3.  **PHP 直譯器執行：** 伺服器並**不會**直接把 `.php` 檔案傳給瀏覽器。相反地，它會先讓 PHP 直譯器 (PHP Interpreter) 執行檔案中所有被 `<?php ... ?>` 標籤包起來的程式碼。
4.  **動態生成 HTML：** PHP 程式碼執行的結果（例如，從資料庫抓取文章標題）會被輸出，並與檔案中原有的 HTML 程式碼合併，最終生成一份**純粹的、靜態的 HTML 文件**。
5.  **回傳 HTML 給瀏覽器：** 伺服器將這份完全處理過的 HTML 文件回傳給使用者的瀏覽器。
6.  **瀏覽器渲染畫面：** 瀏覽器只會收到 HTML、CSS 和 JavaScript，它**完全不知道**背後有 PHP 的存在。這就是為什麼你在任何網站上「右鍵 -> 檢視原始碼」都看不到任何 PHP 程式碼的原因。

``
*（示意圖：一個流程圖，顯示從「瀏覽器請求」到「伺服器處理 PHP」再到「回傳 HTML」的完整過程）*

---

### PHP 語法的基本嵌入方式

要在 HTML 中嵌入 PHP，我們主要使用一組特殊的標籤，告訴伺服器：「嗨！這段是 PHP 程式碼，請幫我執行它！」

#### 1. 標準標籤 `<?php ... ?>`

這是最標準、最常見的寫法。所有寫在 `<?php` 和 `?>` 之間的內容都會被視為 PHP 程式碼。

**範例：**

```html
<!DOCTYPE html>
<html>
<head>
    <title>我的第一個混編頁面</title>
</head>
<body>
    <h1>這是一段靜態的 HTML 標題</h1>
    <p>
        <?php
            // 這裡是 PHP 程式碼區塊
            echo "Hello, Moksa! 這段文字是由 PHP 產生的。";
        ?>
    </p>
    <p>
        今天是：
        <?php
            echo date('Y-m-d H:i:s'); // 使用 PHP 的 date() 函式來顯示當前時間
        ?>
    </p>
</body>
</html>
```

在上面的範例中，`<h1>` 是純 HTML，而 `<p>` 標籤內的文字則是由 `echo` 這個 PHP 指令動態生成的。

#### 2. 短輸出標籤 `<?= ... ?>`

當你只是想簡單地「輸出」一個變數或函式回傳值的內容時，可以使用這個更簡潔的語法。`<?= $variable; ?>` 完全等同於 `<?php echo $variable; ?>`。

**Moksa 技巧：** 在 WordPress 佈景主題開發中，為了讓模板檔案更乾淨、更易讀，**我們強烈推薦在單純輸出的情境下使用短輸出標籤**。

**範例：**

```php
<?php
    $site_title = "Moksa 開發者課程";
?>

<!DOCTYPE html>
<html>
<head>
    <title><?= $site_title; ?></title> <!-- 使用短標籤輸出標題 -->
</head>
<body>
    <h1>歡迎來到 <?= $site_title; ?></h1> <!-- 也可用於內文 -->
</body>
</html>
```

---

### 實戰演練：修改 WordPress 佈景主題模板

現在，讓我們實際動手操作。我們將修改預設佈景主題的檔案，來親身體驗 PHP 與 HTML 混編的威力。

#### 步驟 1: 準備開發環境

1.  開啟 **LocalWP**，啟動你的本地開發網站。
2.  使用 **VS Code** 開啟你的網站資料夾。
3.  導航到佈景主題目錄：`/wp-content/themes/`。我們以預設的 `twentytwentyfour` 為例。
4.  找到並打開 `index.php` 這個檔案。這是網站首頁的預設模板。

#### 步驟 2: 認識 WordPress 的「循環 (The Loop)」

在 `index.php` 中，你會看到一段類似這樣的程式碼，這就是 WordPress 最核心的機制——**The Loop**。

``
*（截圖：VS Code 中 `twentytwentyfour` 佈景主題的 `index.php` 檔案，並高亮 The Loop 的區塊）*

```php
<?php
if ( have_posts() ) { // 檢查是否有任何文章
    // 如果有，就開始「循環」
	while ( have_posts() ) {
        the_post(); // 設定好當前這篇文章的資料，準備給後面的函式使用

		/*
		 * 從 template-parts/content.php 檔案載入內容。
		 */
		get_template_part( 'template-parts/content' );
	}
} else {
    // 如果沒有任何文章，就載入 template-parts/content-none.php
	get_template_part( 'template-parts/content-none' );
}
?>
```

**這個結構完美地展示了 PHP 與 HTML 的混編：**

*   **PHP 邏輯控制：** `if` 和 `while` 是 PHP 的控制結構，它們決定了要顯示什麼內容（是否有文章？）、要重複顯示幾次（根據文章數量）。
*   **HTML 內容呈現：** `get_template_part()` 雖然是 PHP 函式，但它的作用是去載入另一個包含大量 HTML 結構的檔案 (`content.php`) 來顯示每一篇文章的標題、內文、作者等資訊。

#### 步驟 3: 進行第一次混編修改

讓我們來做一個簡單的修改。我們希望在首頁的文章列表標題上方，加上一個固定的 `<h2>` 標題，寫著「最新技術文章」。

1.  在 `if ( have_posts() ) {` 這一行的**正下方**，加入我們的 HTML 標題。

**修改前：**
```php
<?php
if ( have_posts() ) {
	while ( have_posts() ) {
// ...
```

**修改後：**
```php
<?php
if ( have_posts() ) {
    
    // -- 我們新增的 HTML --
    echo '<h2 style="text-align:center; padding: 20px;">最新技術文章</h2>';
    // -- 結束 --

	while ( have_posts() ) {
// ...
```

**Moksa 技巧：** 我們直接使用 `echo` 來輸出一整段 HTML。這是 PHP 與 HTML 混編的常見技巧之一。你也可以先用 `?>` 結束 PHP 模式，寫完 HTML 後再用 `<?php` 開啟，效果是完全一樣的，可依據程式碼可讀性自行決定。

**另一種寫法 (可讀性更高):**
```php
<?php if ( have_posts() ) : ?>

    <h2 style="text-align:center; padding: 20px;">最新技術文章</h2>

    <?php while ( have_posts() ) : ?>
        <?php the_post(); ?>
        <?php get_template_part( 'template-parts/content' ); ?>
    <?php endwhile; ?>

<?php else : ?>
    <?php get_template_part( 'template-parts/content-none' ); ?>
<?php endif; ?>
```
> 我們在下個段落會詳細說明這種 `: end...;` 的替代語法。

2.  儲存 `index.php` 檔案。
3.  回到你的本地網站首頁並重新整理。你會看到在文章列表的最上方，出現了我們剛剛加入的標題。

``
*（截圖：本地網站的前台畫面，顯示出「最新技術文章」這個標題在文章列表上方）*

---

### Moksa 技巧與最佳實踐

#### 1. 使用替代語法，提升模板可讀性

當 `if` 或 `while` 的區塊中包含大量 HTML 時，滿滿的大括號 `{}` 會讓程式碼變得難以閱讀。PHP 提供了一種「替代語法」，專門用來改善模板的可讀性。

*   `if (...) { ... }` 可以改寫為 `if (...) : ... endif;`
*   `while (...) { ... }` 可以改寫為 `while (...) : ... endwhile;`
*   `foreach (...) { ... }` 可以改寫為 `foreach (...) : ... endforeach;`

**Moksa 技巧：** 在開發 WordPress 佈景主題時，**強烈建議**在模板檔案 (`.php` 檔) 中全面使用這種替代語法。它能讓你的 HTML 結構更清晰，更容易維護。

#### 2. 邏輯與呈現分離 (Separation of Concerns)

雖然 PHP 和 HTML 可以混編，但不代表你應該把所有複雜的資料庫查詢、商業邏輯都塞在模板檔案裡。一個好的原則是：

*   **模板檔案 (`.php` themes files):** 應該專注於「**呈現 (Presentation)**」。它們負責 HTML 結構，以及如何將 PHP 變數或函式提供的資料放進這個結構裡。
*   **`functions.php` 或外掛檔案：** 應該負責「**邏輯 (Logic)**」。例如，從資料庫抓取特定資料、計算價格、處理表單提交等。

遵循這個原則，你的程式碼會更有組織、更容易除錯和擴充。

#### 3. 善用 `get_template_part()`

就像我們在範例中看到的，不要把所有 HTML 都寫在一個巨大的檔案裡。WordPress 提供了 `get_template_part()` 函式，讓我們可以將可重複使用的區塊（例如單篇文章的顯示樣式）拆分成獨立的檔案（如 `content-post.php`），然後在需要的地方載入它。這讓你的主模板檔案（如 `index.php`, `archive.php`）保持乾淨簡潔。

---

### 總結

恭喜你！你已經掌握了 WordPress 開發中最基礎也最關鍵的技能。理解 PHP 如何在伺服器端執行並動態生成 HTML，是你從一個網頁設計師轉變為 WordPress 開發者的重要一步。

**本章節重點回顧：**

1.  PHP 程式碼在**伺服器**執行，最終生成純 HTML 給瀏覽器。
2.  使用 `<?php ... ?>` 和 `<?= ... ?>` 標籤在 HTML 中嵌入 PHP 程式碼。
3.  WordPress 的 **The Loop** 是 PHP 邏輯控制與 HTML 內容呈現混編的最佳範例。
4.  在佈景主題開發中，多使用**替代語法** (`if: endif;`) 和 `get_template_part()` 來提升程式碼的可讀性與可維護性。

在接下來的課程中，我們將大量運用今天學到的混編技巧，開始深入探索 WordPress 提供的各種函式，來打造功能更豐富的佈景主題。