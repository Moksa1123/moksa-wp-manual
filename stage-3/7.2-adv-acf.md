# 07.02 (實作) 客製化「後台欄位」 (ACF, Advanced Custom Fields)

你好，我是 Moksa 的首席課程導師。在之前的章節中，我們學會了如何使用 CPT UI 來建立自訂文章類型，讓網站的內容結構更加豐富。然而，光有文章類型是不夠的，我們經常需要為特定的內容添加「額外的、結構化的資料欄位」，例如：為「商品」新增「產品規格」、「活動」新增「舉辦地點」與「活動日期」等等。

這時候，WordPress 開發者社群的瑰寶 — **Advanced Custom Fields (ACF)** 就登場了。ACF 是一個強大且直觀的工具，它允許我們以圖形化介面在 WordPress 後台為任何文章類型（包含 WooCommerce 商品、文章、頁面，以及我們自訂的 CPT）新增各式各樣的欄位。

本章節的目標，就是帶你從零開始，一步步學會如何使用 ACF 為 WooCommerce 商品新增自訂欄位，並將這些欄位的資料顯示在網站前台。

---

### 什麼是 ACF？為什麼我們需要它？

在 WordPress 中，每一篇文章或頁面除了標題和內文編輯器外，其餘的資料都儲存在一個稱為 **「後設資料 (meta data)」** 的地方。ACF 就是一個管理這些 meta data 的專業工具。

使用 ACF 的核心優勢在於：

1.  **結構化資料：** 告別將所有資訊都塞在傳統編輯器的混亂狀況。你可以為「價格」、「顏色」、「尺寸」等建立專屬欄位，讓資料管理更清晰。
2.  **提升使用者體驗 (UX)：** 為你的客戶或網站編輯提供一個直觀的資料輸入介面，他們只需要填寫你設計好的欄位，而不需要面對複雜的 HTML 或 Shortcode。
3.  **開發彈性：** 實現了 **「內容與外觀分離」** 的重要開發原則。內容編輯者專心填寫資料，而開發者則可以自由地在佈景主題的任何地方，用程式碼精準地抓取並呈現這些資料。

在 Moksa 的開發流程中，ACF 是不可或缺的核心工具，無論是製作企業官網的「團隊成員」介紹，還是電商網站的「商品額外資訊」，ACF 都是我們的首選方案。

### 前置準備

在開始之前，請確保你的開發環境已經準備好：

1.  一個本地端或線上的 WordPress 網站。
2.  已安裝並啟用 **WooCommerce** 外掛。
3.  已安裝並啟用 **Advanced Custom Fields** 免費版外掛。（直接從 WordPress 外掛市集搜尋安裝即可）

``
*(示意圖：在 WordPress 後台搜尋並安裝 Advanced Custom Fields 外掛)*
``

---

### 實作：為 WooCommerce 商品新增「產品規格」與「宣傳影片」欄位

我們的實作情境是：假設我們在銷售 3C 電子產品，我們希望在每個商品頁面的後台，都能讓編輯者輕鬆輸入該商品的「詳細規格」以及「YouTube 宣傳影片網址」，並將它們顯示在商品頁前台。

#### 第一部分：建立欄位群組 (Field Group)

ACF 的管理單位是「欄位群組」。一個群組可以包含多個欄位，並可以指定顯示在什麼樣的編輯頁面中。

**步驟 1：新增欄位群組**

*   在 WordPress 後台，點擊左側選單的「ACF」>「Field Groups」。
*   點擊上方的「Add New」按鈕。

**步驟 2：命名欄位群組**

*   在頂端的「Add New Field Group」欄位中，輸入一個好辨識的名稱，例如「**商品額外資訊**」。

**步驟 3：新增第一個欄位：「產品規格」**

*   點擊「+ Add Field」按鈕。
*   你會看到許多設定選項，我們來一一設定：
    *   **Field Label (欄位標籤):** 輸入「**產品規格**」。這是顯示在後台編輯畫面的標題。
    *   **Field Name (欄位名稱):** 當你輸入標籤後，它會自動產生，例如 `product_specifications`。**Moksa 技巧：** 這個「欄位名稱」是獨一無二的，它就是我們未來在程式碼中用來抓取資料的 `key`，**請務必使用英文、數字與底線**，且一旦發佈後就不要輕易修改。
    *   **Field Type (欄位類型):** 選擇「**WYSIWYG Editor**」。這種類型提供了一個類似傳統編輯器的介面，方便編輯者進行圖文排版。
    *   其他的設定（例如 Instructions, Required? 等）可以暫時保持預設。

``
*(示意圖：設定「產品規格」欄位的畫面，包含 Field Label, Field Name, Field Type)*
``

**步驟 4：新增第二個欄位：「宣傳影片」**

*   再次點擊「+ Add Field」按鈕，新增第二個欄位。
*   設定如下：
    *   **Field Label:** 輸入「**宣傳影片**」。
    *   **Field Name:** 它會自動產生，例如 `promotional_video`。
    *   **Field Type:** 選擇「**URL**」。這種類型會確保使用者輸入的是一個合法的網址格式，提供了基本的資料驗證。

**步驟 5：設定欄位群組的顯示位置 (Location Rules)**

這是最關鍵的一步！我們要告訴 ACF，這個「商品額外資訊」的欄位群組，應該出現在哪裡。

*   找到下方的「Settings」>「Location Rules」區塊。
*   你會看到一條預設規則 "Show this field group if..."
*   將規則設定為：「**Post Type**」 「**is equal to**」 「**Product**」。
*   這條規則的意思是：**當後台的編輯頁面是「商品 (Product)」這種文章類型時，才顯示我們剛剛建立的欄位**。

``
*(示意圖：設定 Location Rules 為 Post Type is equal to Product 的畫面)*
``

**步驟 6：儲存設定**

*   點擊右上角的「Save Changes」藍色按鈕，儲存你的欄位群組。

---

#### 第二部分：在商品後台輸入資料

現在，我們的欄位已經建立好了。讓我們來實際填寫看看。

*   前往「商品」>「所有商品」，隨便編輯一個你既有的商品，或是新增一個商品。
*   在商品的主要內容編輯器下方（或側邊欄，位置可能因設定而異），你會看到一個標題為「**商品額外資訊**」的區塊。
*   裡面正是我們剛剛建立的「**產品規格**」編輯器和「**宣傳影片**」URL 輸入框。
*   請在這裡輸入一些範例資料。例如，在規格中輸入一些 CPU、RAM 的資訊，並在影片欄位貼上一段 YouTube 網址。
*   完成後，點擊「更新」儲存商品。

``
*(示意圖：在 WooCommerce 商品編輯頁面，顯示出「商品額外資訊」區塊，以及裡面的兩個自訂欄位，並已填入範例資料)*
``

---

#### 第三部分：在前台顯示自訂欄位資料

我們已經成功地將資料儲存在資料庫了。但目前為止，這些資料還只存在於後台。接下來，我們要將它們顯示在商品頁面給顧客看。這也是身為開發者最重要的工作。

顯示 ACF 資料主要有兩種方式：

1.  **方法 A (推薦初學者/設計師): 使用頁面編輯器 (Kadence/Elementor) 的動態資料功能。**
2.  **方法 B (推薦開發者): 在佈景主題的程式碼中，使用 ACF 提供的函式來呼叫資料。**

作為一個開發課程，我們將重點放在方法 B，但也會簡述方法 A 的概念。

##### 方法 A：使用頁面編輯器的動態資料

現代的頁面編輯器如 **Kadence Blocks Pro** 或 **Elementor Pro** 通常都支援「動態資料 (Dynamic Data / Dynamic Tags)」功能。

它的概念是，你可以在頁面中插入一個標題或文字區塊，然後不直接輸入文字，而是將該區塊的「內容來源」連結到我們用 ACF 建立的欄位（例如 `product_specifications`）。如此一來，編輯器就會自動抓取該商品對應的 ACF 欄位資料並顯示出來，完全不需要寫程式碼。

**Moksa 技巧：** 這是快速製作模板 (Template) 的好方法，但客製化彈性較低。對於需要高度客製化排版或包含複雜邏輯的場景，方法 B 仍然是必要的。

##### 方法 B：在程式碼中使用 ACF 函式

這是最專業、彈性最高的方式。我們將使用 PHP 程式碼，將資料掛載到 WooCommerce 商品頁的特定位置。

**核心 ACF 函式：**

*   `the_field('field_name');`：直接**印出 (echo)** 欄位的值。
*   `get_field('field_name');`：**回傳 (return)** 欄位的值到一個變數中，讓你可以先進行處理（例如判斷、組合）再印出。

**步驟 1：找到合適的 Hook (掛鉤)**

WooCommerce 提供了大量的「Action Hooks」，讓我們可以在不修改核心檔案的前提下，將自訂內容安插到頁面的各個位置。一個很適合放額外資訊的地方是「商品摘要」下方。這個 Hook 的名稱是 `woocommerce_after_single_product_summary`。

**步驟 2：撰寫 PHP 程式碼**

我們將把程式碼放在**子佈景主題**的 `functions.php` 檔案中。

```php
<?php
/**
 * 在單一商品頁面顯示 ACF 自訂欄位
 * 使用 MoksaWP 推薦的開發實踐
 */
add_action( 'woocommerce_after_single_product_summary', 'moksa_display_acf_fields_on_product_page', 20 );

function moksa_display_acf_fields_on_product_page() {
    // 首先，檢查 ACF 外掛是否存在，這是專業開發的良好習慣
    if ( ! function_exists('get_field') ) {
        return;
    }

    // 使用全域變數 $product 來取得當前商品的資訊
    global $product;

    // 取得商品 ID
    $product_id = $product->get_id();

    // 取得「產品規格」欄位的資料
    // 使用 get_field() 而不是 the_field()，因為我們要先判斷它是否有內容
    $specs = get_field( 'product_specifications', $product_id );
    $video_url = get_field( 'promotional_video', $product_id );

    // 開始輸出 HTML
    echo '<div class="moksa-product-extra-info">';

    // 如果「產品規格」有內容，才顯示區塊
    if ( $specs ) {
        echo '<div class="product-specifications-section">';
        echo '<h2>產品規格</h2>';
        // 因為是 WYSIWYG 欄位，直接輸出即可保留 HTML 格式
        echo $specs;
        echo '</div>';
    }

    // 如果「宣傳影片」有內容，且是合法的 URL，才顯示
    if ( $video_url ) {
        echo '<div class="product-video-section">';
        echo '<h2>宣傳影片</h2>';
        // 將 YouTube URL 轉換成嵌入式播放器
        // WordPress 內建的 wp_oembed_get() 函式非常方便
        echo wp_oembed_get( $video_url );
        echo '</div>';
    }

    echo '</div>';
}
```

**步驟 3：將程式碼加入 `functions.php` 並儲存**

將以上程式碼複製並貼到你的子佈景主題的 `functions.php` 檔案結尾處，然後儲存檔案。

**步驟 4：查看前台成果**

現在，回到你剛剛填寫過自訂欄位資料的那個商品頁面，重新整理。你會發現在「加入購物車」按鈕的下方，已經成功顯示出你所輸入的「產品規格」與「宣傳影片」了！

``
*(示意圖：WooCommerce 商品前台頁面，在商品摘要下方成功顯示出「產品規格」的內容以及嵌入的 YouTube 影片播放器)*
``

### 總結

恭喜你！在本章節中，你學會了 WordPress 客製化開發中一項最關鍵的技能：

1.  理解了 ACF 的核心價值與使用時機。
2.  親手建立了一個「欄位群組」，並設定了兩種不同類型的欄位（WYSIWYG, URL）。
3.  學會了如何使用「位置規則」，精準地將欄位指派給 WooCommerce 商品。
4.  在商品後台實際輸入了 meta data。
5.  掌握了最重要的一步：**使用 PHP 程式碼搭配 WooCommerce Hook，在前台將自訂欄位的資料優雅地呈現出來**。

ACF 的功能遠不止於此，付費版的 ACF Pro 還提供了更強大的「重複器 (Repeater)」、「彈性內容 (Flexible Content)」、「畫廊 (Gallery)」等進階欄位。但今天你所學會的，已經為你打開了 WordPress 無限客製化的大門。

在接下來的課程中，我們將會不斷地運用 ACF 來打造更多複雜且實用的功能。請務必熟練本章節的每一個步驟。