# 01.03 開發工具 (VS Code, WP-CLI, Query Monitor)

嗨，歡迎來到 MoksaWP 開發課程的第一個核心章節。我是你在 Moksa 的課程導師。

在我們深入探索佈景主題與外掛的開發世界之前，我們必須先「工欲善其事，必先利其器」。一位專業的 WordPress 開發者，與業餘愛好者最大的區別，往往不在於寫了多麼華麗的程式碼，而在於使用了**正確且高效的開發工具**。

傳統的方式，例如直接在 WordPress 後台的「佈景主題檔案編輯器」修改程式碼，或是透過 FTP 軟體一個個上傳檔案，不僅效率低落，而且充滿風險。在 Moksa，我們絕對禁止這種作法。

這一堂課，我們將介紹三樣被譽為 WordPress 開發「三神器」的工具。它們將徹底改變你的工作流程，提升你的開發效率與程式碼品質。這三樣工具分別是：

1.  **VS Code：** 現代化的程式碼編輯器，你的開發指揮中心。
2.  **WP-CLI：** WordPress 的命令列工具，讓你用鍵盤光速管理網站。
3.  **Query Monitor：** 終極的偵錯外掛，透視 WordPress 運作的 X 光機。

讓我們逐一來認識並設定它們吧！

---

## 1. VS Code (Visual Studio Code)

**VS Code** 是一款由微軟開發的免費、開源且功能強大的程式碼編輯器。它不僅僅是一個文字編輯器，透過豐富的擴充套件生態系，我們可以將它打造成專為 WordPress 開發的整合開發環境 (IDE)。

**為什麼我們選擇 VS Code？**

*   **智慧程式碼提示 (IntelliSense)：** 能自動提示函式、變數，大幅減少拼寫錯誤。
*   **內建終端機：** 無需切換視窗，可以直接在編輯器內執行 WP-CLI 或 Git 指令。
*   **Git 整合：** 與版本控制系統 Git 完美結合，追蹤程式碼變更輕而易舉。
*   **豐富的擴充套件：** 擁有海量的外掛，可以客製化你的開發環境。

### 步驟 1：安裝 VS Code

請至 [VS Code 官方網站](https://code.visualstudio.com/) 下載並安裝適合你作業系統的版本。安裝過程非常直觀，按照預設選項完成即可。

`[SCREENSHOT]`
*VS Code 官方網站下載頁面。*

### 步驟 2：安裝 Moksa 推薦的擴充套件

安裝好 VS Code 後，我們需要安裝一些關鍵的擴充套件，讓它更適合 WordPress 開發。

1.  打開 VS Code。
2.  點擊左側邊欄的「擴充功能」圖示 (四個方塊的圖案)。
3.  在搜尋框中，搜尋並安裝以下幾個 **Moksa 必備套件**：

    *   `PHP Intelephense`：提供最頂級的 PHP 程式碼自動完成、錯誤檢查與定義查找功能。
    *   `WordPress Hooks IntelliSense`：當你輸入 `add_action` 或 `add_filter` 時，它會自動提示所有 WordPress 核心、外掛的可用 Hooks，是開發者的福音。
    *   `Prettier - Code formatter`：統一你的程式碼風格，讓你的 PHP, JavaScript, CSS 程式碼永遠保持整潔、一致的排版。
    *   `GitLens`：強化內建的 Git 功能，可以直接在程式碼旁邊看到每一行的修改紀錄與作者，對於團隊協作至關重要。

`[SCREENSHOT]`
*在 VS Code 擴充功能市集中搜尋並安裝 "PHP Intelephense" 的畫面。*

### Moksa 技巧：將專案資料夾加入工作區

使用 VS Code 的正確方式是「開啟資料夾」，而不是「開啟檔案」。當你使用 LocalWP 建立一個新網站後，直接將整個網站的資料夾 (例如 `~/Local Sites/my-awesome-site`) 拖曳到 VS Code 中，或透過 `File > Open Folder...` 來開啟。這樣 VS Code 才能正確索引所有檔案，發揮擴充套件的最大功用。

---

## 2. WP-CLI (WordPress Command-Line Interface)

**WP-CLI** 是一個讓你透過「命令列」(也就是終端機、Terminal) 來管理 WordPress 網站的工具。舉凡安裝外掛、更新核心、建立使用者、搜尋取代資料庫內容...等，所有你在後台能用滑鼠點擊完成的事情，幾乎都能用 WP-CLI 以一行指令快速完成。

**為什麼要用 WP-CLI？**

*   **效率：** 安裝並啟用 10 個外掛，用 WP-CLI 可能只需要 30 秒，而用滑鼠點擊可能需要 5 分鐘。
*   **自動化：** 可以將一系列指令寫成腳本 (Script)，一鍵完成網站的部署或日常維護。
*   **伺服器管理：** 在沒有圖形化介面的伺erv器環境下，WP-CLI 是管理 WordPress 的唯一途徑。
*   **強大功能：** 擁有許多後台沒有的強大功能，例如對資料庫進行精準的「搜尋與取代」。

### 如何使用 WP-CLI？

**Moksa 技巧：** 我們推薦的開發環境 **LocalWP 已經內建了 WP-CLI**。你不需要自己手動安裝。

只需要在 LocalWP 中，選擇你的網站，點擊右鍵選擇「Open Site Shell」，就會開啟一個已經設定好環境的終端機視窗，可以直接在裡面輸入 `wp` 指令。

`[SCREENSHOT]`
*在 LocalWP 中右鍵點擊網站，選擇 "Open Site Shell" 的畫面。*

你也可以直接使用 VS Code 內建的終端機。在 VS Code 中按下 `Ctrl + ~` (或 `View > Terminal`)，然後輸入 `wp --info` 來測試 WP-CLI 是否正常運作。

### 常用 WP-CLI 指令範例

以下是一些你每天都會用到的指令，感受一下它的威力：

*   **安裝並啟用外掛：**
    ```bash
    # 同時安裝並啟用 WooCommerce 和 RY Tools
    wp plugin install woocommerce ry-woocommerce-tools --activate
    ```

*   **更新所有外掛與 WordPress 核心：**
    ```bash
    # 更新所有外掛
    wp plugin update --all
    
    # 更新 WordPress 核心
    wp core update
    ```

*   **資料庫搜尋與取代 (搬家神器)：**
    ```bash
    # 將資料庫中所有 "http://dev.site" 更換為 "https://prod.site"
    # --dry-run 參數會先模擬執行，確認影響範圍，極度重要！
    wp search-replace 'http://dev.site' 'https://prod.site' --dry-run
    
    # 確認無誤後，拿掉 --dry-run 正式執行
    wp search-replace 'http://dev.site' 'https://prod.site'
    ```

*   **匯出/匯入資料庫：**
    ```bash
    # 將資料庫匯出成一個 .sql 檔案
    wp db export latest-backup.sql
    
    # 匯入一個 .sql 檔案 (會覆蓋現有資料庫！)
    wp db import data-from-prod.sql
    ```

---

## 3. Query Monitor

**Query Monitor** 是一款免費的 WordPress 開發者工具外掛。啟用後，它會在網站頂部的管理員工具列新增一個詳細的數據面板。它可以讓你透視頁面載入時，WordPress 內部發生的所有事情。

**為什麼 Query Monitor 是必備工具？**

*   **效能瓶頸分析：** 精準找出載入緩慢的資料庫查詢、外部 API 請求或執行過久的函式。
*   **PHP 錯誤監控：** 顯示所有 PHP 的錯誤、警告 (Warning) 和通知 (Notice)，即使它們在畫面上被隱藏了。
*   **Hooks 執行順序：** 查看在特定頁面上，有哪些 Action 和 Filter 被觸發，以及它們的執行順序與優先級。
*   **HTTP API 呼叫：** 檢查網站對外的 API 請求是否成功、花了多少時間 (例如：檢查綠界金流的 API 連線狀況)。

### 步驟 1：安裝並啟用 Query Monitor

這是一個標準的外掛，你可以透過後台或 WP-CLI 安裝。

```bash
# 使用 WP-CLI 安裝
wp plugin install query-monitor --activate
```

### 步驟 2：如何解讀 Query Monitor

啟用後，以管理員身份登入你的網站前台或後台，你會在最上方的工具列看到一組新的數據。

`[SCREENSHOT]`
*WordPress 頂部管理員工具列上，顯示 Query Monitor 數據 (例如: 0.53s, 8MB, 50Q) 的畫面。*

將滑鼠移到數據上，就會展開詳細的面板。以下是幾個 **Moksa 開發者最常看的面板**：

*   **Queries：** 這是最重要的面板。你可以看到此頁面執行的所有資料庫 SQL 查詢。特別注意「**Queries by Caller**」分頁，它可以幫你找到是哪個外掛或佈景主題的哪個函式，產生了緩慢的查詢。
*   **PHP Errors：** 顯示所有等級的 PHP 錯誤。在開發過程中，這裡應該要永遠保持乾淨。
*   **Hooks & Actions：** 查看目前頁面觸發了哪些鉤子 (Hooks)，以及掛載在上面的函式，這對於理解外掛之間的互動非常有幫助。
*   **HTTP API Calls：** 當你串接第三方服務 (如綠界發票、LINE Pay) 失敗時，第一時間就應該來這裡檢查 API 請求的詳細資訊，包括請求網址、回傳的標頭 (Header) 與內文 (Body)。

### Moksa 技巧：實戰偵錯流程

**情境：** 客戶回報網站某個頁面載入特別慢。

1.  **第一步：** 打開該頁面，查看 Query Monitor 工具列的總體數據。如果頁面載入時間超過 3 秒，或資料庫查詢 (Q) 超過 100 次，就有問題。
2.  **第二步：** 點開 Query Monitor 面板，切換到「**Queries**」 -> 「**Queries by Caller**」。
3.  **第三步：** 尋找執行時間 (Time) 最長的查詢。Query Monitor 會用紅色標示出有問題的查詢。
4.  **第四步：** 查看該查詢的「Caller」欄位，就能立刻定位到是哪個外掛 (`plugins/...`) 或佈景主題 (`themes/...`) 的哪一行程式碼造成了效能瓶頸。
5.  **第五步：** 打開 VS Code，找到該檔案，開始進行優化。

## 總結

恭喜你！你已經完成了 WordPress 專業開發環境的基礎設定。

*   **VS Code** 是你的工作台，用來撰寫、閱讀和管理程式碼。
*   **WP-CLI** 是你的瑞士刀，用來快速、自動化地管理網站。
*   **Query Monitor** 是你的儀表板，用來監控、診斷和偵錯網站。

請務必花時間熟悉這三樣工具的操作，並將它們融入你的日常開發流程中。從現在開始，你寫的每一行程式碼、管理的每一個網站，都將變得更加專業與高效。在接下來的課程中，我們將會大量使用這些工具來進行實作。