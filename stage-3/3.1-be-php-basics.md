# 03.01 PHP 基礎語法 (變數、陣列、迴圈、函式)

你好！歡迎來到 MoksaWP 佈景主題與外掛開發的第一個核心章節。我是你在 Moksa 的課程導師。

在我們深入探索 WordPress 的世界之前，我們必須先打好堅實的基礎。而這個基礎，就是 **PHP**。WordPress 本身就是用 PHP 寫成的，它的核心、佈景主題、外掛，無一不是 PHP 的應用。因此，掌握 PHP 的基礎語法，是你成為一名合格 WordPress 開發者的第一步，也是最重要的一步。

在這個章節，我們會專注於 PHP 最核心的四個概念：**變數 (Variables)**、**陣列 (Arrays)**、**迴圈 (Loops)** 和 **函式 (Functions)**。這些是構成所有程式邏輯的基石。

**學習環境建議：**
*   **本機環境：** 請務必使用 **LocalWP** 來建立你的本機 WordPress 網站。
*   **程式碼編輯器：** 我們強烈推薦使用 **VS Code (Visual Studio Code)**，並安裝 PHP 相關的擴充套件。

---

### 1. PHP 的基本結構

首先，你需要知道如何告訴伺服器：「嗨！接下來這段是 PHP 程式碼，請幫我執行它。」

PHP 程式碼必須被包覆在特殊的標籤之間：

```php
<?php

// 你所有的 PHP 程式碼都寫在這裡

?>
```

任何在這個 `<?php ... ?>` 標籤之外的內容，都會被當作一般的 HTML 處理。

**Moksa 技巧：** 在一個純粹只包含 PHP 程式碼的檔案中（例如 WordPress 的 `functions.php`），建議**省略結尾的 `?>` 標籤**。這樣可以避免因為結尾標籤後有多餘的空白或換行，而導致非預期的 "headers already sent" 錯誤。

---

### 2. 變數 (Variables)

變數就像是程式中的「容器」，你可以用它來儲存資訊，例如文字、數字等等，方便之後重複使用。

*   在 PHP 中，變數名稱一律以 **`$`** 符號開頭。
*   變數名稱可以包含英文字母、數字和底線 `_`，但**不能以數字開頭**。
*   PHP 的變數是**區分大小寫**的 (`$name` 和 `$Name` 是兩個不同的變數)。

#### 宣告變數與資料型態

```php
<?php

// 1. 字串 (String) - 用來儲存文字，需用單引號或雙引號包起來
$plugin_name = "RY WooCommerce Tools";
$author_name = 'Moksa Web';

// 2. 整數 (Integer) - 用來儲存沒有小數點的數字
$active_installs = 5000;
$current_year = 2024;

// 3. 浮點數 (Float / Double) - 有小數點的數字
$plugin_version = 3.5;
$price = 99.99;

// 4. 布林值 (Boolean) - 只有兩種值：true (真) 或 false (假)
$is_active = true;
$has_pro_version = false;

// 5. 空值 (NULL) - 代表「沒有值」或「空」的特殊變數
$no_value = null;

?>
```

#### 使用變數

你可以使用 `echo` 這個指令，將變數的值輸出到畫面上。

```php
<?php

$post_title = "歡迎來到 Moksa 的 WordPress 開發課程";

echo '<h1>' . $post_title . '</h1>';
// 輸出結果會是：<h1>歡迎來到 Moksa 的 WordPress 開發課程</h1>

// 在 PHP 中，我們使用「.」來串接字串與變數

?>
```

---

### 3. 陣列 (Arrays)

當你需要一個變數來儲存「一系列」相關的值時，陣列就是最好的選擇。例如，一個購物車裡的所有商品、一個分類下的所有文章。

陣列主要分為兩種：**索引陣列 (Indexed Arrays)** 和 **關聯陣列 (Associative Arrays)**。

#### 索引陣列 (Indexed Arrays)

索引陣列使用數字作為「鍵 (key)」，從 `0` 開始依序遞增。

```php
<?php

// 建立一個索引陣列，存放我們推薦的頁面編輯器
$page_builders = array('Kadence Blocks', 'Elementor', 'Gutenberg');

// 或是使用更簡潔的 [] 語法 (推薦)
$payment_gateways = ['綠界科技 ECPay', 'LINE Pay', 'Stripe'];

// 取出陣列中的值 (索引從 0 開始)
echo $page_builders[0];   // 輸出: Kadence Blocks
echo $payment_gateways[1]; // 輸出: LINE Pay

?>
```

#### 關聯陣列 (Associative Arrays)

關聯陣列使用**自訂的字串**作為「鍵 (key)」，這讓資料變得更有意義、更具可讀性。**在 WordPress 開發中，關聯陣列的使用頻率遠高於索引陣列**，例如在傳遞函式參數時。

```php
<?php

// 建立一個關聯陣列，描述一個 WooCommerce 商品
$product_data = [
    'name'          => 'Moksa 主題開發課程',
    'price'         => 12000,
    'sku'           => 'MK-COURSE-001',
    'is_in_stock'   => true
];

// 取出陣列中的值
echo '商品名稱：' . $product_data['name']; // 輸出: 商品名稱：Moksa 主題開發課程
echo '商品價格：' . $product_data['price'];  // 輸出: 商品價格：12000

?>
```

**Moksa 技巧：** 在開發過程中，當你不確定一個變數或陣列的內容是什麼時，`print_r()` 和 `var_dump()` 是你最好的除錯夥伴。它們可以將陣列的結構完整地印出來。

```php
<?php

$product_data = [
    'name'          => 'Moksa 主題開發課程',
    'price'         => 12000,
    'sku'           => 'MK-COURSE-001',
    'is_in_stock'   => true
];

// 使用 <pre> 標籤可以讓輸出的格式更好看
echo '<pre>';
print_r($product_data);
echo '</pre>';

/*
輸出結果：
<pre>Array
(
    [name] => Moksa 主題開發課程
    [price] => 12000
    [sku] => MK-COURSE-001
    [is_in_stock] => 1
)
</pre>
*/

?>
```
``

---

### 4. 迴圈 (Loops)

迴圈的用途是「重複執行」某一段程式碼，直到滿足特定條件為止。當你需要處理陣列中的每一個項目時，迴圈就顯得至關重要。

#### `foreach` 迴圈

`foreach` 是專門用來**遍歷 (iterate)** 陣列中每一個元素的迴圈。**這是你在 WordPress 開發中最常用到的迴圈**。

**步驟 1：基本語法**

```php
<?php
// foreach (陣列 as $變數) { ... }
// 在每一次迴圈中，陣列的當前元素值會被指派給 $變數

$payment_gateways = ['綠界科技 ECPay', 'LINE Pay', 'Stripe'];

echo '<ul>';
foreach ($payment_gateways as $gateway) {
    echo '<li>我們支援的金流：' . $gateway . '</li>';
}
echo '</ul>';
?>
```

**步驟 2：遍歷關聯陣列**

你也可以同時取得關聯陣列的「鍵」和「值」。

```php
<?php
// foreach (陣列 as $鍵 => $值) { ... }

$product_data = [
    '商品名稱' => 'Moksa 主題開發課程',
    '價格' => 12000,
    '商品編號' => 'MK-COURSE-001',
];

echo '<ul>';
foreach ($product_data as $key => $value) {
    echo '<li>' . $key . ': ' . $value . '</li>';
}
echo '</ul>';
?>
```
``

#### `while` 迴圈

`while` 迴圈會不斷執行，只要指定的條件為 `true`。**WordPress 經典的主迴圈 (The Loop)** 就是一個 `while` 迴圈的最佳範例。

```php
<?php

// 這是 WordPress 佈景主題中用來顯示文章列表的標準寫法
// 雖然你現在可能看不懂裡面的函式，但請記住這個結構
if ( have_posts() ) {
    while ( have_posts() ) {
        the_post(); 
        
        // 在這裡顯示文章標題、內容等資訊
        the_title('<h2>', '</h2>');
        the_content();

    }
} else {
    echo '沒有找到任何文章。';
}

?>
```

---

### 5. 函式 (Functions)

函式是一段可以**重複使用**的程式碼區塊。你可以將一些常用的功能打包成一個函式，並為它命名。當你需要用到這個功能時，只需要「呼叫」它的名字即可，而不需要重複撰寫相同的程式碼。

**這也是 WordPress 能如此強大且靈活的核心關鍵**，整個 WordPress 就是由成千上萬個函式所構成的。

#### 定義與呼叫函式

**步驟 1：定義一個函式**

我們來建立一個簡單的函式，功能是計算含稅價格。

```php
<?php

/**
 * 計算商品的含稅價格
 * 
 * @param float $price 未稅價格
 * @param float $tax_rate 稅率，預設為 0.05 (5%)
 * @return float 含稅後的價格
 */
function moksa_get_price_with_tax($price, $tax_rate = 0.05) {
    $total_price = $price * (1 + $tax_rate);
    return $total_price;
}

?>
```
*   `function` 是定義函式的關鍵字。
*   `moksa_get_price_with_tax` 是我們自訂的函式名稱。**Moksa 技巧：** 為了避免和 WordPress 核心或其他外掛的函式名稱衝突，**為你的自訂函式加上獨特的前綴 (prefix)**，例如 `moksa_` 或 `mk_`，是一個非常重要的好習慣。
*   `($price, $tax_rate = 0.05)` 是函式的**參數 (Parameters)**，也就是我們傳遞給函式的資訊。`$tax_rate = 0.05` 表示如果我們沒有提供稅率，它會**預設使用 0.05**。
*   `return` 關鍵字會將函式計算的結果「回傳」出來。

**步驟 2：呼叫 (使用) 函式**

```php
<?php

// 假設我們的課程未稅價是 12000
$course_price = 12000;

// 呼叫函式，並將結果存到新的變數中
$final_price = moksa_get_price_with_tax($course_price);

echo '課程含稅價格是：' . $final_price; // 輸出: 課程含稅價格是：12600

// 你也可以傳遞第二個參數，覆寫預設值
$high_tax_price = moksa_get_price_with_tax($course_price, 0.07);
echo '若稅率為 7%，價格是：' . $high_tax_price; // 輸出: 若稅率為 7%，價格是：12840

?>
```

### 總結

恭喜你！你已經完成了 PHP 基礎語法的學習。讓我們快速回顧一下今天學到的四個核心概念：

1.  **變數 (`$`)**：儲存單一資訊的容器。
2.  **陣列 (`[]`)**：儲存一系列資訊的容器，特別是**關聯陣列**在 WordPress 中極為重要。
3.  **迴圈 (`foreach`)**：用來處理陣列中的每一個項目，是你顯示列表資料的必備工具。
4.  **函式 (`function`)**：將程式碼打包成可重複使用的模組，是 WordPress **掛鉤 (Hooks)** 系統的基礎。

請務必在你的 LocalWP 環境中，親手練習每一個範例。對這些基礎語法越熟悉，你未來在學習 WordPress Hooks、開發自己的佈景主題與外掛時，就會越得心應手。在下一個章節，我們將會探討 WordPress 的掛鉤系統，你將會看到這些 PHP 基礎是如何在 WordPress 中發揮強大作用的。