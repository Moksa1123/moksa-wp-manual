# 04.01 佈景主題結構 (style.css, functions.php, index.php)

歡迎來到佈景主題開發的第一個核心章節！在這一堂課，我們將從零開始，了解一個 WordPress 佈景主題最基礎、也最重要的三個檔案。這三個檔案就像是房子的地基、鋼筋和樑柱，理解它們各自的職責與協作方式，是你成為一位專業佈景主題開發者的第一步。

---

### 什麼是 WordPress 佈景主題？

在開始撰寫程式碼之前，我們需要建立一個重要的觀念：WordPress 佈景主題**不僅僅是網站的「外觀」或「皮膚」**。它實際上是整個網站的「**展示層 (Presentation Layer)**」。

佈景主題負責從資料庫中提取內容（文章、頁面、商品等），並決定這些內容**如何**在瀏覽器中呈現給使用者。它定義了版面配置、顏色、字體，以及使用者與網站互動的整體視覺體驗。

一個最精簡、能被 WordPress 成功辨識的佈景主題，只需要一個檔案：`style.css`。但要讓它真正「動起來」，我們至少需要 `index.php` 來顯示內容，以及 `functions.php` 來載入我們的樣式和功能。這就是我們今天的主角。

---

### 1. `style.css` - 佈景主題的身分證

`style.css` 可能是你最熟悉的檔案，但它在 WordPress 中的角色遠不止是存放 CSS 樣式。它最重要的功能是**定義佈景主題的資訊**，也就是「Theme Header」。WordPress 就是透過讀取這個檔案頂部的註解資訊，來識別佈景主題的名稱、作者、版本等資料。

**一個標準的 `style.css` 檔案頂部註解看起來像這樣：**

```css
/*
Theme Name: Moksa Basic Theme
Theme URI: https://moksaweb.com/
Author: Moksa Team
Author URI: https://moksaweb.com/
Description: A basic theme for MoksaWP development course.
Version: 1.0.0
License: GNU General Public License v2 or later
License URI: https://www.gnu.org/licenses/gpl-2.0.html
Text Domain: moksabasic
Tags: custom-background, custom-logo, two-columns, right-sidebar
*/

/* --- Start your CSS rules below this line --- */
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
    line-height: 1.6;
    color: #333;
}
```

**重點欄位解釋：**

*   `**Theme Name**`: (**必填**) 佈景主題的名稱，會顯示在 WordPress 後台「外觀 > 佈景主題」中。
*   `Theme URI`: 佈景主題的官方介紹網頁。
*   `Author`: 作者名稱。
*   `Author URI`: 作者的網站。
*   `Description`: 佈景主題的簡短描述。
*   `**Version**`: (**必填**) 版本號。遵循語意化版本 (Semantic Versioning) 是個好習慣 (e.g., `1.0.0`)。
*   `License`: 授權條款，通常是 `GNU General Public License v2 or later`。
*   `License URI`: 授權條款的詳細說明連結。
*   `**Text Domain**`: (**極度重要**) 這是為了「**國際化 (i18n)**」所設定的唯一識別碼，用於讓佈景主題可以被翻譯成不同語言。我們後續課程會深入探討。
*   `Tags`: 描述佈景主題特性的標籤，方便使用者在官方佈景主題目錄中篩選。

> **Moksa 技巧：** 即使你只是在開發一個自用的小型佈景主題，也務必**養成填寫完整 `style.css` 標頭的習慣**。特別是 `Theme Name`、`Version` 和 `Text Domain`，這會讓你的專案更專業、更易於維護。

---

### 2. `functions.php` - 佈景主題的大腦與工具箱

如果說 `style.css` 是身分證，那麼 `functions.php` 就是佈景主題的「**大腦**」。這個檔案的行為就像一個**專屬於該佈景主題的外掛**。當佈景主題被啟用時，WordPress 會自動載入並執行 `functions.php` 裡的所有 PHP 程式碼。

它的主要用途包含：

1.  **啟用佈景主題功能：** 使用 `add_theme_support()` 函數來告訴 WordPress 你的佈景主題支援哪些核心功能，例如：特色圖片、選單、小工具等。
2.  **載入資源 (Enqueue Scripts and Styles)：** 這是 **`functions.php` 最核心的任務之一**。我們不會在 HTML 中使用 `<link>` 或 `<script>` 標籤直接載入 CSS 和 JavaScript，而是透過 WordPress 提供的 `wp_enqueue_style()` 和 `wp_enqueue_script()` 函式來載入。這樣做可以確保資源以正確的順序載入、避免重複載入，並允許其他外掛進行互動。
3.  **註冊自訂功能：** 例如註冊自訂文章類型 (CPT)、自訂分類 (Custom Taxonomies)、導覽選單位置 (Navigation Menus)、側邊欄 (Sidebars) 等。
4.  **添加自訂函式與邏輯：** 任何你想要在佈景主題中使用的 PHP 函式或商業邏輯，都可以放在這裡。

**一個基礎的 `functions.php` 範例：**

```php
<?php
/**
 * Moksa Basic Theme functions and definitions
 *
 * @link https://moksaweb.com
 *
 * @package Moksa_Basic_Theme
 */

if ( ! function_exists( 'moksabasic_setup' ) ) :
    /**
     * Sets up theme defaults and registers support for various WordPress features.
     */
    function moksabasic_setup() {
        // Add theme support for Automatic Feed Links
        add_theme_support( 'automatic-feed-links' );

        // Add theme support for the title tag
        add_theme_support( 'title-tag' );

        // Add theme support for Post Thumbnails (featured images)
        add_theme_support( 'post-thumbnails' );

        // Register a navigation menu
        register_nav_menus( array(
            'primary' => esc_html__( 'Primary Menu', 'moksabasic' ),
        ) );
    }
endif;
add_action( 'after_setup_theme', 'moksabasic_setup' );


if ( ! function_exists( 'moksabasic_scripts' ) ) :
    /**
     * Enqueue scripts and styles.
     */
    function moksabasic_scripts() {
        // Enqueue our main stylesheet from style.css
        wp_enqueue_style( 'moksabasic-style', get_stylesheet_uri(), array(), '1.0.0' );
    }
endif;
add_action( 'wp_enqueue_scripts', 'moksabasic_scripts' );

```

> **Moksa 技巧：** `functions.php` 很容易變得臃腫不堪。一個專業的開發實踐是，將相關的功能拆分到不同的檔案中，存放在一個 `inc` 或 `includes` 資料夾內，然後在 `functions.php` 中使用 `require` 或 `include` 將它們引入。這會讓你的程式碼結構更清晰、更容易管理。

---

### 3. `index.php` - 佈景主題的最後防線

`index.php` 是 WordPress **模板層級 (Template Hierarchy)** 中的「**最終備援 (Final Fallback)**」檔案。

什麼是模板層級？簡單來說，當使用者瀏覽網站的某個頁面時，WordPress 會根據頁面的類型（例如：是單篇文章、還是分類頁面、或是首頁），依序去尋找最適合的模板檔案。

例如，當瀏覽一篇「文章」時，WordPress 會依序尋找 `single-post.php` -> `single.php` -> `singular.php` -> `index.php`。如果前面的檔案都不存在，它**最後一定會使用 `index.php`** 來渲染頁面。

因此，`index.php` 是**所有佈景主題中必不可少的模板檔案**。它確保了無論使用者訪問網站的哪個角落，內容總能被顯示出來，不會出現錯誤。

一個最基礎的 `index.php` 包含了著名的 **WordPress Loop (迴圈)**：

```php
<?php get_header(); ?>

<main id="site-content" role="main">

    <?php if ( have_posts() ) : ?>

        <?php while ( have_posts() ) : the_post(); ?>

            <article <?php post_class(); ?> id="post-<?php the_ID(); ?>">

                <h2><a href="<?php the_permalink(); ?>"><?php the_title(); ?></a></h2>

                <div class="entry-content">
                    <?php the_content(); ?>
                </div>

            </article>

        <?php endwhile; ?>

    <?php else : ?>

        <p><?php esc_html_e( 'Sorry, no posts matched your criteria.', 'moksabasic' ); ?></p>

    <?php endif; ?>

</main>

<?php get_footer(); ?>
```

這個迴圈的作用就是：
1.  `if ( have_posts() )`: 檢查目前這個頁面請求是否有文章可以顯示。
2.  `while ( have_posts() ) : the_post();`: 如果有，就開始迴圈，依序處理每一篇文章。
3.  在迴圈內，我們可以使用 `the_title()`、`the_content()`、`the_permalink()` 等函式來輸出文章的標題、內容和連結。
4.  `else`: 如果沒有任何文章，就顯示一段提示訊息。

> **Moksa 技巧：** `get_header()` 和 `get_footer()` 是用來載入 `header.php` 和 `footer.php` 檔案的函式。雖然這兩個檔案不是我們今天的主角，但它們是構成完整頁面不可或缺的部分。我們會在後續課程詳細介紹它們。

---

### 實作：建立你的第一個 Moksa 主題

現在，讓我們動手將理論化為實踐。

**步驟 1：準備開發環境**

*   開啟你的 **LocalWP** 網站。
*   使用 **VS Code** 開啟該網站的資料夾。
*   導航到 `app/public/wp-content/themes/`。
*   在這裡建立一個新的資料夾，命名為 `moksabasic`。這就是我們佈景主題的家。

``

**步驟 2：建立 `style.css`**

*   在 `moksabasic` 資料夾內，建立一個新檔案 `style.css`。
*   將前面提供的 `style.css` 標頭範例複製貼上到這個檔案裡。

**步驟 3：建立 `functions.php`**

*   在 `moksabasic` 資料夾內，建立一個新檔案 `functions.php`。
*   將前面提供的 `functions.php` 範例程式碼複製貼上。這段程式碼最重要的作用是使用 `wp_enqueue_style()` 將我們的 `style.css` 載入到網站前端。

**步驟 4：建立 `index.php`**

*   在 `moksabasic` 資料夾內，建立一個新檔案 `index.php`。
*   將前面提供的 `index.php` 迴圈範例程式碼複製貼上。

**步驟 5：啟用與測試**

*   登入你的 WordPress 後台。
*   前往「**外觀**」>「**佈景主題**」。
*   你會看到我們剛剛建立的「Moksa Basic Theme」已經出現在列表裡了。
*   點擊「**啟用**」。

``

*   現在，回到網站前台看看。你會看到一個非常樸素的頁面，上面列出了你網站中所有文章的標題和內容。雖然很簡陋，但它已經是一個功能完整的 WordPress 佈景主題了！

``

### 總結

恭喜你！你已經成功理解並親手打造了一個 WordPress 佈景主題的骨架。

請務必記住這三個檔案的核心職責：
*   **`style.css`**: **身分證**。定義佈景主題的元數據 (Metadata)。
*   **`functions.php`**: **大腦**。載入資源、啟用功能、添加自訂邏輯。
*   **`index.php`**: **最後防線**。模板層級的最終備援，負責顯示內容。

在接下來的課程中，我們將基於這個骨架，逐步深入探討 WordPress 的「模板層級 (Template Hierarchy)」，並學習如何為不同類型的頁面（如單篇文章、靜態頁面、彙整頁面等）建立專屬的模板檔案。