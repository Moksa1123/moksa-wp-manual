# 04.06 (實務) functions.php 的妙用 (註冊選單、側邊欄)

嗨，歡迎來到這個實務章節。在之前的課程中，我們已經對佈景主題的結構有了基本的認識。今天，我們要來深入探索一個佈景主題中**最重要、也最強大的檔案之一**：`functions.php`。

這個檔案就像是佈景主題的大腦，我們可以在這裡添加自訂的 PHP 程式碼，來擴充或修改佈景主題、甚至是 WordPress 核心的功能。正確地使用 `functions.php` 是每一位 WordPress 開發者都必須掌握的核心技能。

在這個章節，我們將學習兩個最常見、也最實用的 `functions.php` 應用：

1.  **註冊自訂的導覽選單位置 (Navigation Menus)**
2.  **註冊自訂的側邊欄或小工具區域 (Sidebars / Widget Areas)**

---

### 前置準備：子佈景主題的重要性

在開始撰寫任何程式碼之前，我們必須再次強調一個**Moksa 的核心開發觀念**：**永遠在「子佈景主題 (Child Theme)」中進行修改**。

*   **為什麼？** 如果你直接修改了原始佈景主題（父佈景主題）的 `functions.php`，那麼當這個佈景主題有更新時，你所做的所有修改都會**被新版本的檔案覆蓋而消失**。
*   **如何做？** 將我們接下來要撰寫的所有程式碼，都放在你目前啟用中的**子佈景主題**資料夾底下的 `functions.php` 檔案裡。

請使用你的 **VS Code** 編輯器，並在 **LocalWP** 環境中，打開你子佈景主題的 `functions.php` 檔案，準備開始我們的實作。

``
*示意圖：在 VS Code 中開啟子佈景主題的 functions.php 檔案。*

---

### 任務一：註冊自訂導覽選單 (Register Menus)

預設情況下，佈景主題可能會提供一或兩個選單位置（例如：主選單）。但如果我們想在網站的頁腳 (Footer) 或其他特殊位置也新增一個可由後台管理的選單呢？這時候就需要自己註冊一個新的選單位置。

#### 步驟 1：了解 `register_nav_menus()` 函式

WordPress 提供了一個專門用來註冊選單位置的函式：`register_nav_menus()`。這個函式接受一個「陣列 (Array)」作為參數，讓我們可以一次註冊一個或多個選單位置。

#### 步驟 2：撰寫註冊選單的程式碼

現在，將下方的程式碼片段複製並貼到你子佈景主題的 `functions.php` 檔案的最下方。

```php
<?php
// 在 functions.php 的最尾端，PHP 結束標籤 ?> 之前加入

/**
 * Moksa - 註冊自訂導覽選單位置
 * 
 * 使用 'after_setup_theme' 這個 action hook 來確保在主題初始化後再執行。
 * 這是一個 WordPress 開發的最佳實踐。
 */
function moksa_register_custom_menus() {
  register_nav_menus(
    array(
      'primary_menu' => __( '主要導覽選單', 'moksa' ), // 'unique-key' => '後台顯示名稱'
      'footer_menu'  => __( '頁腳版權選單', 'moksa' ),
    )
  );
}
add_action( 'after_setup_theme', 'moksa_register_custom_menus' );

```

**程式碼解說：**

*   `function moksa_register_custom_menus() { ... }`：我們定義了一個自訂的函式，這是一個好習慣，可以避免與其他外掛或主題的函式名稱衝突。**Moksa 技巧：** 函式名稱加上自己專案或團隊的前綴 (prefix)，例如 `moksa_`。
*   `add_action( 'after_setup_theme', ... )`：我們使用 `add_action` 將我們的函式「掛載」到 WordPress 的 `after_setup_theme` 這個「鉤點 (Hook)」上。這能確保我們的程式碼在正確的時機點被執行。
*   `register_nav_menus( array(...) )`：這是核心函式。
    *   `'primary_menu'` 和 `'footer_menu'` 是這個選單位置的**唯一識別碼 (ID)**，我們稍後在模板檔案中呼叫選單時會用到它。
    *   `'主要導覽選單'` 和 `'頁腳版權選單'` 則是在 WordPress 後台會顯示給使用者看的**名稱**。

#### 步驟 3：在後台確認結果

儲存 `functions.php` 檔案後，回到你的 WordPress 後台，前往「**外觀**」>「**選單 (Menus)**」。

你會發現在「**選單設定 (Menu Settings)**」區塊下方的「**顯示位置 (Display location)**」出現了我們剛剛註冊的兩個新位置：「主要導覽選單」和「頁腳版權選單」。

``
*示意圖：WordPress 後台選單設定頁面，顯示出新註冊的兩個選單位置。*

#### 步驟 4：在佈景主題中顯示選單

註冊了位置還不夠，我們還需要告訴佈景主題「在哪裡」顯示這個選單。這需要編輯對應的模板檔案 (template file)，例如 `header.php` 或 `footer.php`。

假設我們要在 `header.php` 中顯示「主要導覽選單」，請打開子佈景主題的 `header.php` 檔案，在你想顯示選單的地方，加入以下程式碼：

```php
<?php
wp_nav_menu( array(
    'theme_location' => 'primary_menu', // 此處的 ID 必須對應 register_nav_menus() 中設定的唯一識別碼
    'container'      => 'nav',           // 選單最外層的 HTML 標籤
    'menu_class'     => 'main-navigation', // ul 標籤的 class
) );
?>
```

**Moksa 技巧：** `wp_nav_menu()` 函式非常強大，它有很多參數可以客製化輸出的 HTML 結構與 CSS class，方便前端工程師進行樣式設計。

---

### 任務二：註冊自訂側邊欄/小工具區域 (Register Sidebars)

「側邊欄 (Sidebar)」在 WordPress 中是一個比較廣義的概念，它不一定真的在網頁的「側邊」。任何可以讓你從後台拖拉「小工具 (Widget)」進去的地方，都可以被稱為一個 Sidebar 或 Widget Area。例如，頁腳的「關於我們」、「聯絡資訊」等區塊，就很適合註G冊成一個個獨立的小工具區域。

#### 步驟 1：了解 `register_sidebar()` 函式

WordPress 使用 `register_sidebar()` 這個函式來註冊單一的小工具區域。與註冊選單類似，我們也需要將它掛載在一個正確的 Action Hook 上，這個 Hook 是 `widgets_init`。

#### 步驟 2：撰寫註冊側邊欄的程式碼

同樣地，將下方的程式碼片段複製並貼到你子佈景主題的 `functions.php` 檔案中。

```php
<?php
// 在 functions.php 的最尾端，PHP 結束標籤 ?> 之前加入

/**
 * Moksa - 註冊自訂小工具區域
 * 
 * 使用 'widgets_init' 這個 action hook。
 */
function moksa_register_custom_sidebars() {

  // 註冊第一個：部落格文章側邊欄
  register_sidebar( array(
    'name'          => __( '部落格側邊欄', 'moksa' ),
    'id'            => 'blog-sidebar', // **非常重要的唯一識別碼**
    'description'   => __( '顯示在單篇部落格文章頁面的側邊欄。', 'moksa' ),
    'before_widget' => '<section id="%1$s" class="widget %2$s">', // 每個小工具前的 HTML
    'after_widget'  => '</section>', // 每個小工具後的 HTML
    'before_title'  => '<h2 class="widget-title">', // 小工具標題前的 HTML
    'after_title'   => '</h2>', // 小工具標題後的 HTML
  ) );

  // 註冊第二個：頁腳小工具區域
  register_sidebar( array(
    'name'          => __( '頁腳小工具區', 'moksa' ),
    'id'            => 'footer-widget-area',
    'description'   => __( '顯示在網站頁腳的區塊，可以用來放聯絡資訊等。', 'moksa' ),
    'before_widget' => '<div id="%1$s" class="footer-widget %2$s">',
    'after_widget'  => '</div>',
    'before_title'  => '<h3 class="footer-widget-title">',
    'after_title'   => '</h3>',
  ) );

}
add_action( 'widgets_init', 'moksa_register_custom_sidebars' );

```

**程式碼解說：**

*   `'id'`：**這是最重要的參數**，它是這個側邊欄的唯一識別碼，我們在模板中呼叫它時會用到。**必須是全小寫英文字母，且不能有空格**。
*   `'name'` & `'description'`：顯示在後台的名稱與描述，方便使用者理解這個區域的用途。
*   `'before_widget'`, `'after_widget'`, `'before_title'`, `'after_title'`：這些參數讓我們可以**精準控制每個小工具輸出的 HTML 結構**。這對於前端樣式設計至關重要，可以確保網站整體的 HTML 語意化與樣式一致性。

#### 步驟 3：在後台確認結果

儲存檔案後，回到 WordPress 後台，前往「**外觀**」>「**小工具 (Widgets)**」。

你現在會看到右側出現了我們剛剛註冊的兩個新的可用區域：「部落格側邊欄」和「頁腳小工具區」。你可以試著從左邊拖拉任何一個小工具（例如：搜尋、最新文章）到這兩個新區域中。

``
*示意圖：WordPress 後台小工具頁面，顯示出新註冊的兩個 Widget 區域。*

#### 步驟 4：在佈景主題中顯示側邊欄

最後，我們要在模板檔案中將這個小工具區域顯示出來。你需要使用 `dynamic_sidebar()` 這個函式。

例如，要在 `footer.php` 中顯示「頁腳小工具區」，請打開 `footer.php` 檔案，在適當的位置加入以下程式碼：

```php
<?php
// 檢查這個小工具區域是否「有」被放置任何小工具
// 如果沒有，則這段區域的 HTML 就不會被輸出，是一個很好的開發習慣。
if ( is_active_sidebar( 'footer-widget-area' ) ) : ?>
    <div id="footer-widgets" class="widget-area" role="complementary">
        <?php dynamic_sidebar( 'footer-widget-area' ); // 使用 'id' 來呼叫對應的側邊欄 ?>
    </div><!-- #footer-widgets -->
<?php endif; ?>
```

**Moksa 技巧：** 在呼叫 `dynamic_sidebar()` 之前，先用 `is_active_sidebar()` 來做一個判斷，是一個**非常專業且必要的習慣**。這可以避免在沒有放置任何小工具時，還輸出一堆空的 HTML 標籤，讓你的網頁原始碼更乾淨。

---

### 總結

恭喜你！你已經學會了如何使用 `functions.php` 來完成兩項最基礎也最重要的佈景主題客製化任務。

*   我們學會了使用 `register_nav_menus()` 來建立新的選單位置，並用 `wp_nav_menu()` 將它顯示出來。
*   我們學會了使用 `register_sidebar()` 來建立靈活的小工具區域，並用 `dynamic_sidebar()` 將它顯示出來。

`functions.php` 的潛力遠不止於此，它是你未來學習 WordPress Action Hooks、Filters，甚至是整合各種 API 的大門。熟練掌握這個檔案的用法，你就能將一個平凡的佈景主題，打造成完全符合客戶需求的強大網站。

在下一個章節，我們將會探索更多 `functions.php` 的進階應用，敬請期待！