# 02.06 (實務) jQuery 在 WordPress 中的角色

嗨，歡迎來到這個章節！我是你在 Moksa 的課程導師。

在 WordPress 的主題與外掛開發世界中，你幾乎無法避開 JavaScript。而在眾多 JavaScript 函式庫中，jQuery 扮演了一個既重要又有點歷史包袱的角色。許多 WordPress 核心功能、老牌外掛和佈景主題都深度依賴它。

這堂課的目標，不是要讓你成為 jQuery 大師，而是要讓你**精準地了解**它在 WordPress 生態系中的**正確使用方式**。學會了正確的觀念與方法，你才能避免與其他外掛產生衝突，並寫出更穩定、更專業的程式碼。

---

### 什麼是 jQuery？為什麼 WordPress 需要它？

簡單來說，jQuery 是一個 JavaScript 的函式庫 (Library)。它的口號是「Write Less, Do More」（寫得更少，做得更多）。在過去，原生的 JavaScript 在處理瀏覽器相容性、DOM 操作（就是控制網頁上的元素）、事件處理和 AJAX 請求時，語法相當繁瑣。jQuery 的出現，將這些複雜的操作簡化成非常直觀的語法。

例如，要改變一個 ID 為 `main-title` 的標題顏色，原生 JavaScript 可能需要這樣寫：

```javascript
document.getElementById('main-title').style.color = 'red';
```

而使用 jQuery，只需要一行：

```javascript
$('#main-title').css('color', 'red');
```

因為它的便利性，WordPress 在很早期的版本就將 jQuery 整合進核心之中，作為前端互動的標準工具之一。直到今天，儀表板後台的許多功能，以及大量的外掛（例如 WooCommerce 的某些部分），依然使用 jQuery。

---

### 1. WordPress 中載入 jQuery 的「唯一」正確方法

這是一個**最重要的觀念**，也是新手最常犯錯的地方。

**錯誤示範：** 很多來自網路上其他領域的教學，會教你直接在 `<head>` 標籤中用 `<script>` 標籤引入 jQuery 的 CDN 檔案。

```html
<!-- 這是錯誤的作法，絕對不要在 WordPress 中這樣做！ -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
```

**為什麼錯誤？**
*   **版本衝突：** WordPress 核心自己已經註冊了一個特定版本的 jQuery。如果你再載入另一個版本，會導致頁面上有兩個不同版本的 jQuery，這會引發各種無法預期的錯誤。
*   **重複載入：** 很多外掛也會依賴 WordPress 內建的 jQuery。如果你自己載入一次，外掛又載入一次，會造成資源浪費，拖慢網站速度。

**Moksa 技巧：永遠使用 `wp_enqueue_script()`**

在 WordPress 中，載入任何 CSS 或 JavaScript 檔案的標準作法，就是透過 `functions.php` 檔案中的 `wp_enqueue_script()` 函式。

如果你要載入的腳本**需要** jQuery 才能運作，你只需要在函式的「相依性 (dependency)」參數中宣告它。

```php
// 在你的佈景主題 (建議是子佈景主題) 的 functions.php 中
function moksa_enqueue_custom_scripts() {
    // 註冊並載入我們的自訂腳本 custom-script.js
    // 注意第三個參數 array('jquery')
    wp_enqueue_script(
        'moksa-custom-script', // 腳本的唯一代號
        get_stylesheet_directory_uri() . '/assets/js/custom-script.js', // 腳本的路徑
        array('jquery'), // **重點：宣告這個腳本依賴 jQuery**
        '1.0.0', // 版本號
        true // true 代表在頁尾載入，有助於效能
    );
}
add_action('wp_enqueue_scripts', 'moksa_enqueue_custom_scripts');
```

當你這樣做時，WordPress 會自動檢查：
1.  jQuery 是否已經被載入？
2.  如果還沒，它會先**自動載入 WordPress 核心自帶的 jQuery**。
3.  然後，再載入你的 `custom-script.js`。

這樣就完美地解決了版本衝突和重複載入的問題。

---

### 2. 理解 jQuery 的「noConflict」模式

這是第二個**最重要的觀念**。

為了避免和其他可能也使用 `$` 符號作為變數的 JavaScript 函式庫衝突，WordPress 載入的 jQuery 會自動進入「**無衝突 (noConflict) 模式**」。

這代表你**不能**直接使用我們最熟悉的 `$` 符號來呼叫 jQuery。

**錯誤示範：** 如果你在 WordPress 環境中這樣寫，瀏覽器的主控台 (Console) 會報錯 `Uncaught TypeError: $ is not a function`。

```javascript
// 在 WordPress 中，這會報錯！
$(document).ready(function(){
    // ... 你的程式碼 ...
    $('#my-button').on('click', function(){
        alert('按鈕被點擊了！');
    });
});
```

**正確的寫法有兩種：**

**方法一：直接使用 `jQuery`**

將所有的 `$` 符號都換成 `jQuery` 這個全名。

```javascript
// 寫法一：直接使用 jQuery
jQuery(document).ready(function(){
    jQuery('#my-button').on('click', function(){
        alert('按鈕被點擊了！');
    });
});
```

**方法二（Moksa 技巧）：使用匿名函式包裹 (Wrapper)**

這是更專業、更普遍的作法。我們將所有程式碼放在一個立即執行的函式 (IIFE) 中，並將 `jQuery` 物件作為參數傳入，然後在函式內部，我們就可以安全地使用 `$` 作為它的別名。

```javascript
// 寫法二：推薦的專業作法
(function($) {
    // 在這個函式的作用域 (scope) 內，'$' 就等於 jQuery
    // 你可以安全地使用平常習慣的 $ 符號了

    // 等待 DOM 完全載入後再執行
    $(document).ready(function(){
        $('#my-button').on('click', function(){
            console.log('按鈕被點擊了！');
            $('#my-message').toggle();
        });
    });

    // 你也可以在這裡寫其他的 jQuery 程式碼
    // ...

})(jQuery);
```

``
*截圖說明：展示瀏覽器開發者工具的 Console，一個是報錯的畫面，另一個是成功執行的畫面。*

---

### 3. (實作) 為我們的文章標題加上點擊互動效果

現在，我們來實際操作一次。我們的目標是：當使用者點擊任何文章的 `<h1>` 標題時，標題下方會滑出一個提示訊息。

**步驟 1：建立 JavaScript 檔案**

1.  在你的子佈景主題資料夾內，建立一個路徑 `assets/js/`。
2.  在 `js` 資料夾內，建立一個新檔案，命名為 `single-post-interactive.js`。
3.  將以下程式碼貼入 `single-post-interactive.js`：

```javascript
(function($) {
    'use strict'; // 啟用 JavaScript 嚴格模式，是個好習慣

    $(document).ready(function(){
        // 選取文章內容區塊中的 h1 標題
        var $postTitle = $('.entry-content h1.entry-title');

        // 檢查標題是否存在
        if ($postTitle.length) {
            // 在標題後面插入一個隱藏的訊息 div
            $postTitle.after('<div id="moksa-tip" style="display:none; padding: 10px; background-color: #f0f0f0; border: 1px solid #ccc; margin-top: 10px;">這是 Moksa 的 jQuery 互動提示！</div>');

            // 為標題加上一個點擊事件
            $postTitle.on('click', function(){
                // 讓提示訊息用滑動的方式顯示或隱藏
                $('#moksa-tip').slideToggle();
            }).css('cursor', 'pointer'); // 改變滑鼠游標，提示使用者這可以點擊
        }
    });

})(jQuery);
```

**步驟 2：在 `functions.php` 中載入腳本**

1.  打開你的子佈景主題的 `functions.php` 檔案。
2.  加入以下 PHP 程式碼：

```php
function moksa_enqueue_interactive_script() {
    // is_single() 是一個 WordPress 條件標籤
    // 代表這段腳本只會在「單一文章」頁面載入，提高網站效能
    if (is_single()) {
        wp_enqueue_script(
            'moksa-interactive-title', // 唯一的代號
            get_stylesheet_directory_uri() . '/assets/js/single-post-interactive.js', // 檔案路徑
            array('jquery'), // **必填：宣告依賴 jQuery**
            '1.0.1', // 版本號
            true // 在頁尾載入
        );
    }
}
add_action('wp_enqueue_scripts', 'moksa_enqueue_interactive_script');
```
> **Moksa 技巧：** 注意我們使用了 `is_single()` 條件判斷。這是一個非常重要的效能優化習慣。不要在每個頁面都載入你不需要的腳本，只在它們需要出現的頁面載入。

**步驟 3：驗證結果**

1.  儲存 `functions.php` 和 `single-post-interactive.js`。
2.  前往你網站的任何一篇文章頁面。
3.  試著點擊文章標題。
4.  你應該會看到標題下方出現一個提示訊息，再次點擊就會收合。

``
*截圖說明：顯示一篇文章頁面，標題下方出現了「這是 Moksa 的 jQuery 互動提示！」的灰色區塊。*

---

### 總結

jQuery 在 WordPress 開發中依然佔有一席之地，尤其是在維護舊專案或與大量外掛生態系互動時。

請務必記住本章節的三大核心重點：
1.  **永遠使用 `wp_enqueue_script` 載入腳本**，並將 `jquery` 設定為相依性。
2.  **永遠使用 `(function($){...})(jQuery);` 的包裹寫法**，以安全地使用 `$` 符號。
3.  **善用 WordPress 的條件標籤（如 `is_single()`）**，只在需要的頁面載入腳本，提升網站效能。

雖然現在的前端開發主流已逐漸轉向 Vanilla JS (原生 JS) 或 React (Gutenberg 區塊編輯器的基礎) 等現代框架，但掌握與 jQuery 正確的協作方式，是你成為一位成熟 WordPress 開發者不可或缺的技能。

在接下來的課程中，我們將會接觸到更複雜的 AJAX 應用，而今天學到的基礎將會派上用場。我們下堂課見！