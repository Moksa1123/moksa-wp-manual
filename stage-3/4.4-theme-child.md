# 04.04 (實作) 打造一個「子主題 (Child Theme)」

嗨，歡迎來到 MoksaWP 開發課程！在前面的章節中，我們學會了如何挑選與安裝佈景主題。然而，在實務開發中，我們幾乎**不會**直接修改佈景主題本身的檔案。為什麼呢？因為一旦佈景主題更新，你所做的任何客製化修改都會被覆蓋，付諸東流。

為了解決這個問題，WordPress 提供了一個非常優雅且強大的解決方案：「**子主題 (Child Theme)**」。

這堂課，我們將親手打造一個子主題，這是一個 WordPress 開發者必備的基礎技能。

---

### 什麼是子主題 (Child Theme)？

簡單來說，子主題就像是覆蓋在「**父主題 (Parent Theme)**」之上的一個透明圖層。

*   它繼承了父主題所有的功能、樣式和模板檔案。
*   你可以在子主題中安全地新增自己的 CSS 樣式、PHP 函式，或覆寫父主題的特定模板檔案。
*   當父主題更新時，由於你的修改都在子主題中，所以完全不受影響，可以安心更新以獲取最新的功能與安全修補。

### 何時需要使用子主題？

你可能會想，我什麼時候才需要用到子主題呢？

*   **當你需要修改 `functions.php`**：例如，你想新增一段 PHP 程式碼來調整 WooCommerce 的功能或註冊新的圖片尺寸。
*   **當你需要修改佈景主題的模板檔案**：例如，你想調整文章頁 (`single.php`) 的版面結構，或客製化 WooCommerce 的商品頁面 (`single-product.php`)。
*   **當你需要大幅修改 CSS 樣式**：雖然可以透過 WordPress 內建的「附加的 CSS」功能來修改，但當樣式碼很多時，放在子主題的 `style.css` 中會更容易管理與維護。

> **Moksa 技巧**：如果你只是使用佈景主題的設定選項 (例如在「自訂」中調整顏色、字體)，或是全程使用像 **Kadence Blocks**、**Elementor** 這類的頁面編輯器來設計頁面，那麼你**可能不需要**子主題。子主題主要用於需要「動到程式碼」的客製化情境。

---

### (實作) 打造你的第一個子主題

接下來，我們將以 Moksa 推薦的 **Kadence 佈景主題** 為例，為它建立一個子主題。

#### **事前準備**

1.  **本機開發環境**：請確保你的 **LocalWP** 站點正在運行。
2.  **父主題**：在你的 WordPress 網站中，已經安裝並啟用 **Kadence** 佈景主題。
3.  **程式碼編輯器**：我們推薦使用 **VS Code**。

---

#### **步驟 1：建立子主題資料夾**

首先，我們需要建立一個專屬的資料夾來存放子主題的檔案。

1.  打開你的網站檔案目錄，導航至 `wp-content/themes/`。
2.  在這裡，你會看到所有已安裝的佈景主題資料夾，例如 `kadence`, `twentytwentyfour` 等。
3.  在此路徑下，新增一個資料夾。**命名規則**通常是「**父主題資料夾名稱-child**」。因為 Kadence 的資料夾名稱是 `kadence`，所以我們的子主題資料夾就命名為 `kadence-child`。

` `` `
*示意圖：在 `wp-content/themes` 資料夾中新增 `kadence-child` 資料夾。*

---

#### **步驟 2：建立核心檔案 `style.css`**

子主題**最核心、最不可或缺**的檔案就是 `style.css`。這個檔案不僅用來存放你的自訂 CSS，更重要的是，它的頂部註解（Header）用來告訴 WordPress：「這是一個子主題，它的爸爸是誰」。

1.  在 `kadence-child` 資料夾內，新增一個名為 `style.css` 的檔案。
2.  使用 VS Code 打開這個檔案，並貼上以下內容：

```css
/*
 Theme Name:   Kadence Child
 Theme URI:    https://moksaweb.com/
 Description:  Moksa's custom child theme for Kadence.
 Author:       Moksa Technologies
 Author URI:   https://moksaweb.com
 Template:     kadence
 Version:      1.0.0
 License:      GNU General Public License v2 or later
 License URI:  http://www.gnu.org/licenses/gpl-2.0.html
 Tags:         light, dark, two-columns, right-sidebar, responsive-layout, accessibility-ready
 Text Domain:  kadence-child
*/
```

**重點欄位解說**：

*   **`Theme Name`**: **(必填)** 子主題的名稱，它會顯示在 WordPress 後台。
*   **`Template`**: **(必填，最重要！)** 這個欄位的值**必須**是**父主題的資料夾名稱**，大小寫要完全一致。這就是告訴 WordPress「我的父主題是 `kadence`」的關鍵設定。如果填錯，子主題將無法運作。
*   其他欄位如 `Description`, `Author`, `Version` 等，可以根據你的需求自行修改。

---

#### **步驟 3：建立 `functions.php` 並載入樣式**

現在我們有了子主題的「宣告檔」，但還有一件很重要的事情要做：載入父主題和子主題的 CSS 樣式表。如果沒有做這一步，你的網站啟用子主題後會看起來像「裸奔」一樣，沒有任何樣式。

我們需要在子主題中建立一個 `functions.php` 檔案來處理這件事。

1.  在 `kadence-child` 資料夾內，新增一個名為 `functions.php` 的檔案。
2.  使用 VS Code 打開這個檔案，並貼上以下 PHP 程式碼：

```php
<?php
/**
 * Kadence Child Theme functions and definitions
 *
 * @link https://developer.wordpress.org/themes/basics/theme-functions/
 *
 * @package Kadence Child
 */

add_action( 'wp_enqueue_scripts', 'moksa_child_theme_enqueue_styles' );

function moksa_child_theme_enqueue_styles() {
    // 載入父主題的 style.css
    wp_enqueue_style( 'kadence-parent-style', get_template_directory_uri() . '/style.css' );

    // 載入子主題的 style.css，並將父主題的樣式設為依賴
    wp_enqueue_style( 'kadence-child-style',
        get_stylesheet_directory_uri() . '/style.css',
        array( 'kadence-parent-style' )
    );
}

// 在這裡開始加入你自己的客製化 PHP 程式碼...

```

**Moksa 技巧與程式碼解說**：

*   `add_action( 'wp_enqueue_scripts', ... )`：這是 WordPress 官方推薦用來載入 CSS 和 JavaScript 的標準「**掛鉤 (Hook)**」。
*   `wp_enqueue_style()`：這是 WordPress 用來載入 CSS 檔案的標準函式。
*   `get_template_directory_uri()`：這個函式會取得**父主題**的資料夾網址。我們用它來載入父主題的 `style.css`。
*   `get_stylesheet_directory_uri()`：這個函式會取得**當前啟用主題 (也就是子主題)** 的資料夾網址。
*   `array( 'kadence-parent-style' )`：這是設定「**依賴關係 (Dependency)**」。我們告訴 WordPress，在載入 `kadence-child-style` 之前，**必須**先載入 `kadence-parent-style`。這樣才能確保子主題的 CSS 可以正確地覆蓋父主題的樣式。**這是一個非常重要的最佳實踐**，遠比舊的 `@import` 方式效能更好。

---

#### **步驟 4：（選用）加入佈景主題預覽圖 `screenshot.png`**

為了讓你的子主題在後台看起來更專業，你可以為它加上一張預覽圖。

1.  準備一張 `1200px * 900px` 的圖片。
2.  將圖片命名為 `screenshot.png` (必須是這個檔名)。
3.  將 `screenshot.png` 檔案放到 `kadence-child` 資料夾的根目錄下。

` `` `
*示意圖：`kadence-child` 資料夾內包含 `style.css`, `functions.php`, 和 `screenshot.png` 三個檔案。*

---

#### **步驟 5：啟用你的子主題**

恭喜！你的子主題已經準備就緒。現在，讓我們來啟用它。

1.  登入你的 WordPress 後台。
2.  前往「**外觀**」>「**佈景主題**」。
3.  你會看到剛剛建立的「Kadence Child」已經出現在佈景主題清單中。
4.  點擊「**啟用**」按鈕。

` `` `
*示意圖：在 WordPress 後台的佈景主題頁面，顯示 Kadence Child 主題並點擊啟用。*

啟用後，你的網站前台看起來應該要跟啟用父主題時一模一樣。這代表子主題已成功繼承了所有父主題的樣式與功能。

從現在開始：
*   任何自訂的 CSS，都應該寫在 `kadence-child/style.css` 中。
*   任何自訂的 PHP 函式，都應該寫在 `kadence-child/functions.php` 中。
*   你可以安心地更新 Kadence 父主題，而不用擔心你的客製化程式碼會遺失。

這就是 WordPress 子主題的強大之處，也是專業開發流程的基礎。在後續的課程中，我們將大量運用子主題來覆寫 WooCommerce 的模板檔案，實現更深度的電商網站客製化。