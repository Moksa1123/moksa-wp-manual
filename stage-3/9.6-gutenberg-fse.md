# 09.06 (實務) (進階) 打造一個「全站編輯 (FSE)」主題

大家好，我是 Moksa 的首席課程導師。

歡迎來到 WordPress 開發的下一個世代！在這個章節中，我們將深入探討 WordPress 最具革命性的功能之一：**全站編輯 (Full Site Editing, FSE)**，或現在更常被稱為「**區塊佈景主題 (Block Theme)**」。

傳統的佈景主題開發高度依賴 PHP 檔案 (如 `header.php`, `single.php`, `page.php`) 來定義網站的結構。而區塊佈景主題則徹底改變了這個模式，它讓我們能**使用古騰堡區塊編輯器來設計與建構整個網站**，從頁首 (Header) 到頁尾 (Footer)，一切都變成了可視化的區塊。

這堂課的目標是帶領你從零開始，親手打造一個基礎但功能完整的區塊佈景主題。我們將學習 FSE 的核心檔案結構、`theme.json` 的強大之處，以及如何將程式碼與可視化編輯器完美結合。

---

### 課前準備

在開始之前，請確保你的開發環境已經準備就緒。

1.  **本機環境:** 啟動 **LocalWP** 並建立一個全新的 WordPress 網站。
2.  **程式碼編輯器:** 開啟 **VS Code**。
3.  **必備外掛:** 在新的 WordPress 網站中，安裝並啟用官方推薦的輔助外掛「**Create Block Theme**」。這個工具能幫助我們在網站編輯器中所做的變更，方便地匯出成主題檔案。

``
*（安裝並啟用 Create Block Theme 外掛的畫面）*

---

### FSE 的核心概念

一個區塊佈景主題主要由以下幾個部分構成，徹底顛覆了我們對傳統主題的認知：

*   **`theme.json` (核心大腦):**
    *   這是 FSE 的**靈魂檔案**。它是一個 JSON 格式的設定檔，用來集中管理全站的設計規範 (Design System)。
    *   你可以定義**全域樣式 (Global Styles)**，例如：品牌色票、字體大小、間距、版面寬度等。
    *   你還可以控制**所有區塊的預設樣式**與**可用的設定選項**。例如，你可以禁用段落區塊的「首字放大」功能，或為按鈕區塊新增一種「描邊」樣式。
*   **`templates` 資料夾 (網站骨架):**
    *   存放網站的主要範本，例如 `index.html` (首頁/彙整頁)、`single.html` (單一文章)、`page.html` (頁面)。
    *   這些檔案**不是 PHP**，而是包含了古騰堡區塊標記 (Block Markup) 的 **HTML 檔案**。
*   **`parts` 資料夾 (可重用積木):**
    *   存放可重複使用的「範本組件」，最常見的就是 `header.html` 和 `footer.html`。
    *   在 `templates` 中的範本可以隨時引用這些組件，實現模組化管理。
*   **`patterns` 資料夾 (預設版型):**
    *   你可以將一組設計好的區塊組合註冊為「區塊版型 (Block Pattern)」，讓使用者在編輯文章或頁面時可以一鍵插入，大幅提升內容建構效率。
*   **`style.css` (身分證):**
    *   在 FSE 中，`style.css` 的主要作用不再是存放大量的 CSS 程式碼。它的**核心任務是提供佈景主題的標頭資訊** (Theme Name, Author, Version 等)。
    *   當然，你仍然可以在這裡撰寫一些無法透過 `theme.json` 或區塊樣式實現的複雜 CSS。

---

### (實作) 打造你的第一個 FSE 主題

現在，讓我們捲起袖子，一步步建立名為 `Moksa FSE` 的佈景主題。

#### 步驟 1：建立主題基本檔案結構

1.  在你的 LocalWP 網站資料夾中，導覽至 `/app/public/wp-content/themes/`。
2.  建立一個新的資料夾，命名為 `moksa-fse`。
3.  使用 VS Code 打開這個 `moksa-fse` 資料夾。
4.  在資料夾內建立以下檔案：

    *   `style.css`
    *   `index.php` (作為傳統模式的向下相容備用檔案)
    *   `theme.json` (目前留空)
    *   建立 `templates` 資料夾
    *   建立 `parts` 資料夾

5.  編輯 `style.css`，填入**必填的主題資訊**：

    ```css
    /**
     * Theme Name: Moksa FSE
     * Author: Moksa Web
     * Author URI: https://moksaweb.com/
     * Version: 1.0.0
     * Requires at least: 6.0
     * Tested up to: 6.5
     * Requires PHP: 7.4
     * License: GNU General Public License v2 or later
     * License URI: http://www.gnu.org/licenses/gpl-2.0.html
     * Text Domain: moksa-fse
     *
     * This theme is a block theme and supports the site editor.
     */
    ```

6.  編輯 `index.php`，內容可以非常簡單：

    ```php
    <?php
    // Silence is golden.
    // This file is required for theme activation in older WP versions.
    ```

``
*（VS Code 中顯示 moksa-fse 主題的初始檔案結構）*

現在，回到 WordPress 後台 > 外觀 > 佈景主題，你應該能看到「Moksa FSE」了，點擊**啟用**它。

#### 步驟 2：定義 `theme.json` 的基礎設計規範

`theme.json` 是 FSE 的核心。讓我們為它添加一些基礎設定。

將以下 JSON 內容貼到你的 `theme.json` 檔案中。

```json
{
  "$schema": "https://schemas.wp.org/wp/6.5/theme.json",
  "version": 2,
  "settings": {
    "appearanceTools": true,
    "layout": {
      "contentSize": "800px",
      "wideSize": "1200px"
    },
    "color": {
      "palette": [
        {
          "slug": "primary",
          "color": "#0057FF",
          "name": "Primary"
        },
        {
          "slug": "secondary",
          "color": "#373F41",
          "name": "Secondary"
        },
        {
          "slug": "background",
          "color": "#F6F9FC",
          "name": "Background"
        },
        {
          "slug": "foreground",
          "color": "#FFFFFF",
          "name": "Foreground"
        }
      ]
    },
    "typography": {
      "fontFamilies": [
        {
          "fontFamily": "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'",
          "slug": "system-font",
          "name": "System Font"
        }
      ]
    }
  },
  "styles": {
    "typography": {
      "fontFamily": "var(--wp--preset--font-family--system-font)"
    },
    "elements": {
      "heading": {
        "typography": {
          "fontWeight": "700"
        }
      },
      "link": {
        "color": {
          "text": "var(--wp--preset--color--primary)"
        },
        ":hover": {
          "color": {
            "text": "var(--wp--preset--color--secondary)"
          }
        }
      }
    }
  }
}
```

**Moksa 技巧：** 這份 `theme.json` 做了幾件重要的事：
*   `"appearanceTools": true`：這是一個捷徑，會自動啟用許多設計工具 (邊框、邊距、行高等)，強烈建議開啟。
*   `"layout"`：定義了內容的**預設寬度** (`contentSize`) 和**寬版寬度** (`wideSize`)。
*   `"color.palette"`：定義了我們的**品牌色票**。這些顏色會出現在編輯器所有顏色選擇器中。
*   `"styles"`：將我們在 `settings` 中定義的預設值**應用到全站**。例如，我們將預設字體設為系統字體，並設定了所有連結的顏色。

儲存檔案後，回到網站前台，你可能還看不到任何東西，這是正常的，因為我們還沒有建立任何範本。

#### 步驟 3：使用網站編輯器建立「範本組件 (Parts)」

現在，神奇的時刻來了。我們將使用可視化介面來建立 `header` 和 `footer`。

1.  從 WordPress 後台，前往 **外觀 > 編輯器**。你會進入全站編輯模式。
2.  在左側面板選擇 **範本組件 (Template Parts)**。
3.  點擊右上角的「**新增**」按鈕。
4.  輸入組件名稱 `header`，選擇「**頁首**」類型，然後點擊「建立」。
5.  現在你進入了 `header` 的編輯畫面。點擊 `+` 號，加入以下區塊：
    *   **網站標題 (Site Title)**
    *   **導覽 (Navigation)**
    *   你可以用「列 (Row)」或「群組 (Group)」區塊來排版它們。
6.  設計完成後，點擊右上角的「**儲存**」。

``
*（在網站編輯器中拖拉區塊來設計 header 的畫面）*

7.  重複同樣的流程，建立一個名為 `footer` 的範本組件，可以加入「網站標題」和「版權文字」等區塊。

#### 步驟 4：建立主要的「範本 (Templates)」

有了可重用的 `header` 和 `footer`，我們來建立網站的主要範本。

1.  在網站編輯器左側面板，選擇 **範本 (Templates)**。
2.  目前應該是空的。點擊右上角的「**新增**」按鈕。
3.  我們先來建立「**首頁 (Index)**」範本。在列表中選擇它，然後 WordPress 會自動載入一個預設結構。
4.  這個預設結構通常包含了「**頁首**」和「**頁尾**」範本組件。中間的內容區域，最核心的區塊是「**查詢迴圈 (Query Loop)**」，它負責顯示你的文章列表。
5.  你可以自由調整「查詢迴圈」內的排版，例如設定每篇文章要顯示「精選圖片」、「文章標題」、「文章摘要」和「閱讀更多」按鈕。
6.  調整完畢後，點擊「**儲存**」。

``
*（在網站編輯器中調整 Index 範本，其中包含了 Header 組件、Query Loop 和 Footer 組件）*

7.  接著，用同樣的方式新增一個「**單篇文章 (Single Post)**」範本。
8.  在單篇文章範本中，核心區塊是「**文章標題 (Post Title)**」、「**文章內容 (Post Content)**」和「**文章作者 (Post Author)**」等。確保你也插入了 `header` 和 `footer` 組件。
9.  完成後儲存。

#### 步驟 5：將編輯器中的變更匯出至主題檔案

我們剛剛在網站編輯器做的所有設計，其實都儲存在資料庫中。為了讓它們成為我們佈景主題的一部分，需要使用「Create Block Theme」外掛。

1.  在網站編輯器左側面板，點擊外掛新增的「**Create Block Theme**」選項。
2.  選擇「**Export theme**」。
3.  輸入主題名稱（例如 Moksa FSE），然後點擊「**Export**」按鈕。
4.  你會下載一個 `.zip` 檔案。

``
*（Create Block Theme 外掛的匯出選項畫面）*

5.  解壓縮這個檔案，你會看到 `templates` 和 `parts` 資料夾現在包含了我們剛剛在編輯器中設計的 `index.html`, `single.html`, `header.html`, `footer.html` 等檔案！
6.  將這些新產生的檔案和資料夾**複製回**你本地的 `moksa-fse` 主題資料夾中，覆蓋原有的空資料夾。

**Moksa 技巧：** 這就是 FSE 開發的標準工作流程：**在編輯器中快速原型設計 -> 匯出成檔案 -> 納入版本控制 (Git)**。這讓你同時享有可視化編輯的便利性和程式碼管理的穩定性。

#### 步驟 6：(進階) 註冊自訂區塊版型 (Pattern)

最後，讓我們來為主題添加一個自訂的區塊版型。

1.  在你的 `moksa-fse` 主題資料夾中，建立一個新資料夾 `patterns`。
2.  在 `patterns` 資料夾內，建立一個 `hero-section.php` 檔案。
3.  在 VS Code 中，打開 `hero-section.php` 並貼上以下內容：

```php
<?php
/**
 * Title: Hero Section with Button
 * Slug: moksa-fse/hero-section
 * Categories: featured, text
 * Keywords: hero, call to action, button
 * Block Types: core/post-content
 */
?>
<!-- wp:group {"align":"full","style":{"spacing":{"padding":{"top":"80px","bottom":"80px"}}},"backgroundColor":"secondary","textColor":"foreground","layout":{"type":"constrained"}} -->
<div class="wp-block-group alignfull has-foreground-color has-secondary-background-color has-text-color has-background" style="padding-top:80px;padding-bottom:80px">
    <!-- wp:heading {"textAlign":"center","level":1,"style":{"typography":{"fontSize":"4rem"}}} -->
    <h1 class="wp-block-heading has-text-align-center" style="font-size:4rem">歡迎來到 Moksa FSE</h1>
    <!-- /wp:heading -->

    <!-- wp:paragraph {"align":"center"} -->
    <p class="has-text-align-center">這是一個使用區塊版型快速建立的英雄區塊。</p>
    <!-- /wp:paragraph -->

    <!-- wp:buttons {"layout":{"type":"flex","justifyContent":"center"}} -->
    <div class="wp-block-buttons">
        <!-- wp:button {"backgroundColor":"primary","textColor":"foreground"} -->
        <div class="wp-block-button"><a class="wp-block-button__link has-foreground-color has-primary-background-color has-text-color has-background wp-element-button">開始學習</a></div>
        <!-- /wp:button -->
    </div>
    <!-- /wp:buttons -->
</div>
<!-- /wp:group -->
```

**Moksa 技巧：**
*   檔案最上方的註解塊是**註冊版型的關鍵**。`Title` 是顯示名稱，`Slug` 是唯一識別碼。
*   下方的 HTML 內容就是**區塊標記 (Block Markup)**。要取得這些標記最快的方法是：在編輯器中設計好你想要的版型，選取所有區塊，點擊「…」選單，選擇「**複製**」，然後貼到你的 PHP 檔案中。

WordPress 會自動偵測 `patterns` 資料夾中的 PHP 檔案並註冊它們。現在，當你編輯任何頁面或文章時，點擊 `+` 號 > 版型，你就能找到並一鍵插入這個「Hero Section with Button」版型了！

---

### 結論

恭喜你！你已經成功從零到一建立了一個基礎的區塊佈景主題。

在這堂課中，我們學到了：
1.  FSE 主題的核心檔案結構 (`theme.json`, `templates`, `parts`, `patterns`)。
2.  如何使用 `theme.json` 來定義全站的設計語言與規範。
3.  在網站編輯器中建立可視化的範本與範本組件。
4.  將 UI 的變更匯出成主題檔案的標準開發流程。
5.  如何註冊一個自訂的區塊版型以供重複使用。

這只是 FSE 開發的起點。未來你還可以探索更複雜的 `theme.json` 設定、建立自訂的區塊樣式變化 (Style Variations)、以及開發自己的 React 古騰堡區塊。

FSE 代表了 WordPress 開發的未來，掌握它，你將能更高效、更靈活地打造現代化的 WordPress 網站。