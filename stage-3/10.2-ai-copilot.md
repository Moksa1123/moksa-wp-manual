# 10.02 (實務) 使用 GitHub Copilot (VS Code) 加速開發

你好，我是 Moksa 的首席課程導師。

在現代化的 WordPress 開發流程中，除了掌握核心的 PHP、JavaScript、HTML/CSS 之外，善用 AI 輔助工具已經是提升生產力的關鍵。GitHub Copilot 是由 GitHub 與 OpenAI 聯手打造的 AI 程式碼助理，它就像一位資深開發者坐在你旁邊，隨時提供程式碼建議、自動完成函式、甚至幫你撰寫整個功能。

本章節將帶你實際在 **VS Code** 環境中，結合我們的 **Moksa 技術棧**，學習如何利用 GitHub Copilot 大幅加速你的 WordPress 佈景主題與外掛開發流程。

---

### 學習目標

*   了解 GitHub Copilot 的核心功能與應用場景。
*   在 VS Code 中成功安裝並設定 GitHub Copilot。
*   學習如何透過「註解」驅動 Copilot 產生 WordPress 相關程式碼。
*   掌握使用 Copilot 撰寫 CPT、Meta Box、WP-CLI 指令等實務技巧。
*   理解 Copilot 的限制並學習最佳實踐，確保程式碼品質與安全性。

---

### 前置準備

在開始之前，請確保你已具備以下條件：

1.  **GitHub 帳號**：Copilot 需要綁定你的 GitHub 帳號。
2.  **GitHub Copilot 訂閱**：Copilot 是付費服務，你需要啟用訂閱 (通常有免費試用期)。
3.  **Visual Studio Code (VS Code)**：我們推薦的程式碼編輯器。
4.  **LocalWP 環境**：一個準備好的本機 WordPress 測試站。

---

### 步驟 1：在 VS Code 中安裝 GitHub Copilot

安裝 Copilot 非常簡單，只需要幾個點擊即可完成。

1.  打開 VS Code。
2.  點擊左側邊欄的「擴充功能 (Extensions)」圖示 (或按下 `Ctrl+Shift+X`)。
3.  在搜尋框中輸入「**GitHub Copilot**」。
4.  找到由 **GitHub** 發布的官方擴充套件，點擊「**安裝 (Install)**」。你會看到有兩個主要的套件：`GitHub Copilot` 和 `GitHub Copilot Chat`，**Moksa 技巧**：建議兩個都安裝，前者提供程式碼自動完成，後者提供一個互動式的聊天介面，更方便你提問、解釋程式碼或重構。

``
*截圖位置：在 VS Code 擴充功能市集中搜尋並安裝 GitHub Copilot 的畫面。*

5.  安裝完成後，VS Code 右下角會跳出一個提示，要求你登入 GitHub 帳號以授權 Copilot。
6.  點擊「**Sign in to GitHub**」，瀏覽器會被開啟，引導你完成授權流程。
7.  授權成功後，VS Code 右下角的 Copilot 圖示會呈現啟用狀態。

``
*截圖位置：VS Code 右下角顯示 Copilot 已成功啟用並運作的圖示。*

---

### 步驟 2：Copilot 核心使用方式

Copilot 主要有兩種與你互動的方式：

1.  **程式碼自動完成 (Inline Suggestions)**：
    *   當你開始輸入程式碼時，Copilot 會自動以「灰色文字」提供建議。
    *   如果你滿意這個建議，只需按下 `Tab` 鍵即可接受。
    *   如果你不滿意，可以繼續輸入，Copilot 會根據你的新內容提供不同建議。你也可以按下 `Alt+]` (或 `Option+]`) 來切換不同的建議。

2.  **註解生成程式碼 (Comment-to-Code)**：
    *   這是 Copilot 最強大的功能之一。你可以用**自然語言**（建議使用英文，效果最好）在註解中描述你想要的功能，Copilot 會嘗試為你生成對應的程式碼。
    *   寫完註解後，換到下一行，稍待片刻，Copilot 就會提供建議。

---

### 步驟 3：WordPress 開發實戰演練

現在，讓我們用幾個常見的 WordPress 開發場景，來看看 Copilot 如何成為你的神隊友。

#### 實戰 1：註冊一個新的 Custom Post Type (CPT)

假設我們要為客戶建立一個「專案作品 (Portfolio)」的 CPT。傳統上，你需要去查詢 `register_post_type` 的完整參數，非常繁瑣。現在，我們只需要一行註解。

1.  打開你的外掛主檔案或 `functions.php`。
2.  輸入以下註解：

    ```php
    <?php
    // Function to create a new Custom Post Type for Portfolio
    ```

3.  換行後，Copilot 很可能就會自動建議整個函式，包含 `add_action('init', ...)`。

    ``
    *截圖位置：輸入註解後，Copilot 自動產生 register_post_type 函式的灰色建議文字。*

4.  按下 `Tab` 接受建議。你可能會得到類似以下的程式碼：

    ```php
    <?php
    // Function to create a new Custom Post Type for Portfolio
    function moksa_register_portfolio_cpt() {
        $labels = array(
            'name'                  => _x( 'Portfolios', 'Post type general name', 'moksa-text-domain' ),
            'singular_name'         => _x( 'Portfolio', 'Post type singular name', 'moksa-text-domain' ),
            'menu_name'             => _x( 'Portfolios', 'Admin Menu text', 'moksa-text-domain' ),
            'name_admin_bar'        => _x( 'Portfolio', 'Add New on Toolbar', 'moksa-text-domain' ),
            // ... 其他 labels
        );
        $args = array(
            'labels'             => $labels,
            'public'             => true,
            'publicly_queryable' => true,
            'show_ui'            => true,
            'show_in_menu'       => true,
            'query_var'          => true,
            'rewrite'            => array( 'slug' => 'portfolio' ),
            'capability_type'    => 'post',
            'has_archive'        => true,
            'hierarchical'       => false,
            'menu_position'      => null,
            'supports'           => array( 'title', 'editor', 'author', 'thumbnail', 'excerpt', 'comments' ),
            'show_in_rest'       => true, // **Moksa 技巧**：Copilot 通常會記得加上這行，確保 CPT 支援區塊編輯器與 REST API
            'menu_icon'          => 'dashicons-portfolio',
        );
        register_post_type( 'portfolio', $args );
    }
    add_action( 'init', 'moksa_register_portfolio_cpt' );
    ```
    **重要觀念**：Copilot 產生的程式碼**不一定完美**，但它提供了一個極佳的起點。你仍然需要檢查參數是否符合你的需求，例如 `slug`、`supports` 陣列、以及 `menu_icon`。

#### 實戰 2：為 WooCommerce 商品頁添加自訂欄位

讓我們來挑戰一個更複雜的任務：在商品編輯頁的「一般」分頁中，新增一個「原廠料號 (Part Number)」的欄位，並儲存它。

1.  在你的程式碼檔案中，輸入註解：

    ```php
    // Add a custom field to the WooCommerce product general tab
    ```

2.  Copilot 可能會先建議 `woocommerce_product_options_general_product_data` 這個 hook 的函式。

3.  接受建議，然後繼續輸入下一個註解：

    ```php
    // Save the custom field value
    ```

4.  Copilot 會聰明地找到對應的 `woocommerce_process_product_meta` hook 來儲存資料。

    最終你可能會得到這樣的組合：
    ```php
    <?php
    // 1. Add a custom field to the WooCommerce product general tab
    add_action( 'woocommerce_product_options_general_product_data', 'moksa_add_part_number_field' );
    function moksa_add_part_number_field() {
        woocommerce_wp_text_input( array(
            'id'          => '_part_number',
            'label'       => __( 'Part Number', 'moksa-text-domain' ),
            'placeholder' => 'Enter the original part number',
            'desc_tip'    => 'true',
            'description' => __( 'This is the unique part number from the manufacturer.', 'moksa-text-domain' ),
        ) );
    }

    // 2. Save the custom field value
    add_action( 'woocommerce_process_product_meta', 'moksa_save_part_number_field' );
    function moksa_save_part_number_field( $post_id ) {
        $part_number = isset( $_POST['_part_number'] ) ? sanitize_text_field( $_POST['_part_number'] ) : '';
        update_post_meta( $post_id, '_part_number', $part_number );
    }
    ```
    **Moksa 技巧**：Copilot 在這個例子中表現得非常好，它不僅使用了正確的 WooCommerce hooks，還自動加入了 `sanitize_text_field` 進行**資料清理**，這是非常好的安全實踐。

#### 實戰 3：建立一個 WP-CLI 指令

WP-CLI 是高階開發者必備的工具。假設我們要建立一個指令，用來清除所有 WooCommerce 的暫存資料 (Transients)。

1.  輸入註解：

    ```php
    // Create a WP-CLI command to clear all WooCommerce transients
    ```

2.  Copilot 會辨識出「WP-CLI command」這個關鍵字，並產生符合 WP-CLI 格式的類別與方法。

    ```php
    <?php
    if ( ! class_exists( 'WP_CLI' ) ) {
        return;
    }

    /**
     * Manages Moksa custom functionalities.
     */
    class Moksa_CLI_Command {
        /**
         * Clears all WooCommerce transients.
         *
         * ## EXAMPLES
         *
         *     wp moksa clear_wc_transients
         *
         * @when after_wp_load
         */
        public function clear_wc_transients( $args, $assoc_args ) {
            global $wpdb;

            $transients = $wpdb->get_col( "
                SELECT option_name FROM {$wpdb->options}
                WHERE option_name LIKE '\_transient\_wc\_%'
                OR option_name LIKE '\_transient\_timeout\_wc\_%'
            " );

            if ( empty( $transients ) ) {
                WP_CLI::success( 'No WooCommerce transients found to clear.' );
                return;
            }

            $deleted_count = 0;
            foreach ( $transients as $transient ) {
                // Extract transient name by removing prefix
                $transient_name = str_replace( array('_transient_timeout_', '_transient_'), '', $transient );
                if ( delete_transient( $transient_name ) ) {
                    $deleted_count++;
                }
            }
            
            WP_CLI::success( "Successfully deleted {$deleted_count} WooCommerce transients." );
        }
    }

    WP_CLI::add_command( 'moksa', 'Moksa_CLI_Command' );
    ```
    **重要觀念**：這個範例展示了 Copilot 的強大之處，它不僅知道 WP-CLI 的基本結構 (`WP_CLI::add_command`)，甚至還能寫出正確的 SQL 查詢來抓取所有 WooCommerce 相關的 transients，並使用 `WP_CLI::success` 來回報結果。這能為你省下大量的研究與撰寫時間。

---

### Moksa 開發者最佳實踐 (Best Practices)

雖然 Copilot 非常強大，但它終究是個「副駕」，你才是「主駕」。請務必遵守以下原則：

1.  **永遠審核程式碼 (Review, Don't Trust Blindly)**：
    *   Copilot 的訓練資料可能包含舊的、不安全的或不符合 WordPress 編碼標準的程式碼。
    *   **你必須**親自審核每一行它產生的程式碼，理解其運作原理，並確保其安全性與效能。

2.  **提供清晰、具體的註解**：
    *   你給的指令越清晰，Copilot 產生的結果就越精準。
    *   壞的註解：`// make a function`
    *   好的註解：`// Create a function that accepts a user ID and returns the user's total completed WooCommerce order count`

3.  **利用它來學習與探索**：
    *   當你遇到不熟悉的 WordPress API 或函式時，可以試著用 Copilot 產生範例，這是一個非常高效的學習方式。
    *   你也可以在 Copilot Chat 中貼上一段程式碼，請它「解釋這段程式碼的功能」，或「幫我重構這段程式碼，讓它更有效率」。

4.  **注意資料隱私**：
    *   請勿在你的程式碼或註解中包含任何敏感資訊，例如 API Keys、密碼、客戶資料等。這些內容可能會被傳送至雲端進行分析。

### 總結

GitHub Copilot 不是要取代開發者，而是要增強開發者的能力。它能將你從繁瑣、重複的樣板程式碼中解放出來，讓你更專注於解決複雜的業務邏輯與創造獨特的用戶體驗。

對於 WordPress 開發者來說，熟練使用 Copilot 意味著你可以更快地完成 CPT/Taxonomy 的建立、整合第三方 API、撰寫複雜的 `WP_Query` 迴圈，以及建構現代化的 Gutenberg 區塊。

現在，打開你的 VS Code，開始在你的下一個專案中嘗試使用 Copilot 吧！你會驚訝於它為你帶來的效率提升。