# 5.6 (實務) 完整結帳流程測試 (從下單到發票開立)

嗨，歡迎來到 Moksa 的網站營運實戰班！

在網站正式上線、對外收款之前，進行一次完整且嚴謹的「結帳流程測試」是**絕對必要**的步驟。這不僅是為了確保技術層面的金流、物流、發票串接功能正常，更是為了模擬真實顧客的體驗，找出任何可能讓顧客卻步或感到困惑的環節。

這堂課的目標，就是帶你從一位「**顧客**」的角度，實際在你的網站下單；再切換回「**管理者**」的身份，完成訂單的出貨與發票開立。我們將會完整走過一次訂單的生命週期，確保每一個環節都如我們預期般順暢運作。

---

### Part 1: 前置準備：建立測試環境

在開始模擬下單之前，我們需要先做好一些準備工作，確保測試過程不會影響到真實的營運數據。

#### **步驟 1：建立一個測試商品**

我們需要一個專門用來測試的商品，它的價格可以設定得非常低，例如 $10 元，方便我們在測試模式下刷卡。

1.  前往 WordPress 後台，點擊左側選單的「**商品**」>「**新增商品**」。
2.  在「**商品名稱**」欄位，輸入一個容易辨識的名稱，例如 `Moksa 完整流程測試商品`。
3.  在「**商品資料**」區塊中，找到「**一般**」分頁。
4.  設定「**售價**」為 `10`。
5.  點擊右上角的「**發佈**」按鈕。

` `

#### **步驟 2：確認金流與發票設定為「測試模式」**

這是整個測試流程中**最重要的一步**。如果忘記切換回測試模式，你將會用真實的信用卡資訊進行交易，並開出正式的電子發票。

1.  前往「**WooCommerce**」>「**設定**」>「**付款**」。
2.  找到你啟用的金流服務，例如「**綠界 ECPay 信用卡**」，點擊「**管理**」。
3.  **務必**勾選「**啟用測試模式**」這個選項，並儲存設定。
    ` `
4.  接著，前往「**ECPay 發票**」>「**ECPay 發票設定**」。
5.  同樣的，**務必**確認「**啟用測試模式**」是勾選的狀態，並儲存設定。
    ` `

**Moksa 技巧：** 綠界科技有提供一組專門用於測試模式的信用卡號，你可以在測試時使用這組卡號，避免使用自己的真實卡片資訊。你可以在綠界官方的開發者文件中找到這組資訊。

---

### Part 2: 模擬顧客下單流程 (Frontend)

現在，我們要戴上顧客的帽子，親身體驗從瀏覽商品到完成下單的每一步。

#### **步驟 1：使用「無痕模式」瀏覽網站**

為了避免 WordPress 管理員的登入狀態干擾測試，**強烈建議**你開啟一個新的瀏覽器「**無痕/私密視窗**」。

#### **步驟 2：將測試商品加入購物車並結帳**

1.  在無痕視窗中，打開你的網站首頁。
2.  找到我們剛剛建立的「Moksa 完整流程測試商品」，並將它「**加入購物車**」。
3.  點擊「**查看購物車**」或直接「**前往結帳**」。

#### **步驟 3：填寫結帳頁面資訊**

在結帳頁面，仔細填寫所有欄位，就像一位真實的顧客一樣。

1.  **帳單地址：** 填寫你的姓名、地址、電話和 **Email 地址** (這個 Email 會收到所有訂單通知信，請務必填寫正確)。
2.  **運送方式：**
    *   選擇由 **RY Tools** 提供的「**7-11 超商取貨**」或「**全家超商取貨**」。
    *   點擊「**選擇門市**」按鈕，此時應該會彈出電子地圖。
    *   在地圖上選擇一間方便取貨的門市。選擇後，門市資訊會自動帶入。
    ` `
3.  **發票類型：**
    *   選擇「**個人 - 雲端發票**」。
    *   在「**手機條碼**」欄位，輸入你的手機載具條碼 (例如 `/ABC+123`)。
4.  **付款方式：**
    *   選擇「**綠界 ECPay 信用卡 (測試模式)**」。
    *   輸入綠界提供的測試信用卡號。

` `

#### **步驟 4：下單並驗證通知**

確認所有資訊無誤後，點擊「**下單購買**」。

1.  網站會跳轉至綠界測試環境的刷卡頁面，完成驗證後再跳回你的網站「**感謝頁面**」。
2.  此時，立刻檢查你剛剛填寫的 Email 信箱，你應該會收到一封由你網站寄出的「**訂單確認信**」。
3.  如果你有串接 **Order Notify**，你的 LINE 也會同步收到一則「**新訂單成立**」的通知。

---

### Part 3: 模擬管理者後台處理 (Backend)

恭喜！顧客已經成功下單。現在，讓我們脫下顧客的帽子，換上管理員的身份，來處理這筆訂單。

#### **步驟 1：進入 WooCommerce 訂單列表**

1.  回到你的 WordPress 後台 (非無痕視窗)。
2.  點擊左側選單的「**WooCommerce**」>「**訂單**」。
3.  你會在列表最上方看到一筆新的訂單，狀態應該是「**處理中**」。這代表款項已成功收到，等待我們出貨。

` `

#### **步驟 2：檢視訂單細節**

點進這筆訂單，我們可以檢視所有顧客填寫的資訊。

*   在右側的「**運送**」區塊，你可以清楚看到由 **RY Tools** 帶回來的「**7-11 門市名稱與店號**」。
*   在訂單下方的「**自訂欄位**」，你可以找到顧客填寫的「**手機條碼**」。
*   在右側的訂單備註區，你可以看到金流系統（如綠界）回傳的付款成功訊息。

` `

#### **步驟 3：處理物流 (列印寄貨標籤)**

1.  在訂單頁面的右側，找到「**RY Tools 超商寄貨**」的區塊。
2.  點擊「**產生寄貨訂單 / 列印標籤**」按鈕。
3.  系統會自動與超商的物流系統溝通，成功後會產生一組寄貨代碼，並提供標籤列印的連結。
4.  **Moksa 技巧：** 在真實營運中，你會將這個標籤印出來，貼在包裹上，然後拿到超商的 Kiosk 機台 (ibon/FamiPort) 掃描寄出。

` `

#### **步驟 4：開立電子發票**

1.  在訂單頁面的右側，找到「**綠界科技電子發票**」的區塊。
2.  由於顧客在結帳時已選擇發票類型，系統會自動帶入資訊。
3.  確認無誤後，點擊「**開立發票**」按鈕。
4.  系統會與綠界的發票系統連線，成功開立後，區塊內會顯示「**發票號碼**」與開立時間。

` `

#### **步驟 5：完成訂單**

當「**物流**」和「**發票**」都處理完畢後，我們就可以將這筆訂單的狀態標示為完成了。

1.  在訂單頁面左上角的「**狀態**」下拉選單中。
2.  將狀態從「**處理中**」更改為「**已完成**」。
3.  點擊旁邊的「**更新**」按鈕。

---

### Part 4: 最終驗證

訂單狀態更新為「已完成」後，系統會觸發最後一輪的自動化通知。

1.  **顧客 Email：** 再次檢查你的 Email 信箱，應該會收到一封主旨為「**您的訂單已完成**」的通知信。
2.  **電子發票：** 同時，你也會收到一封由「**綠界科技 ECPay**」直接寄送的電子發票開立成功通知信。
3.  **顧客 LINE：** 如果有設定，**Order Notify** 也會發送一則「**訂單已出貨/已完成**」的 LINE 通知。
4.  **後台狀態：** 回到訂單列表，確認該筆訂單的狀態已變為「已完成」。

` `

至此，我們已經完整地走完了一筆訂單從「**成立 > 付款 > 處理 > 出貨 > 開票 > 完成**」的整個生命週期。

**Moksa 提醒：** 在你的網站正式上線前，**請務必記得回到金流與發票外掛的設定頁面，將「測試模式」的勾選取消**，切換回「**正式模式**」，這樣才能開始接收真實的訂單與款項！