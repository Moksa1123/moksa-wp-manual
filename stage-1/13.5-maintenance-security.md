# 13.05 (維護) 網站安全 (Wordfence)

大家好，我是 Moksa 的首席課程導師。網站的維護工作中最重要、也最容易被忽略的一環就是「**資訊安全**」。一個網站如果沒有做好安全防護，就像一間沒有上鎖的房子，隨時可能被駭客入侵，導致資料外洩、網站被竄改、甚至影響商譽。

在本章節中，我們將學習如何使用 WordPress 生態系中最知名的安全外掛之一 **Wordfence Security** 來為我們的網站建立一道堅實的防線。Wordfence 不僅是一個惡意軟體掃描器，更是一個強大的 **網站應用程式防火牆 (Web Application Firewall, WAF)**，能即時阻擋惡意流量，保護我們的網站免於常見的攻擊。

---

### 課前準備：安全第一，永遠先備份

在進行任何安全性相關的設定或更動之前，有一個**最重要的黃金準則**：**永遠先備份你的網站**。

如果設定過程中發生任何意外，一個完整的備份可以讓你快速將網站還原到安全的狀態。請務必確認你已經透過 **UpdraftPlus** 建立了一個完整的網站備份，並將備份檔案存放在安全的地方 (例如：Google Drive, Dropbox)。

**Moksa 技巧：** 安全工作就像動手術，而備份就是你的保險。沒有保險，絕對不要動刀。

---

### 步驟 1：安裝與啟用 Wordfence

首先，我們需要將 Wordfence 安裝到我們的 WordPress 網站中。

1.  登入 WordPress 後台，前往「**外掛**」>「**安裝外掛**」。
2.  在右上角的搜尋框中，輸入「`Wordfence`」。
3.  找到「**Wordfence Security – Firewall, Malware Scan, and Login Security**」，點擊「**立即安裝**」，然後點擊「**啟用**」。

``

啟用後，Wordfence 會引導你進行一個簡單的初始設定。

4.  系統會請你輸入一個接收**安全警報的 Email**。請務必填寫你最常用的信箱，這樣當網站有任何安全狀況時，你才能第一時間收到通知。
5.  勾選同意 Wordfence 的服務條款與隱私政策。
6.  系統會詢問你是否願意加入 Wordfence 的威脅情報網路，這有助於他們收集全球的攻擊數據來強化防護，你可以選擇加入或跳過。
7.  最後，系統會給你一組 **Premium 版本的升級金鑰** (如果你購買的話)，如果使用免費版，直接點擊「No Thanks」即可。

完成後，你的 WordPress 後台左側選單會多出一個「**Wordfence**」的項目。

### 步驟 2：認識 Wordfence 儀表板 (Dashboard)

點擊左側選單的「**Wordfence**」，你會看到儀表板。這是你掌握網站安全狀況的總覽頁面。

``

儀表板上會顯示幾個核心資訊：

*   **防火牆 (Firewall):** 顯示防火牆的防護狀態。剛安裝完成時，它會處於「**學習模式 (Learning Mode)**」。
*   **掃描 (Scan):** 顯示上次掃描的結果以及下次自動掃描的時間。
*   **通知 (Notifications):** 任何需要你注意的安全事項，例如：外掛需要更新、有使用者被鎖定等。
*   **總攻擊攔截數 (Total Attacks Blocked):** 讓你清楚看到 Wordfence 為你擋下了多少次的攻擊。

### 步驟 3：設定與最佳化防火牆 (Firewall)

防火牆是 Wordfence 最核心的功能，它能阻擋惡意的網路請求，防止它們到達你的 WordPress 網站。

1.  前往「**Wordfence**」>「**Firewall**」。
2.  在頁面頂端，你會看到一個提示，要求你「**To make your site as secure as possible, take a moment to optimize the Wordfence firewall.**」。
3.  點擊右側的「**OPTIMIZE THE WORDFENCE FIREWALL**」按鈕。

``

4.  Wordfence 會自動偵測你的伺服器環境，並建議一個最佳的設定 (通常是 `Apache + CGI/FastCGI` 的 `auto_prepend_file` 設定)。
5.  點擊「**Continue**」。Wordfence 會提示你**下載 `.htaccess` 檔案的備份**。請務必下載並妥善保存這個檔案，以防萬一。
6.  下載後，再次點擊「**Continue**」，Wordfence 就會自動修改伺服器設定檔，讓防火牆以最高效率運作。

**Moksa 觀念：** 這個最佳化步驟至關重要。它讓 Wordfence 的防火牆在 WordPress 核心程式**載入之前**就開始運作，可以攔截更多種類的攻擊，大幅提升安全性。

最佳化完成後，防火牆的狀態會從「學習模式」變為「**啟用與保護中 (Enabled and Protecting)**」。在學習模式下，防火牆會學習你網站的正常操作，避免誤擋合法的行為。通常一週後會自動切換，但你也可以手動切換。

### 步驟 4：執行與判讀惡意軟體掃描 (Malware Scan)

除了即時防禦，定期掃描網站檔案，檢查是否有惡意程式碼、後門或安全漏洞也同樣重要。

1.  前往「**Wordfence**」>「**Scan**」。
2.  點擊「**START NEW SCAN**」按鈕，Wordfence 就會開始全面掃描你的網站。

掃描過程需要一些時間，具體長短取決於你網站的大小。掃描完成後，你可以在下方的「**Results**」區域看到結果。

``

如何判讀掃描結果？

*   **綠色 (無問題):** 代表你的網站目前是乾淨的。
*   **黃色/橘色 (中/低風險):** 通常是提醒性質的問題，例如：
    *   某個外掛或佈景主題有**更新版本**可用 (更新通常包含安全性修補)。
    *   某個公開的檔案可能包含敏感資訊。
    *   網站的設定有可以強化的部分 (例如：關閉檔案編輯功能)。
*   **紅色 (高風險/嚴重):** 這是**必須立即處理**的警報！常見的紅色警報有：
    *   **WordPress 核心檔案被修改:** 這通常是駭客入侵的明確跡象。
    *   **在檔案中發現惡意程式碼或後門:** 駭客植入了可以遠端控制你網站的程式。
    *   **發現已知的惡意軟體簽章:** Wordfence 的資料庫比對出已知的病毒或木馬。

如果出現紅色警報，Wordfence 通常會提供修復選項，例如「**修復檔案 (Repair)**」或「**刪除檔案 (Delete)**」。在執行任何修復動作前，**請再次確認你已有完整的網站備份**。

### 步驟 5：強化登入安全 (Login Security)

暴力破解 (Brute Force) 攻擊是駭客最常用來嘗試入侵網站後台的手法。他們會用程式不斷嘗試各種帳號密碼組合。Wordfence 提供了強大的登入安全功能來防範此類攻擊。

1.  前往「**Wordfence**」>「**Login Security**」。
2.  **雙因素驗證 (Two-Factor Authentication, 2FA):**
    *   **Moksa 強力推薦：** 我們強烈建議所有**管理員 (Administrator)** 權限的帳號都啟用 2FA。
    *   啟用 2FA 後，除了輸入密碼，你還需要輸入手機驗證器 App (如 Google Authenticator) 上顯示的 6 位數動態驗證碼才能登入。這意味著即使駭客猜到你的密碼，沒有你的手機也無法登入。
    *   你可以為網站上的任何角色啟用 2FA，並在使用者個人資料頁面進行設定。
    ``
3.  **設定 (Settings):**
    *   在「**Brute Force Protection**」區塊，你可以設定登入失敗的次數上限。
    *   **Moksa 建議設定：**
        *   **Lock out after how many login failures:** `5` (嘗試 5 次密碼錯誤就鎖定)。
        *   **Lock out after how many forgot password attempts:** `3` (嘗試 3 次忘記密碼就鎖定)。
        *   **Count failures over what time period:** `1 hour` (1 小時內計算)。
        *   **Amount of time a user is locked out:** `4 hours` (鎖定 4 小時)。
    *   **立即鎖定無效的使用者名稱 (Immediately lock out invalid usernames):** **務必勾選**。如果有人試圖用不存在的帳號 (例如 `admin`) 登入，就立即封鎖其 IP。

### 日常維護 SOP (標準作業流程)

安裝與設定好 Wordfence 只是第一步，更重要的是將安全檢查融入你的日常營運流程。

1.  **每日/每週檢查:**
    *   登入後台時，快速看一下 Wordfence 儀表板是否有任何紅色或黃色的通知。
    *   檢查你的 Email，看看是否有收到來自 Wordfence 的安全警報。
2.  **定期掃描:**
    *   Wordfence 預設會每 3 天自動掃描一次。你也可以設定為每天掃描。
    *   至少每週手動執行一次掃描，並仔細查看掃描結果。
3.  **收到警報時的處理流程:**
    *   **不要慌張。**
    *   **立即使用 UpdraftPlus 建立一個全新的備份**，以保存當前的網站狀態作為證據或供專家分析。
    *   登入網站後台，仔細閱讀 Wordfence Scan 的結果，了解問題所在。
    *   根據 Wordfence 的建議進行修復 (Repair) 或刪除 (Delete) 操作。
    *   操作完成後，**再次執行一次完整的掃描**，確保所有問題都已清除。
    *   **修改所有管理員的密碼**以及資料庫密碼，以防後門殘留。

---

### 總結

Wordfence 是一個功能強大且易於上手的安全外掛，它是我們 Moksa 技術棧中不可或缺的一環。透過正確的設定與定期的維護，它可以為你的 WooCommerce 網站提供企業級的安全防護。

請記住，網站安全是一個持續的過程，而不是一次性的設定。結合 Wordfence 的自動防護、定期的手動檢查、隨時保持外掛與核心程式的更新，以及可靠的備份策略，你就能為你的線上事業建立一個安全、可靠的營運環境。