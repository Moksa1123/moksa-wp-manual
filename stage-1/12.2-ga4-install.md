# 12.02 (實作) 如何安裝 GA4 (使用 GTM 或外掛)

嗨，歡迎來到這個實作單元！數據是電商網站的黃金，而 Google Analytics 4 (GA4) 就是我們挖掘黃金最重要的工具。沒有安裝 GA4，你就像在黑暗中開船，完全不知道顧客從哪裡來、在網站上做了什麼、最後為什麼沒有結帳。

在這個章節，我們將會介紹兩種業界最主流、也是 **Moksa 推薦**的安裝方法，你可以根據自己的需求與技術熟悉度來選擇。

1.  **外掛安裝法 (Rank Math)：** 適合新手，快速、簡單、能滿足基本數據追蹤需求。
2.  **GTM 安裝法 (Google Tag Manager)：** 業界標準，功能強大且極具彈性，是長期營運的**最佳選擇**。

---

### 前置作業：取得你的 GA4 評估 ID

不論你選擇哪一種方法，你都必須先從你的 Google Analytics 帳戶中，取得一組獨一無二的「**評估 ID**」(Measurement ID)。

*   **格式：** 通常是 `G-` 開頭，後面接著一串英文和數字 (例如：`G-ABC123DEF4`)。

**步驟 1：登入 Google Analytics 帳戶**

前往 [Google Analytics 官網](https://analytics.google.com/) 並登入。

**步驟 2：進入管理介面**

點擊左下角的「**管理**」(齒輪圖示)。

**步驟 3：找到資料串流**

在「資源」欄位中，點擊「**資料串流**」(Data Streams)。

``

**步驟 4：選擇你的網站串流**

點擊你已經為網站建立好的那一個資料串流。

**步驟 5：複製評估 ID**

在畫面的右上角，你就會看到「**評估 ID**」，點擊旁邊的複製圖示即可。請先把這組 ID 複製下來，我們馬上會用到它。

``

---

### 方法一：使用 Rank Math SEO 外掛安裝 (推薦新手)

如果你的網站已經安裝了 **Rank Math SEO** (這是我們 Moksa 技術棧的標準配備)，那麼恭喜你，你不需要再安裝任何其他外掛！Rank Math 內建了非常強大的 Google Analytics 整合功能。

**優點：**
*   **無需額外外掛：** 保持網站輕量化。
*   **設定簡單：** 透過引導精靈即可完成。
*   **數據整合：** 可以在 WordPress 後台直接看到 GA4 的關鍵數據，非常方便。

**步驟 1：啟用 Rank Math Analytics 模組**

1.  從 WordPress 後台，前往 `Rank Math` > `儀表板` (Dashboard)。
2.  確認「**Analytics**」這個模組是**開啟**的狀態。如果沒有，請將它打開。

``

**步驟 2：連結你的 Google 帳戶**

1.  前往 `Rank Math` > `一般設定` > `Analytics`。
2.  點擊「**連結 Google 服務**」(Connect Google Services) 按鈕。
3.  畫面會跳轉到 Google 的授權頁面，請選擇你用來管理 GA4 的那個 Google 帳戶。
4.  過程中，Google 會詢問你是否同意授權 Rank Math 存取你的資料，請全部勾選「**允許**」。

``

**步驟 3：選擇對應的 GA4 資源**

授權成功後，畫面會跳轉回 WordPress。

1.  在「Analytics」設定頁面，Rank Math 會自動抓取你帳戶中所有的網站資源。
2.  在「**Analytics (分析)**」的下拉選單中，**務必**選擇你網站對應的 GA4 資源 (通常是 `G-XXXXXXXXXX` 的格式)。
3.  在「**安裝 Analytics 分析代碼**」這個選項，確認他是**開啟**的狀態。

``

**步驟 4：儲存設定**

往下滑到頁面最下方，點擊「**儲存變更**」。

**Moksa 技巧：** Rank Math 還會詢問你是否要「**匿名化 IP 位址**」以及「**將登入的使用者排除**」。一般來說，我們建議將這兩個選項都**開啟**。前者有助於符合部分地區的隱私法規；後者可以避免你和員工在後台工作時，產生無效的流量數據，讓你的報告更乾淨、更準確。

---

### 方法二：使用 Google Tag Manager (GTM) 安裝 (推薦進階使用者)

GTM 是一個「代碼管理系統」，你可以把它想像成一個「容器」。未來所有行銷相關的追蹤碼，例如 GA4、Facebook Pixel、Google Ads 轉換碼、LINE LAP 追蹤碼...等，我們都只需要安裝在這個「容器」裡，而**不需要**一直去動到網站程式碼。

**優點：**
*   **高度彈性：** 輕鬆管理所有追蹤碼，增刪修改都超方便。
*   **提升效能：** GTM 會以非同步方式載入代碼，對網站速度影響較小。
*   **強大追蹤：** 可以設定各種複雜的事件追蹤，例如「點擊特定按鈕」、「影片觀看進度」等。
*   **權限管理：** 可將 GTM 的權限開放給行銷人員，而不用給他們網站後台權限，更安全。

#### 第 1 階段：在網站中安裝 GTM 容器

**步驟 1：取得 GTM 容器安裝碼**

1.  登入 [Google Tag Manager](https://tagmanager.google.com/)。
2.  在你的容器工作區，點擊右上角 `GTM-` 開頭的容器 ID。

``

3.  你會看到一個彈出視窗，裡面有兩段程式碼，分別要放在網站的 `<head>` 和 `<body>` 區塊。

#### 步驟 2：將程式碼放入網站 (使用 Kadence Theme)

**Moksa 技巧：** 我們**強烈不建議**直接去修改主題的 `header.php` 檔案，因為主題一更新，你的修改就會被覆蓋。請使用主題或外掛提供的功能來安插程式碼。

因為我們的技術棧是 **Kadence Blocks**，所以我們會利用 **Kadence 主題**內建的功能來完成。

1.  在 WordPress 後台，前往 `外觀` > `自訂`。
2.  在自訂選單中，找到 `Custom Scripts`。
3.  將 GTM 彈出視窗的第一段程式碼，完整複製並貼到「**Header Scripts**」的欄位中。
4.  將 GTM 彈出視窗的第二段程式碼，完整複製並貼到「**After Opening Body Tag Scripts**」的欄位中。
5.  點擊上方的「**發佈**」按鈕儲存。

``

#### 第 2 階段：在 GTM 中設定 GA4 代碼

現在你的網站已經裝好了 GTM 這個空容器，接下來我們要把 GA4 的追蹤碼「放進」這個容器裡。

**步驟 1：新增代碼**

1.  回到 GTM 的工作區。
2.  點擊左邊選單的「**代碼**」(Tags)，然後點擊右邊的「**新增**」(New)。

**步驟 2：設定代碼**

1.  **代碼命名：** 在左上方為你的代碼取一個好辨識的名稱，例如「**GA4 - 網頁瀏覽 - 主要設定**」。
2.  **代碼設定：** 點擊中間的區塊，在右邊滑出的選單中，選擇「**Google Analytics (分析)：GA4 設定**」。
3.  **評估 ID：** 在欄位中，貼上我們在「前置作業」中取得的那組 `G-` 開頭的評估 ID。

``

**步驟 3：設定觸發條件**

1.  點擊代碼設定下方的「**觸發條件**」(Triggering) 區塊。
2.  選擇「**All Pages**」(所有頁面)。這代表當任何一個頁面被瀏覽時，這個 GA4 代碼就會被觸發。
3.  點擊右上角的「**儲存**」。

**步驟 4：預覽與發佈 (最重要的一步！)**

在 GTM 中，任何的修改都必須經過「**預覽**」測試，確認無誤後再「**提交/發佈**」。

1.  點擊 GTM 工作區右上角的「**預覽**」(Preview) 按鈕。
2.  在新分頁中輸入你的網站網址，點擊「**Connect**」。
3.  你的網站會在新分頁開啟，同時會出現一個 **Tag Assistant** 的偵錯視窗。
4.  在偵錯視窗中，點擊左邊的 `Container Loaded` 或 `DOM Ready`，如果你在右邊的「**Tags Fired**」區塊看到你剛剛設定的「GA4 - 網頁瀏覽 - 主要設定」代碼，**就代表你成功了！**

``

5.  確認成功後，回到 GTM 工作區，點擊右上角藍色的「**提交**」(Submit) 按鈕。
6.  為這次的變更寫一個簡單的版本名稱（例如：安裝 GA4 基礎代碼），然後點擊「**發佈**」(Publish)。

---

### 我該選擇哪一種方法？

*   **如果你是個人站長、部落客或剛起步的店家：**
    *   直接使用 **Rank Math** 的整合功能就非常足夠了。它能讓你快速上手，並且在 WordPress 後台就能看到關鍵數據。

*   **如果你打算長期經營電商、需要投放多種廣告、或有行銷團隊協作：**
    *   請務必學習並使用 **GTM**。雖然初期設定稍微複雜，但它帶來的彈性與強大功能，絕對是值得的投資。**GTM 是專業電商營運的基石**。

恭喜你！無論你選擇哪種方法，你的網站現在都已經成功安裝了數據分析的心臟—GA4。從現在開始，你就能夠收集寶貴的用戶數據，為未來的商業決策提供堅實的依據了。