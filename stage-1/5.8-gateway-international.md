# 05.08 國際金流串接實戰 (Stripe / PayPal Pro)

嗨，歡迎來到 MoksaWP 網站營運實戰班！在本章節中，我們將跨出台灣，學習如何為你的 WooCommerce 商店串接全球最主流的兩大國際金流服務：**Stripe** 與 **PayPal**。

當你的業務目標是全球市場，或是銷售數位商品、訂閱服務給不同國家的客戶時，串接一個穩定、安全且廣受信賴的國際金流是成功的基石。這不僅能提升海外顧客的信任感，更能大幅簡化你的收款流程。

本堂課我們將會從零開始，帶你完成這兩大金流的帳號申請、外掛設定、測試交易，一直到正式上線收款。

---

### 課前準備：最重要的基礎建設

在開始串接任何金流服務之前，請務必確認你的網站已經安裝並啟用 **SSL 憑證**。

*   **什麼是 SSL 憑證？** 簡單來說，它就是讓你的網址從 `http://` 變成 `https://` 的關鍵。這個「s」代表「Secure (安全)」，表示你的網站與使用者之間的資料傳輸是經過加密的。
*   **為什麼這麼重要？** 任何涉及線上交易的網站，尤其是信用卡刷卡，都**必須**使用 SSL 加密。這不僅是為了保護客戶的敏感資料（如卡號），也是 Stripe 和 PayPal 等金流服務的**強制要求**。如果沒有 SSL，金流服務將無法運作。

**Moksa 技巧：** 大部分的優質主機商（如 Cloudways）都會提供免費的 Let's Encrypt SSL 憑證，並且可以一鍵安裝。請確保你的網址列旁已經出現了「鎖頭」圖示。

``

---

## Part 1：Stripe 串接實戰 (信用卡收款)

Stripe 是目前全球最受開發者與新創公司歡迎的金流服務之一。它以其簡潔的 API、強大的功能與無縫的結帳體驗聞名。透過 Stripe，顧客可以直接在你的網站結帳頁面輸入信用卡資訊，完全不需要跳轉到其他頁面，這有助於大幅提高訂單轉換率。

### 步驟 1：註冊並啟用 Stripe 帳戶

1.  前往 [Stripe 官方網站 (https://stripe.com)](https://stripe.com) 並點擊「註冊」。
2.  依照畫面指示填寫你的電子郵件、密碼，並選擇你的公司所在國家。
3.  完成註冊後，登入 Stripe 儀表板 (Dashboard)。你會看到啟用帳戶的提示。
4.  點擊「啟用您的帳戶」並依序填寫詳細的業務資料，包括：
    *   公司類型（獨資、有限公司等）
    *   公司統編（如果有的話）
    *   業務代表個人資料
    *   業務說明（銷售的商品或服務）
    *   你的收款銀行帳戶資訊（**非常重要**，Stripe 會將款項撥入此帳戶）
5.  提交所有資料後，Stripe 會進行審核。

### 步驟 2：取得 API 金鑰 (API Keys)

API 金鑰是你的網站與 Stripe 帳戶溝通的「密碼」。Stripe 提供了兩種模式的金鑰：

*   **測試模式 (Test mode):** 用於開發與測試，交易不會產生實際費用。
*   **正式模式 (Live mode):** 用於真實的線上交易。

我們在設定初期會先使用「測試模式」。

1.  在 Stripe 儀表板中，確認右上角的開關在「**測試模式**」下。
2.  點擊左側選單的「**開發人員 (Developers)**」。
3.  在子選單中選擇「**API 金鑰 (API keys)**」。
4.  你會看到兩組金鑰：
    *   **可發佈金鑰 (Publishable key):** 通常以 `pk_test_` 開頭。
    *   **密鑰 (Secret key):** 通常以 `sk_test_` 開頭。點擊「顯示測試金鑰」才能看到完整金鑰。

**請將這兩組測試金鑰複製下來**，我們馬上就會用到。

``

### 步驟 3：安裝與設定 WooCommerce Stripe 官方外掛

1.  回到你的 WordPress 後台，前往「**外掛**」>「**安裝外掛**」。
2.  在搜尋框中輸入「**WooCommerce Stripe Payment Gateway**」。
3.  找到由「WooCommerce」官方開發的外掛，點擊「**立即安裝**」並「**啟用**」。
4.  啟用後，前往「**WooCommerce**」>「**設定**」>「**付款**」。
5.  你會看到一個新的選項「**Stripe - 信用卡 (Stripe)**」，將它**啟用**，然後點擊右側的「**管理**」。

### 步驟 4：填寫 Stripe 設定並建立 Webhook

進入 Stripe 設定頁面後，我們來完成最重要的設定：

1.  取消勾選「**啟用測試模式**」旁邊的核取方塊。系統會顯示正式模式與測試模式的欄位。
2.  在「**測試帳戶金鑰**」區塊中，貼上我們剛剛從 Stripe 儀表板複製的「**可發佈金鑰 (測試)**」與「**密鑰 (測試)**」。
3.  **Webhook 設定 (極度重要！)**：Webhook 是讓 Stripe 可以在交易狀態改變時（例如：付款成功、退款完成）主動通知你網站的機制。
    *   在 WordPress 的 Stripe 設定頁面中，找到「**Webhook 端點**」區塊。你會看到一行提示：「*請將此 Webhook 端點新增至您的 Stripe 帳戶...*」。
    *   **複製那段 Webhook 網址** (URL)。
    *   回到你的 Stripe 儀表板 (測試模式下)，點擊「**開發人員**」>「**Webhook**」。
    *   點擊「**新增端點 (Add endpoint)**」。
    *   在「**端點網址 (Endpoint URL)**」欄位中，貼上剛剛複製的網址。
    *   在「**聆聽 (Listen to)**」或「**選取事件 (Select events)**」處，點擊按鈕，然後選擇「**接收所有事件 (Receive all events)**」或依照外掛的建議選擇特定事件。
    *   點擊「**新增端點**」。
    *   建立成功後，點進剛剛建立的 Webhook，你會看到「**簽署密鑰 (Signing secret)**」，點擊「**顯示**」並**複製**它。
    *   回到 WordPress，將這串簽署密鑰貼到「**Webhook 金鑰 (測試)**」欄位中。

``

4.  **儲存設定**：點擊頁面底部的「**儲存設定**」。

### 步驟 5：進行測試交易

現在，我們來模擬顧客下單，確保一切運作正常。

1.  用瀏覽器的「無痕模式」開啟你的網站前台。
2.  將任一商品加入購物車，並前往結帳頁面。
3.  在付款方式區塊，你應該會看到信用卡付款選項。
4.  使用 Stripe 提供的[官方測試卡號](https://stripe.com/docs/testing#cards)（例如 `4242 4242 4242 4242`），並輸入任意的未來到期日與 CVC 碼。
5.  點擊「下單購買」。
6.  如果頁面成功跳轉到「感謝頁面」，代表前端交易成功！
7.  回到 WordPress 後台的「**WooCommerce**」>「**訂單**」，查看剛剛那筆訂單的狀態是否為「**處理中**」。
8.  同時，登入 Stripe 儀表板 (測試模式)，在「**付款 (Payments)**」中，你應該也能看到這筆成功的測試交易紀錄。

**Moksa 技巧：** 如果測試交易失敗，最常見的原因是 API 金鑰或 Webhook 設定錯誤。請仔細核對每一個複製貼上的環節。

### 步驟 6：切換至正式模式 (Go Live!)

當你確認測試一切正常後，就可以準備正式收款了！

1.  登入 Stripe 儀表板，將右上角的開關切換至「**正式模式 (Live mode)**」。
2.  再次前往「**開發人員**」>「**API 金鑰**」，複製你的「**正式**」可發佈金鑰 (`pk_live_...`) 與密鑰 (`sk_live_...`)。
3.  同樣在「**開發人員**」>「**Webhook**」，用**完全相同**的步驟，建立一個「**正式模式**」的 Webhook，並取得「**正式**」的簽署密鑰。
4.  回到 WordPress 的 Stripe 設定頁面，填入這三組「**正式**」金鑰與密鑰。
5.  **儲存設定**。

恭喜！你的網站現在已經可以接受全球 Visa, MasterCard, American Express 等主流信用卡的付款了。

---

## Part 2：PayPal 串接實戰

PayPal 是全球用戶數最多的電子錢包服務。對許多海外消費者來說，看到 PayPal 的選項會讓他們感到非常安心。串接 PayPal 可以有效觸及那些習慣使用 PayPal 餘額或是不想在陌生網站輸入信用卡資訊的客群。

我們將使用 WooCommerce 官方推薦的 **WooCommerce PayPal Payments** 外掛，它整合了 PayPal 錢包支付與信用卡支付（即 PayPal Pro 的功能）。

### 步驟 1：註冊 PayPal 企業帳戶

要串接 API，你必須擁有一個 **PayPal 企業 (Business) 帳戶**，個人帳戶無法使用。

1.  前往 [PayPal 官方網站](https://www.paypal.com/)。
2.  選擇註冊「**企業帳戶**」。
3.  依照指示，填寫你的業務與個人相關資料。
4.  完成帳戶認證，特別是**電子郵件**與**銀行帳戶**的認證。

### 步驟 2：安裝 WooCommerce PayPal Payments 外掛

1.  在 WordPress 後台，前往「**外掛**」>「**安裝外掛**」。
2.  搜尋「**WooCommerce PayPal Payments**」。
3.  找到官方外掛，點擊「**立即安裝**」並「**啟用**」。

### 步驟 3：連結你的 PayPal 帳戶

新版的外掛簡化了串接流程，不再需要手動複製貼上 API 金鑰。

1.  啟用後，前往「**WooCommerce**」>「**設定**」>「**付款**」。
2.  找到「**PayPal**」選項，點擊右側的「**管理**」或「**完成設定**」。
3.  你會看到一個醒目的按鈕「**啟用 PayPal (Enable PayPal)**」或「**連結至 PayPal (Connect to PayPal)**」。
4.  點擊該按鈕，系統會跳出一個 PayPal 的登入視窗。
5.  在視窗中，登入你剛剛註冊好的**企業帳戶**。
6.  PayPal 會請求你授權 WooCommerce 網站存取你的帳戶權限（用於建立交易、查詢狀態等），請點擊「**同意並連結**」。
7.  授權成功後，視窗會自動關閉，你的網站就與 PayPal 帳戶成功連結了！系統會自動帶入 API 資訊。

``

### 步驟 4：進行沙盒 (Sandbox) 測試

與 Stripe 的測試模式類似，PayPal 稱之為「沙盒 (Sandbox)」環境。

1.  前往 [PayPal Developer 網站 (https://developer.paypal.com/)](https://developer.paypal.com/) 並登入。
2.  在左側選單，前往「**Sandbox**」>「**Accounts**」。
3.  系統通常會自動幫你建立兩個測試帳戶：
    *   一個 `-facilitator` (商家) 帳戶。
    *   一個 `-buyer` (買家) 帳戶。
4.  回到 WordPress 的 PayPal 設定頁面，勾選「**啟用 PayPal 沙盒 (Enable PayPal Sandbox)**」。
5.  點擊「**連結沙盒帳戶**」，並在跳出的視窗中，用你的**主要 PayPal 帳密**登入，並授權沙盒環境。
6.  **儲存設定**。
7.  現在，你可以用「無痕模式」開啟網站，在結帳頁面選擇 PayPal 付款。
8.  點擊「前往 PayPal」後，頁面會跳轉到 PayPal 的**沙盒登入頁面**。
9.  請使用你在 PayPal Developer 網站上看到的那個「**-buyer**」測試帳戶的 Email 和密碼來登入付款。
10. 完成付款後，檢查 WordPress 後台訂單狀態，並登入 PayPal Sandbox 查看商家帳戶是否有收到款項。

### 步驟 5：切換至正式模式 (Go Live!)

測試無誤後，只需一步即可上線：

1.  回到 WordPress 的「**WooCommerce**」>「**設定**」>「**付款**」>「**PayPal**」的管理頁面。
2.  **取消勾選「啟用 PayPal 沙盒 (Enable PayPal Sandbox)」**。
3.  **儲存設定**。

就是這麼簡單！你的 PayPal 收款功能現在已經正式啟用了。

---

### 總結與 Moksa 專業建議

1.  **同時提供 Stripe 與 PayPal**：
    這是最佳實務。Stripe 提供無縫的站內信用卡結帳體驗，而 PayPal 則服務了龐大的既有用戶群。兩者並存可以最大化你的潛在客戶覆蓋率。

2.  **注意交易手續費**：
    Stripe 和 PayPal 都會對每筆成功交易收取一定比例的手續費（通常是 `2.9% + $0.30` 到 `3.4% + 固定費用`，費率會因國家/地區而異）。**請務必將這筆成本計入你的商品定價與營運成本中**。

3.  **了解金流撥款週期**：
    Stripe 通常會在交易後數天內將款項自動撥入你的銀行帳戶。PayPal 的款項則會先進入你的 PayPal 帳戶餘額，你需要手動提領至你的銀行帳戶。了解各自的規則有助於你管理現金流。

4.  **處理爭議與退款**：
    所有的退款操作都建議直接從 WooCommerce 的訂單頁面發起。這樣可以確保你的網站訂單狀態與金流後台（Stripe/PayPal）的狀態保持同步。

恭喜你完成了國際金流的串接！你的電商網站現在已經具備了邁向全球市場的收款能力。在接下來的課程中，我們將會探討國際物流與稅務等進階議題。