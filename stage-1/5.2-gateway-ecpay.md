# 5.2 (實作) 串接「綠界 ECPay」金流 (信用卡、ATM)

嗨，歡迎來到這個核心的實作單元！一個能讓顧客順利付款的網站，才是真正能賺錢的網站。在這堂課中，我們將一步步帶你完成台灣最主流的第三方金流服務「綠界科技 ECPay」的串接設定，並啟用大家最常使用的「信用卡」與「ATM 虛擬代碼」這兩種付款方式。

完成這堂課後，你的 WooCommerce 網站將正式具備線上收款的能力！

---

### 課前準備

在開始之前，請務必確認你已經完成了以下事項：

1.  **已完成 WooCommerce 商店的基本設定**：包含商店地址、幣別 (TWD) 等。
2.  **已成功申請綠界科技的會員**：並且已經通過審核，可以登入「廠商管理後台」。如果還沒申請，請先至綠界官網完成申請。

---

### 步驟 1：取得你的綠界金流串接金鑰

首先，我們需要從綠界的廠商後台，取得與你的 WordPress 網站溝通時所需的「鑰匙」，也就是 API 金鑰。

1.  請登入「**綠界科技廠商管理後台**」。
    *   正式環境網址：<https://vendor.ecpay.com.tw/>
2.  登入後，在左側選單找到「**系統開發管理**」，點擊展開後再點選「**系統介接設定**」。
    `[截圖：綠界後台左側選單，標示出「系統介接設定」的位置]`
3.  在這個頁面，你會看到串接所需要的三組關鍵資訊。請**務必**將它們複製下來，並妥善保管，**絕對不要外洩**給任何人：
    *   **特店編號 (MerchantID)**
    *   **介接 HashKey**
    *   **介接 HashIV**

    `[截圖：綠界系統介接設定頁面，清楚標示出 MerchantID, HashKey, HashIV 的位置]`

> **Moksa 技巧：** 綠界有提供「測試環境」與「正式環境」。對於初學者，我們建議直接使用「**正式環境**」的金鑰進行串接，並在最後用一筆小額訂單 (例如 1 元或 10 元) 實際刷卡測試，這樣最能確保所有流程都正確無誤。

---

### 步驟 2：安裝「綠界 ECPay」官方外掛

接下來，我們回到 WordPress 後台，安裝綠界官方提供的 WooCommerce 金流外掛。

1.  前往 WordPress 控制台 > **外掛** > **安裝外掛**。
2.  在右上角的搜尋框中，輸入關鍵字「**ECPay**」。
3.  找到由「ECPay」或「綠界科技」開發的「**ECPay Payment for WooCommerce**」外掛，點擊「**立即安裝**」，然後點擊「**啟用**」。

    `[截圖：WordPress 外掛安裝頁面，搜尋結果中反白標示出正確的綠界官方外掛]`

---

### 步驟 3：設定 WooCommerce 全域金流整合

外掛啟用後，我們需要將剛剛取得的金鑰填入 WooCommerce 的設定中。

1.  前往 WordPress 控制台 > **WooCommerce** > **設定** > **付款**。
2.  在這個頁面頂部，你會看到一個「**綠界整合金流設定**」的連結，請點擊它。
    `[截圖：WooCommerce 付款設定頁面，標示出「綠界整合金流設定」的連結]`
3.  進入設定頁面後，請填入以下核心資訊：
    *   **啟用綠界科技整合金流**: **務必勾選**。
    *   **特店編號 (Merchant ID)**: 貼上你從綠界後台複製的 **MerchantID**。
    *   **金流 Hash Key**: 貼上你從綠界後台複製的 **HashKey**。
    *   **金流 Hash IV**: 貼上你從綠界後台複製的 **HashIV**。
    *   **環境**: 選擇「**正式環境**」。

    `[截圖：綠界整合金流設定頁面，填寫完畢的畫面]`
4.  完成後，滑到頁面最下方，點擊「**儲存設定**」。

---

### 步驟 4：啟用並設定「信用卡」付款方式

全域設定完成後，我們來分別啟用並微調各種付款方式的細節。

1.  同樣在 **WooCommerce** > **設定** > **付款** 的頁面。
2.  往下找到「**ECPay Credit Card (綠界信用卡)**」這個選項，點擊右邊的「**管理**」按鈕。
3.  進入信用卡設定頁面，請完成以下設定：
    *   **啟用/停用**: **務必勾選**「**啟用綠界信用卡**」。
    *   **標題**: 這是顧客在結帳頁面看到的選項名稱。建議可以寫得更清楚，例如：「**信用卡付款 (支援 VISA, Master, JCB)**」。
    *   **消費者說明**: 這是顧客選擇此付款方式後看到的簡短說明。例如：「線上刷卡，交易過程全程加密，請安心使用。」
    *   **自動請款**: 這是一個**重要觀念**。
        *   選擇「**是**」：顧客刷卡成功後，綠界會「立即」向銀行請求扣款。
        *   選擇「**否**」：顧客刷卡成功後，只會先「授權」額度，你必須在綠界後台手動執行「請款」才會真正扣款。
        *   **Moksa 技巧：** 對於大多數銷售實體商品或數位服務的電商，我們建議直接設定為「**是**」，可以大幅簡化你的收款流程。
    `[截圖：綠界信用卡付款方式的管理頁面，顯示已完成的設定]`
4.  完成後，點擊「**儲存設定**」。

---

### 步驟 5：啟用並設定「ATM 虛擬代碼」付款方式

接著，我們用同樣的方式來設定 ATM 轉帳。

1.  回到 **WooCommerce** > **設定** > **付款** 的頁面。
2.  找到「**ECPay ATM (綠界 ATM)**」，點擊右邊的「**管理**」按鈕。
3.  進入 ATM 設定頁面，請完成以下設定：
    *   **啟用/停用**: **務必勾選**「**啟用綠界 ATM**」。
    *   **標題**: 建議修改為更容易理解的名稱，例如：「**ATM 虛擬代碼轉帳**」。
    *   **消費者說明**: 提供明確的指示給顧客。例如：「訂單成立後，您將會收到一組專屬的 ATM 虛擬轉帳代碼，請於期限內完成繳費。」
    *   **付款截止時間**: 設定顧客必須在幾天內完成付款，否則訂單會自動取消。通常建議設定為 **3** 天。
    `[截圖：綠界 ATM 付款方式的管理頁面，顯示已完成的設定]`
4.  完成後，點擊「**儲存設定**」。

---

### 步驟 6：前台結帳頁面最終測試

恭喜你！所有的後台設定都完成了。最後，也是最重要的一步，就是模擬顧客實際下單，確保金流運作正常。

1.  請用瀏覽器的「無痕模式」開啟你的網站（避免被管理員身份影響）。
2.  隨便將一個商品加入購物車，然後前往「**結帳**」頁面。
3.  在結帳頁面的付款方式區塊，你應該要能清楚地看到剛剛設定的「**信用卡付款**」與「**ATM 虛擬代碼轉帳**」兩個選項。
    `[截圖：網站前台結帳頁面，顯示出信用卡與 ATM 的付款選項]`
4.  **Moksa 技巧 (必做)：** 我們強烈建議你建立一個價格為 1 元或 10 元的「測試專用商品」。實際選擇「信用卡」並用你自己的信用卡完成一次付款流程，確認能成功跳轉到銀行 3D 驗證頁面並刷卡成功。同時，也下單一次選擇「ATM」，確認能收到虛擬代碼。這是確保你的金流 100% 正常的唯一方法！

---

### 總結

太棒了！你的網站現在已經成功串接了綠界金流，具備了最重要的線上收款功能。這代表你的電商事業已經準備好迎接第一筆訂單了。

在下一堂課，我們將會講解當第一筆訂單成立後 (無論是信用卡或 ATM)，身為管理者的你該如何進行標準的出貨與訂單管理流程，敬請期待！