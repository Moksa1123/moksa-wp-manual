# 9.10 (實務) 篩選邏輯 (AND/OR) (群組 vs 規則)

嗨，歡迎來到 MoksaWP 網站營運實戰班！

在經營電商網站的過程中，我們經常需要設定各種精準的條件來執行特定任務，例如：「VIP 會員購買特定商品滿額折 100 元」、「註冊超過一年且從未消費的客戶，發送專屬優惠券」。要實現這些複雜的行銷活動，你就必須徹底理解篩選條件中的 **AND (且)** 與 **OR (或)** 邏輯。

這堂課，我們將深入探討這個看似抽象但極其重要的觀念，並透過我們技術棧中的 **Advanced Coupons** (進階優惠券) 和 **FluentCRM** (客戶關係管理) 這兩個強大的外掛，來示範如何靈活運用「**群組 (Group)**」與「**規則 (Rule)**」來建構任何你想要的篩選條件。

---

### 核心觀念：規則、群組、AND、OR

在開始實作之前，讓我們先建立共同的語言和觀念。

*   **規則 (Rule):** 這是最小的判斷單位，代表一個**單一條件**。
    *   範例：「購物車小計 > 2000 元」是一條規則。
    *   範例：「使用者角色 = VIP」是另一條規則。
    *   範例：「購物車內包含『服飾』分類的商品」也是一條規則。

*   **群組 (Group):** 這是一個**規則的容器**。你可以把多條「規則」放進同一個「群組」裡。

*   **AND (且) 邏輯:** 通常應用在「**同一個群組內**」的規則。它代表這個群組裡面的**所有規則都必須同時成立**，條件才算滿足。在許多外掛介面中，它會被標示為「**符合所有 (Match All)**」。

*   **OR (或) 邏輯:** 通常應用在「**不同的群組之間**」。它代表你設定的**多個群組中，只要有任何一個群組的條件被滿足**，就算通過。在介面中，它會被標示為「**符合任一 (Match Any)**」。

**Moksa 技巧：** 一個最簡單的記憶法是「**組內跑 AND，組間跑 OR**」。先用群組把必須「同時發生」的條件綁在一起 (AND)，再用多個群組去處理「擇一發生即可」的情境 (OR)。

接下來，我們來看兩個最經典的實務應用。

---

### 實作一：使用 Advanced Coupons 設定複雜的優惠券條件

假設我們的行銷活動目標是：
> 「VIP 會員」購買「服飾」分類商品，且該分類商品總金額超過 $2,000 元時，整筆訂單可享 9 折優惠；**或者**，只要是「VIP 會員」，單筆訂單不限商品，總金額滿 $5,000 元，也可以享 9 折優惠。

這個條件用一句話說完很複雜，但用「群組」和「規則」來拆解就非常清晰。

*   **條件 A (需要一個群組):**
    1.  使用者角色 **是** VIP (規則 1)
    2.  **且** 購物車內包含「服飾」分類的商品 (規則 2)
    3.  **且** 「服飾」分類的商品小計 **大於** $2,000 (規則 3)

*   **條件 B (需要另一個群組):**
    1.  使用者角色 **是** VIP (規則 1)
    2.  **且** 購物車小計 **大於** $5,000 (規則 2)

整個優惠券的啟用邏輯就是：「**滿足條件 A**」 **或者** 「**滿足條件 B**」。

#### 步驟 1：建立優惠券並設定基本資訊

1.  前往 WordPress 後台 > **行銷 (Marketing)** > **優惠券 (Coupons)** > **新增優惠券 (Add Coupon)**。
2.  **優惠券代碼 (Coupon code):** 輸入一個好記的代碼，例如 `VIPONLY90`。
3.  在「**一般 (General)**」頁籤中：
    *   **折扣類型 (Discount type):** 選擇「**百分比折扣 (Percentage discount)**」。
    *   **優惠券金額 (Coupon amount):** 輸入 `10` (代表折扣 10%，也就是 9 折)。

``

#### 步驟 2：設定購物車條件 (Cart Conditions)

這是 Advanced Coupons 的精華所在。

1.  切換到「**購物車條件 (Cart Conditions)**」頁籤。
2.  你會看到一個預設的「**條件群組 (Condition Group)**」。這就是我們的「條件 A」。
3.  點擊「**新增條件 (Add Condition)**」，建立第一條規則：
    *   條件類型選擇 **Cart Data** > **Customer Role**。
    *   條件設為 **is one of** > **VIP**。

``

4.  再次點擊「**新增條件 (Add Condition)**」，在同一個群組內建立第二條規則：
    *   條件類型選擇 **Product Categories** > **Product Category in Cart**。
    *   條件設為 **is one of** > **服飾**。

``

5.  繼續新增第三條規則：
    *   條件類型選擇 **Product Categories** > **Cart Subtotal of Products in Category**。
    *   條件設為 **more than** > `2000`。
    *   在下方的 **Category** 欄位，選擇「**服飾**」。

``

6.  在這個群組的頂部，確認邏輯是「**Match All** of these conditions」，這就實現了我們的 AND 邏輯。

#### 步驟 3：新增第二個條件群組 (OR 邏輯)

1.  在第一個條件群組下方，點擊「**新增條件群組 (Add another group of conditions)**」按鈕。
2.  系統會提示你，群組之間的邏輯是「**If ANY of these groups of conditions are met...**」，這就是我們要的 **OR** 邏輯。
3.  在這個新的群組中，我們來設定「條件 B」。
4.  點擊「**新增條件 (Add Condition)**」，建立第一條規則：
    *   條件類型選擇 **Cart Data** > **Customer Role**。
    *   條件設為 **is one of** > **VIP**。
5.  在同一個群組內新增第二條規則：
    *   條件類型選擇 **Cart Data** > **Cart Subtotal**。
    *   條件設為 **more than** > `5000`。

``

6.  同樣的，確認這個新群組的內部邏輯是「**Match All**」。

#### 步驟 4：儲存並測試

1.  點擊「**發佈 (Publish)**」或「**更新 (Update)**」儲存優惠券。
2.  **Moksa 技巧：** 測試是驗證邏輯是否正確的唯一方法。請分別用 VIP 帳號和一般訪客帳號進行測試：
    *   **測試情境 1 (符合條件 A):** 以 VIP 身份登入，將價值 $2500 的「服飾」商品加入購物車，套用優惠券應成功。
    *   **測試情境 2 (符合條件 B):** 以 VIP 身份登入，將價值 $6000 的「電子產品」加入購物車，套用優惠券應成功。
    *   **測試情境 3 (不符合任一條件):** 以 VIP 身份登入，將價值 $1500 的「服飾」商品加入購物車，套用優惠券應失敗。
    *   **測試情境 4 (非 VIP):** 以一般訪客或非 VIP 會員身份，隨意購物，套用優惠券應失敗。

---

### 實作二：使用 FluentCRM 建立精準的客戶分眾 (Segmentation)

現在，我們換個場景。假設我們想找出符合以下任一條件的客戶，並為他們貼上「高潛力回購客」的標籤：
> 客戶註冊**超過一年**，**且**在過去 90 天內**有**消費；**或者**，客戶購買過「**MoksaWP 實戰班**」這個特定商品。

*   **條件 A (需要一個群組):**
    1.  註冊日期 **早於** 365 天前 (規則 1)
    2.  **且** 最後下單日期 **在** 過去 90 天內 (規則 2)

*   **條件 B (需要另一個群組):**
    1.  已購買的商品 **包含** 「MoksaWP 實戰班」 (規則 1)

最終篩選邏輯：「**滿足條件 A**」 **或者** 「**滿足條件 B**」。

#### 步驟 1：建立新的聯絡人分段 (Dynamic Segment)

1.  前往 WordPress 後台 > **FluentCRM** > **聯絡人 (Contacts)**。
2.  在上方頁籤切換到「**分段 (Segments)**」。
3.  點擊右上角的「**建立分段 (Create Segment)**」按鈕。
4.  為這個分段命名，例如「**高潛力回購客**」。

#### 步驟 2：設定篩選條件

1.  在「**篩選條件 (Filter Conditions)**」區塊，你會看到 FluentCRM 的篩選介面。它和 Advanced Coupons 的邏輯完全相同。
2.  預設會有一個群組，在群組右上方，確認下拉選單是「**符合全部 (Match All)**」。
3.  點擊「**新增條件 (Add New Condition)**」，設定「條件 A」的第一條規則：
    *   選擇 **User Data** > **User Registration Date**。
    *   條件設為 **Before** > **365 days ago**。

``

4.  在同一個群組內，再次點擊「**新增條件 (Add New Condition)**」，設定第二條規則：
    *   選擇 **WooCommerce** > **Last Order Date**。
    *   條件設為 **Within Last** > **90 days**。

``

5.  現在「條件 A」的群組已經設定完成 (內部為 AND 邏輯)。

#### 步驟 3：新增 OR 條件群組

1.  在條件設定區的最上方，你會看到一個「**AND**」按鈕，點擊它可以切換為「**OR**」。**請務必將它切換為 OR**。這代表群組之間的邏輯。
2.  點擊下方的「**新增篩選群組 (Add new filter group)**」。
3.  在新群組中，設定「條件 B」的規則：
    *   選擇 **WooCommerce** > **Purchased Products**。
    *   條件設為 **Includes** > 搜尋並選擇「**MoksaWP 實戰班**」。

``

4.  完成後，你的條件設定看起來會是：
    *   `Filter contacts by ANY of the following conditions:` (OR 邏輯)
        *   `Group 1 (Match ALL):`
            *   `User Registration Date is Before 365 days ago`
            *   `AND Last Order Date is Within Last 90 days`
        *   `Group 2 (Match ALL):`
            *   `Purchased Products Includes 'MoksaWP 實戰班'`

#### 步驟 4：建立分段並應用

1.  點擊「**建立分段 (Create Segment)**」按鈕。
2.  FluentCRM 會自動計算出符合條件的聯絡人數量。
3.  你可以利用這個動態分段 (Dynamic Segment) 來做很多事，例如：
    *   發送專屬的 Email Campaign。
    *   在自動化流程 (Automations) 中作為觸發或判斷條件。
    *   批次為這些人加上特定標籤 (Tag)。

### 總結

今天我們學到了一個網站營運中極為關鍵的邏輯概念。無論你使用的是優惠券、CRM、會員系統還是頁面編輯器，只要看到可以設定條件的地方，背後幾乎都是由「規則」與「群組」構成的 AND/OR 邏輯。

**請記住 Moksa 的核心口訣：「組內跑 AND，組間跑 OR」。**

當你下次需要規劃複雜的行銷活動時，先不要急著進入後台操作。拿起紙筆，或是打開記事本，將你的條件用「規則」和「群組」的方式拆解出來，你會發現整個思路變得無比清晰，執行起來也更不容易出錯。